import{initSw}from"./sw/sw-init.f452a4081a13d9d6.js";const $=window.jQuery,config=window.IBIC_ADMIN_CONFIG,i18n=window.wp.i18n,renderErrorFactory=({$})=>error=>{const $ibicNotice=$(".ibic-notice");0<$ibicNotice.length&&$ibicNotice.remove(),$("#wp-media-grid").before($('<div class="ibic-notice notice notice-error inline">').append($("<p></p>").text(error)))},renderError=renderErrorFactory({$:$}),init=function({sendMessage,eventHandler,update}){if(location.href.match(/\/(plugins|update-core).php(\?.*)?$/))update().then(willUpdate=>{}).catch(e=>{console.error(e)});else{if(window.renderIbicUiList){const retryHandler=imageId=>()=>{var id;sendMessage({command:"remove-item",id:id=imageId}),$.post(config.image_reset_url,{id:id}).then(()=>{sendMessage({command:"get-update"})}).catch(()=>{renderError(i18n.__("The retry failed, maybe the image does not exist anymore.","ibic"))})},translations={Retry:i18n.__("Retry","ibic"),"All images are compressed.":i18n.__("All images are compressed.","ibic"),"Image upload failed":i18n.__("Image upload failed","ibic"),"Loading...":i18n.__("Loading...","ibic"),UPLOAD_MAX_SIZE_ERROR:i18n.__("The uploaded file exceeds the server max upload size.","ibic"),CANT_READ_IMAGE_ERROR:i18n.__("Can't read the image.","ibic"),CANT_DECODE_IMAGE_TOO_BIG_ERROR:i18n.__("The image is too big and can't be compressed.","ibic"),UNSUPPORTED_IMAGE_TYPE:i18n.__("Unsupported image type.","ibic"),CANT_OPTIMISE_IMAGE_ERROR:i18n.__("An error has occurred during the image compression.","ibic")};eventHandler.addEventListener("message",function(event){"queue-updated"===event.data.command&&(renderIbicUiList({imageList:event.data.queue,state:"READY",translations:translations,retryHandler:retryHandler}),$("#ibic-completion-placeholder").load(ajaxurl+"?action=ibic_get_media_completion_status"))}),renderIbicUiList({translations:translations,retryHandler:retryHandler})}sendMessage({command:"get-update"}),wp.Uploader&&wp.Uploader.queue&&wp.Uploader.queue.on("reset",function(){sendMessage({command:"get-update"})}),wp.apiFetch&&wp.apiFetch.use((options,next)=>{var result;return"/wp/v2/media"===options.path&&"POST"===options.method?(result=next(options),sendMessage({command:"get-update"}),result):next(options)})}};$(function(){initSw({sw_url:config.assets_path+"sw/sw.js",scope:"/wp-admin",config:config.sw_config}).then(init).catch(error=>{console.error(error),renderError(i18n.__("Sorry, the image compression is not supported by your browser.","ibic"))})});
//# sourceMappingURL=ibic-admin.js.map