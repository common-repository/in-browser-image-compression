!function(){"use strict";function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function formatProdErrorMessage(code){return"Minified Redux error #"+code+"; visit https://redux.js.org/Errors?code="+code+" for the full message or use the non-minified dev environment for full errors. "}function randomString(){return Math.random().toString(36).substring(7).split("").join(".")}var $$observable="function"==typeof Symbol&&Symbol.observable||"@@observable",ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function createStore(reducer,preloadedState,enhancer){if("function"==typeof preloadedState&&"function"==typeof enhancer||"function"==typeof enhancer&&"function"==typeof arguments[3])throw new Error(formatProdErrorMessage(0));if("function"==typeof preloadedState&&void 0===enhancer&&(enhancer=preloadedState,preloadedState=void 0),void 0!==enhancer){if("function"!=typeof enhancer)throw new Error(formatProdErrorMessage(1));return enhancer(createStore)(reducer,preloadedState)}if("function"!=typeof reducer)throw new Error(formatProdErrorMessage(2));var currentReducer=reducer,currentState=preloadedState,currentListeners=[],nextListeners=currentListeners,isDispatching=!1;function ensureCanMutateNextListeners(){nextListeners===currentListeners&&(nextListeners=currentListeners.slice())}function getState(){if(isDispatching)throw new Error(formatProdErrorMessage(3));return currentState}function subscribe(listener){if("function"!=typeof listener)throw new Error(formatProdErrorMessage(4));if(isDispatching)throw new Error(formatProdErrorMessage(5));var isSubscribed=!0;return ensureCanMutateNextListeners(),nextListeners.push(listener),function(){if(isSubscribed){if(isDispatching)throw new Error(formatProdErrorMessage(6));isSubscribed=!1,ensureCanMutateNextListeners();var index=nextListeners.indexOf(listener);nextListeners.splice(index,1),currentListeners=null}}}function dispatch(action){if(!function(obj){if("object"==typeof obj&&null!==obj){for(var proto=obj;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(obj)===proto}}(action))throw new Error(formatProdErrorMessage(7));if(void 0===action.type)throw new Error(formatProdErrorMessage(8));if(isDispatching)throw new Error(formatProdErrorMessage(9));try{isDispatching=!0,currentState=currentReducer(currentState,action)}finally{isDispatching=!1}for(var listeners=currentListeners=nextListeners,i=0;i<listeners.length;i++)(0,listeners[i])();return action}return dispatch({type:ActionTypes.INIT}),(enhancer={dispatch:dispatch,subscribe:subscribe,getState:getState,replaceReducer:function(nextReducer){if("function"!=typeof nextReducer)throw new Error(formatProdErrorMessage(10));currentReducer=nextReducer,dispatch({type:ActionTypes.REPLACE})}})[$$observable]=function(){var outerSubscribe=subscribe,_ref={subscribe:function(observer){if("object"!=typeof observer||null===observer)throw new Error(formatProdErrorMessage(11));function observeState(){observer.next&&observer.next(getState())}return observeState(),{unsubscribe:outerSubscribe(observeState)}}};return _ref[$$observable]=function(){return this},_ref},enhancer}function combineReducers(reducers){for(var reducerKeys=Object.keys(reducers),finalReducers={},i=0;i<reducerKeys.length;i++){var key=reducerKeys[i];"function"==typeof reducers[key]&&(finalReducers[key]=reducers[key])}var shapeAssertionError,finalReducerKeys=Object.keys(finalReducers);try{!function(reducers){Object.keys(reducers).forEach(function(key){key=reducers[key];if(void 0===key(void 0,{type:ActionTypes.INIT}))throw new Error(formatProdErrorMessage(12));if(void 0===key(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()}))throw new Error(formatProdErrorMessage(13))})}(finalReducers)}catch(e){shapeAssertionError=e}return function(state,action){if(void 0===state&&(state={}),shapeAssertionError)throw shapeAssertionError;for(var hasChanged=!1,nextState={},_i=0;_i<finalReducerKeys.length;_i++){var _key=finalReducerKeys[_i],reducer=finalReducers[_key],previousStateForKey=state[_key],reducer=reducer(previousStateForKey,action);if(void 0===reducer)throw action&&action.type,new Error(formatProdErrorMessage(14));nextState[_key]=reducer,hasChanged=hasChanged||reducer!==previousStateForKey}return(hasChanged=hasChanged||finalReducerKeys.length!==Object.keys(state).length)?nextState:state}}function compose(){for(var _len=arguments.length,funcs=new Array(_len),_key=0;_key<_len;_key++)funcs[_key]=arguments[_key];return 0===funcs.length?function(arg){return arg}:1===funcs.length?funcs[0]:funcs.reduce(function(a,b){return function(){return a(b.apply(void 0,arguments))}})}const getConfig=store=>store.getState().config,setConfig=config=>({type:"SET_CONFIG",config:config});var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(getRandomValues=getRandomValues||("undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))return getRandomValues(rnds8);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(arr,argument_1){argument_1=1<arguments.length&&void 0!==argument_1?argument_1:0,arr=(byteToHex[arr[argument_1+0]]+byteToHex[arr[argument_1+1]]+byteToHex[arr[argument_1+2]]+byteToHex[arr[argument_1+3]]+"-"+byteToHex[arr[argument_1+4]]+byteToHex[arr[argument_1+5]]+"-"+byteToHex[arr[argument_1+6]]+byteToHex[arr[argument_1+7]]+"-"+byteToHex[arr[argument_1+8]]+byteToHex[arr[argument_1+9]]+"-"+byteToHex[arr[argument_1+10]]+byteToHex[arr[argument_1+11]]+byteToHex[arr[argument_1+12]]+byteToHex[arr[argument_1+13]]+byteToHex[arr[argument_1+14]]+byteToHex[arr[argument_1+15]]).toLowerCase();if(function(uuid){return"string"==typeof uuid&&REGEX.test(uuid)}(arr))return arr;throw TypeError("Stringified UUID is invalid")}const ITEM_STATE={IDLE:"idle",PROCESSING:"processing",PROCESSED:"processed"},ADD="Queue/ADD",addToQueue=(payload,queue,uuid=function(options,buf,offset){var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf){offset=offset||0;for(var i=0;i<16;++i)buf[offset+i]=rnds[i];return buf}return stringify(rnds)}())=>{payload={queue:queue,payload:payload,id:queue+"/"+uuid};return{type:ADD,item:{...payload,state:ITEM_STATE.IDLE}}},UPDATE="Queue/UPDATE_ITEM",updateItemInQueue=(id,payload)=>({type:UPDATE,id:id,payload:payload}),NEXT="Queue/NEXT",processNextItemInQueue=queue=>({type:NEXT,queue:queue}),PROCESS_ITEM="Queue/PROCESS_ITEM",ITEM_PROCESSED="Queue/ITEM_PROCESSED",queueItemProcessed=id=>({type:ITEM_PROCESSED,id:id}),PROCESSED="Queue/PROCESSED",REMOVE_ITEM="Queue/REMOVE_ITEM",removeItemInQueue=id=>({type:REMOVE_ITEM,id:id}),queue=(state=[],action)=>{switch(action.type){case ADD:return[...state,action.item];case UPDATE:return state.map(item=>item.id===action.id?{...item,payload:{...item.payload,...action.payload}}:item);case PROCESS_ITEM:case ITEM_PROCESSED:return state.map(item=>item.id===action.id?{...item,state:action.type===PROCESS_ITEM?ITEM_STATE.PROCESSING:ITEM_STATE.PROCESSED}:item);case"Queue/UPDATE_ITEM_STATE":return state.map(item=>item.id===action.id?{...item,state:action.state}:item);case REMOVE_ITEM:return state.filter(item=>item.id!==action.id);default:return state}},getQueueItemById=(store,id)=>{return store.getState().queue.filter(item=>item.id===id)[0]},getQueueItemByPayloadId=(store,id)=>{return getQueueItemsByPayloadId(store,id)[0]},getQueueItemsByPayloadId=(store,id)=>store.getState().queue.filter(item=>item.payload.id===id),getQueueItemToBeProcessed=(store,queueName)=>store.getState().queue.filter(item=>item.state===ITEM_STATE.IDLE&&item.queue===queueName),getQueueItemProcessed=(store,queueName)=>store.getState().queue.filter(item=>item.state===ITEM_STATE.PROCESSED&&item.queue===queueName),getQueueItemsByQueue=(store,queueName)=>store.getState().queue.filter(item=>item.queue===queueName);_scriptDir="codecs/mozjpeg/enc/mozjpeg_enc.js";var _scriptDir,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(fn){var module={exports:{}};return fn(module,module.exports),module.exports}const jpg={encode:function(Module){(Module=void 0!==(Module=Module||{})?Module:{}).ready=new Promise(function(resolve,reject){readyPromiseResolve=resolve,readyPromiseReject=reject});var readyPromiseResolve,readyPromiseReject,key,moduleOverrides={};for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var thisProgram="./this.program",quit_=function(status,toThrow){throw toThrow},ENVIRONMENT_IS_WORKER=!0,scriptDirectory="";scriptDirectory=self.location.href;var wasmBinary,scriptDirectory=0!==(scriptDirectory=_scriptDir).indexOf("blob:")?scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1):"",readBinary=function(url){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!1),xhr.responseType="arraybuffer",xhr.send(null),new Uint8Array(xhr.response)},out=Module.print||console.log.bind(console),err=Module.printErr||console.warn.bind(console);for(key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=null,Module.arguments&&Module.arguments,Module.thisProgram&&(thisProgram=Module.thisProgram),Module.quit&&(quit_=Module.quit),Module.wasmBinary&&(wasmBinary=Module.wasmBinary);var wasmMemory,noExitRuntime=Module.noExitRuntime||!0,ABORT=("object"!=typeof WebAssembly&&abort("no native wasm support detected"),!1),UTF8Decoder=new TextDecoder("utf8");function UTF8ToString(ptr,maxBytesToRead){if(!ptr)return"";for(var maxPtr=ptr+maxBytesToRead,end=ptr;!(maxPtr<=end)&&HEAPU8[end];)++end;return UTF8Decoder.decode(HEAPU8.subarray(ptr,end))}function stringToUTF8(str,outPtr,maxBytesToWrite){!function(str,heap,outIdx,maxBytesToWrite){if(!(0<maxBytesToWrite))return;for(var endIdx=outIdx+maxBytesToWrite-1,i=0;i<str.length;++i){var u=str.charCodeAt(i);if((u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&str.charCodeAt(++i):u)<=127){if(endIdx<=outIdx)break;heap[outIdx++]=u}else if(u<=2047){if(endIdx<=outIdx+1)break;heap[outIdx++]=192|u>>6,heap[outIdx++]=128|63&u}else if(u<=65535){if(endIdx<=outIdx+2)break;heap[outIdx++]=224|u>>12,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}else{if(endIdx<=outIdx+3)break;heap[outIdx++]=240|u>>18,heap[outIdx++]=128|u>>12&63,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}}heap[outIdx]=0}(str,HEAPU8,outPtr,maxBytesToWrite)}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,UTF16Decoder=new TextDecoder("utf-16le");function UTF16ToString(ptr,maxBytesToRead){for(var idx=ptr>>1,maxIdx=idx+maxBytesToRead/2;!(maxIdx<=idx)&&HEAPU16[idx];)++idx;return UTF16Decoder.decode(HEAPU8.subarray(ptr,idx<<1))}function stringToUTF16(str,outPtr,maxBytesToWrite){if((maxBytesToWrite=void 0===maxBytesToWrite?2147483647:maxBytesToWrite)<2)return 0;for(var startPtr=outPtr,numCharsToWrite=(maxBytesToWrite-=2)<2*str.length?maxBytesToWrite/2:str.length,i=0;i<numCharsToWrite;++i){var codeUnit=str.charCodeAt(i);HEAP16[outPtr>>1]=codeUnit,outPtr+=2}return HEAP16[outPtr>>1]=0,outPtr-startPtr}function lengthBytesUTF16(str){return 2*str.length}function UTF32ToString(ptr,maxBytesToRead){for(var i=0,str="";!(maxBytesToRead/4<=i);){var ch,utf32=HEAP32[ptr+4*i>>2];if(0==utf32)break;++i,65536<=utf32?(ch=utf32-65536,str+=String.fromCharCode(55296|ch>>10,56320|1023&ch)):str+=String.fromCharCode(utf32)}return str}function stringToUTF32(str,outPtr,maxBytesToWrite){if((maxBytesToWrite=void 0===maxBytesToWrite?2147483647:maxBytesToWrite)<4)return 0;for(var startPtr=outPtr,endPtr=startPtr+maxBytesToWrite-4,i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(55296<=codeUnit&&codeUnit<=57343&&(codeUnit=65536+((1023&codeUnit)<<10)|1023&str.charCodeAt(++i)),HEAP32[outPtr>>2]=codeUnit,endPtr<(outPtr+=4)+4)break}return HEAP32[outPtr>>2]=0,outPtr-startPtr}function lengthBytesUTF32(str){for(var len=0,i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);55296<=codeUnit&&codeUnit<=57343&&++i,len+=4}return len}function updateGlobalBufferAndViews(buf){buffer=buf,Module.HEAP8=HEAP8=new Int8Array(buf),Module.HEAP16=HEAP16=new Int16Array(buf),Module.HEAP32=HEAP32=new Int32Array(buf),Module.HEAPU8=HEAPU8=new Uint8Array(buf),Module.HEAPU16=HEAPU16=new Uint16Array(buf),Module.HEAPU32=HEAPU32=new Uint32Array(buf),Module.HEAPF32=HEAPF32=new Float32Array(buf),Module.HEAPF64=HEAPF64=new Float64Array(buf)}Module.INITIAL_MEMORY;var wasmTable,__ATPRERUN__=[],__ATINIT__=[],__ATPOSTRUN__=[];function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)cb=Module.preRun.shift(),__ATPRERUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPRERUN__)}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)cb=Module.postRun.shift(),__ATPOSTRUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPOSTRUN__)}var runDependencies=0,dependenciesFulfilled=null;function abort(what){Module.onAbort&&Module.onAbort(what),err(what+=""),ABORT=!0,what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";what=new WebAssembly.RuntimeError(what);throw readyPromiseReject(what),what}Module.preloadedImages={},Module.preloadedAudios={};var wasmBinaryFile,path;function isDataURI(filename){return filename.startsWith("data:application/octet-stream;base64,")}function getBinary(file){try{return file==wasmBinaryFile&&wasmBinary?new Uint8Array(wasmBinary):readBinary(file)}catch(err){abort(err)}}function callRuntimeCallbacks(callbacks){for(;0<callbacks.length;){var func,callback=callbacks.shift();"function"==typeof callback?callback(Module):"number"==typeof(func=callback.func)?void 0===callback.arg?wasmTable.get(func)():wasmTable.get(func)(callback.arg):func(void 0===callback.arg?null:callback.arg)}}Module.locateFile?isDataURI(wasmBinaryFile="mozjpeg_enc.wasm")||(path=wasmBinaryFile,wasmBinaryFile=Module.locateFile?Module.locateFile(path,scriptDirectory):scriptDirectory+path):wasmBinaryFile=new URL("mozjpeg_enc.wasm","codecs/mozjpeg/enc/mozjpeg_enc.js").toString();var runtimeKeepaliveCounter=0;function keepRuntimeAlive(){return noExitRuntime||0<runtimeKeepaliveCounter}var structRegistrations={};function runDestructors(destructors){for(;destructors.length;){var ptr=destructors.pop();destructors.pop()(ptr)}}function simpleReadValueFromPointer(pointer){return this.fromWireType(HEAPU32[pointer>>2])}var awaitingDependencies={},registeredTypes={},typeDependencies={},char_0=48,char_9=57;function makeLegalFunctionName(name){if(void 0===name)return"_unknown";var f=(name=name.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return char_0<=f&&f<=char_9?"_"+name:name}function createNamedFunction(name,body){return name=makeLegalFunctionName(name),new Function("body","return function "+name+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(body)}function extendError(baseErrorType,errorName){var errorClass=createNamedFunction(errorName,function(message){this.name=errorName,this.message=message;message=new Error(message).stack;void 0!==message&&(this.stack=this.toString()+"\n"+message.replace(/^Error(:[^\n]*)?\n/,""))});return errorClass.prototype=Object.create(baseErrorType.prototype),(errorClass.prototype.constructor=errorClass).prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},errorClass}var InternalError=void 0;function throwInternalError(message){throw new InternalError(message)}function whenDependentTypesAreResolved(myTypes,dependentTypes,getTypeConverters){function onComplete(typeConverters){var myTypeConverters=getTypeConverters(typeConverters);myTypeConverters.length!==myTypes.length&&throwInternalError("Mismatched type converter count");for(var i=0;i<myTypes.length;++i)registerType(myTypes[i],myTypeConverters[i])}myTypes.forEach(function(type){typeDependencies[type]=dependentTypes});var typeConverters=new Array(dependentTypes.length),unregisteredTypes=[],registered=0;dependentTypes.forEach(function(dt,i){registeredTypes.hasOwnProperty(dt)?typeConverters[i]=registeredTypes[dt]:(unregisteredTypes.push(dt),awaitingDependencies.hasOwnProperty(dt)||(awaitingDependencies[dt]=[]),awaitingDependencies[dt].push(function(){typeConverters[i]=registeredTypes[dt],++registered===unregisteredTypes.length&&onComplete(typeConverters)}))}),0===unregisteredTypes.length&&onComplete(typeConverters)}function getShiftFromSize(size){switch(size){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+size)}}var embind_charCodes=void 0;function readLatin1String(ptr){for(var ret="",c=ptr;HEAPU8[c];)ret+=embind_charCodes[HEAPU8[c++]];return ret}var BindingError=void 0;function throwBindingError(message){throw new BindingError(message)}function registerType(rawType,registeredInstance,options){if(options=options||{},!("argPackAdvance"in registeredInstance))throw new TypeError("registerType registeredInstance requires argPackAdvance");var name=registeredInstance.name;if(rawType||throwBindingError('type "'+name+'" must have a positive integer typeid pointer'),registeredTypes.hasOwnProperty(rawType)){if(options.ignoreDuplicateRegistrations)return;throwBindingError("Cannot register type '"+name+"' twice")}registeredTypes[rawType]=registeredInstance,delete typeDependencies[rawType],awaitingDependencies.hasOwnProperty(rawType)&&(options=awaitingDependencies[rawType],delete awaitingDependencies[rawType],options.forEach(function(cb){cb()}))}var emval_free_list=[],emval_handle_array=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function __emval_decref(handle){4<handle&&0==--emval_handle_array[handle].refcount&&(emval_handle_array[handle]=void 0,emval_free_list.push(handle))}function count_emval_handles(){for(var count=0,i=5;i<emval_handle_array.length;++i)void 0!==emval_handle_array[i]&&++count;return count}function get_first_emval(){for(var i=5;i<emval_handle_array.length;++i)if(void 0!==emval_handle_array[i])return emval_handle_array[i];return null}function __emval_register(value){switch(value){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var handle=emval_free_list.length?emval_free_list.pop():emval_handle_array.length;return emval_handle_array[handle]={refcount:1,value:value},handle}}function _embind_repr(v){if(null===v)return"null";var t=typeof v;return"object"==t||"array"==t||"function"==t?v.toString():""+v}function craftInvokerFunction(humanName,argTypes,classType,cppInvokerFunc,cppTargetFunc){for(var argCount=argTypes.length,classType=(argCount<2&&throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!"),null!==argTypes[1]&&null!==classType),needsDestructorStack=!1,i=1;i<argTypes.length;++i)if(null!==argTypes[i]&&void 0===argTypes[i].destructorFunction){needsDestructorStack=!0;break}for(var returns="void"!==argTypes[0].name,argsList="",argsListWired="",i=0;i<argCount-2;++i)argsList+=(0!==i?", ":"")+"arg"+i,argsListWired+=(0!==i?", ":"")+"arg"+i+"Wired";var invokerFnBody="return function "+makeLegalFunctionName(humanName)+"("+argsList+") {\nif (arguments.length !== "+(argCount-2)+") {\nthrowBindingError('function "+humanName+" called with ' + arguments.length + ' arguments, expected "+(argCount-2)+" args!');\n}\n",dtorStack=(needsDestructorStack&&(invokerFnBody+="var destructors = [];\n"),needsDestructorStack?"destructors":"null"),args1=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],args2=[throwBindingError,cppInvokerFunc,cppTargetFunc,runDestructors,argTypes[0],argTypes[1]];classType&&(invokerFnBody+="var thisWired = classParam.toWireType("+dtorStack+", this);\n");for(i=0;i<argCount-2;++i)invokerFnBody+="var arg"+i+"Wired = argType"+i+".toWireType("+dtorStack+", arg"+i+"); // "+argTypes[i+2].name+"\n",args1.push("argType"+i),args2.push(argTypes[i+2]);if(invokerFnBody+=(returns?"var rv = ":"")+"invoker(fn"+(0<(argsListWired=classType?"thisWired"+(0<argsListWired.length?", ":"")+argsListWired:argsListWired).length?", ":"")+argsListWired+");\n",needsDestructorStack)invokerFnBody+="runDestructors(destructors);\n";else for(i=classType?1:2;i<argTypes.length;++i){var paramName=1===i?"thisWired":"arg"+(i-2)+"Wired";null!==argTypes[i].destructorFunction&&(invokerFnBody+=paramName+"_dtor("+paramName+"); // "+argTypes[i].name+"\n",args1.push(paramName+"_dtor"),args2.push(argTypes[i].destructorFunction))}return returns&&(invokerFnBody+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),args1.push(invokerFnBody+="}\n"),function(constructor,argumentList){if(!(constructor instanceof Function))throw new TypeError("new_ called with constructor type "+typeof constructor+" which is not a function");(dummy=createNamedFunction(constructor.name||"unknownFunctionName",function(){})).prototype=constructor.prototype;var dummy=new dummy;return(constructor=constructor.apply(dummy,argumentList))instanceof Object?constructor:dummy}(Function,args1).apply(null,args2)}function exposePublicSymbol(name,value,numArguments){var proto,methodName,humanName,prevFunc;Module.hasOwnProperty(name)?((void 0===numArguments||void 0!==Module[name].overloadTable&&void 0!==Module[name].overloadTable[numArguments])&&throwBindingError("Cannot register public name '"+name+"' twice"),humanName=methodName=name,void 0===(proto=Module)[methodName].overloadTable&&(prevFunc=proto[methodName],proto[methodName]=function(){return proto[methodName].overloadTable.hasOwnProperty(arguments.length)||throwBindingError("Function '"+humanName+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+proto[methodName].overloadTable+")!"),proto[methodName].overloadTable[arguments.length].apply(this,arguments)},proto[methodName].overloadTable=[],proto[methodName].overloadTable[prevFunc.argCount]=prevFunc),Module.hasOwnProperty(numArguments)&&throwBindingError("Cannot register multiple overloads of a function with the same number of arguments ("+numArguments+")!"),Module[name].overloadTable[numArguments]=value):(Module[name]=value,void 0!==numArguments&&(Module[name].numArguments=numArguments))}function dynCall(sig,ptr,args){return sig.includes("j")?function(sig,ptr,args){return sig=Module["dynCall_"+sig],args&&args.length?sig.apply(null,[ptr].concat(args)):sig.call(null,ptr)}(sig,ptr,args):wasmTable.get(ptr).apply(null,args)}function embind__requireFunction(signature,rawFunction){var sig,ptr,argCache,fp=(signature=readLatin1String(signature)).includes("j")?(sig=signature,ptr=rawFunction,argCache=[],function(){argCache.length=arguments.length;for(var i=0;i<arguments.length;i++)argCache[i]=arguments[i];return dynCall(sig,ptr,argCache)}):wasmTable.get(rawFunction);return"function"!=typeof fp&&throwBindingError("unknown function pointer with signature "+signature+": "+rawFunction),fp}var UnboundTypeError=void 0;function getTypeName(type){var type=___getTypeName(type),rv=readLatin1String(type);return _free(type),rv}function throwUnboundTypeError(message,types){var unboundTypes=[],seen={};throw types.forEach(function visit(type){seen[type]||registeredTypes[type]||(typeDependencies[type]?typeDependencies[type].forEach(visit):(unboundTypes.push(type),seen[type]=!0))}),new UnboundTypeError(message+": "+unboundTypes.map(getTypeName).join([", "]))}var emval_symbols={};function emval_get_global(){return"object"==typeof globalThis?globalThis:Function("return this")()}function requireRegisteredType(rawType,humanName){var impl=registeredTypes[rawType];return void 0===impl&&throwBindingError(humanName+" has unknown type "+getTypeName(rawType)),impl}var emval_newers={};var ENV={};function getEnvStrings(){if(!getEnvStrings.strings){var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:thisProgram||"./this.program"};for(x in ENV)env[x]=ENV[x];var x,strings=[];for(x in env)strings.push(x+"="+env[x]);getEnvStrings.strings=strings}return getEnvStrings.strings}var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];0===curr||10===curr?((1===stream?out:err)(function(heap,idx,maxBytesToRead){for(var endIdx=idx+maxBytesToRead,endPtr=idx;heap[endPtr]&&!(endIdx<=endPtr);)++endPtr;return UTF8Decoder.decode(heap.subarray?heap.subarray(idx,endPtr):new Uint8Array(heap.slice(idx,endPtr)))}(buffer,0)),buffer.length=0):buffer.push(curr)},varargs:void 0,get:function(){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(ptr){return UTF8ToString(ptr)},get64:function(low,high){return low}};for(var InternalError=Module.InternalError=extendError(Error,"InternalError"),codes=new Array(256),i=0;i<256;++i)codes[i]=String.fromCharCode(i);embind_charCodes=codes,BindingError=Module.BindingError=extendError(Error,"BindingError"),Module.count_emval_handles=count_emval_handles,Module.get_first_emval=get_first_emval;var calledRun,UnboundTypeError=Module.UnboundTypeError=extendError(Error,"UnboundTypeError"),asmLibraryArg={B:function(a0,a1){},l:function(structType){var reg=structRegistrations[structType],rawConstructor=(delete structRegistrations[structType],reg.rawConstructor),rawDestructor=reg.rawDestructor,fieldRecords=reg.fields;whenDependentTypesAreResolved([structType],fieldRecords.map(function(field){return field.getterReturnType}).concat(fieldRecords.map(function(field){return field.setterArgumentType})),function(fieldTypes){var fields={};return fieldRecords.forEach(function(field,i){var fieldName=field.fieldName,getterReturnType=fieldTypes[i],getter=field.getter,getterContext=field.getterContext,setterArgumentType=fieldTypes[i+fieldRecords.length],setter=field.setter,setterContext=field.setterContext;fields[fieldName]={read:function(ptr){return getterReturnType.fromWireType(getter(getterContext,ptr))},write:function(ptr,o){var destructors=[];setter(setterContext,ptr,setterArgumentType.toWireType(destructors,o)),runDestructors(destructors)}}}),[{name:reg.name,fromWireType:function(ptr){var i,rv={};for(i in fields)rv[i]=fields[i].read(ptr);return rawDestructor(ptr),rv},toWireType:function(destructors,o){for(var fieldName in fields)if(!(fieldName in o))throw new TypeError('Missing field:  "'+fieldName+'"');var ptr=rawConstructor();for(fieldName in fields)fields[fieldName].write(ptr,o[fieldName]);return null!==destructors&&destructors.push(rawDestructor,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:rawDestructor}]})},p:function(primitiveType,name,size,minRange,maxRange){},y:function(rawType,name,size,trueValue,falseValue){var shift=getShiftFromSize(size);registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(wt){return!!wt},toWireType:function(destructors,o){return o?trueValue:falseValue},argPackAdvance:8,readValueFromPointer:function(pointer){var heap;if(1===size)heap=HEAP8;else if(2===size)heap=HEAP16;else{if(4!==size)throw new TypeError("Unknown boolean type size: "+name);heap=HEAP32}return this.fromWireType(heap[pointer>>shift])},destructorFunction:null})},x:function(rawType,name){registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(handle){var rv=emval_handle_array[handle].value;return __emval_decref(handle),rv},toWireType:function(destructors,value){return __emval_register(value)},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:null})},i:function(rawType,name,size){size=getShiftFromSize(size),registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(value){return value},toWireType:function(destructors,value){if("number"!=typeof value&&"boolean"!=typeof value)throw new TypeError('Cannot convert "'+_embind_repr(value)+'" to '+this.name);return value},argPackAdvance:8,readValueFromPointer:function(name,shift){switch(shift){case 2:return function(pointer){return this.fromWireType(HEAPF32[pointer>>2])};case 3:return function(pointer){return this.fromWireType(HEAPF64[pointer>>3])};default:throw new TypeError("Unknown float type: "+name)}}(name,size),destructorFunction:null})},f:function(name,argCount,rawArgTypesAddr,signature,rawInvoker,fn){var argTypes=function(count,firstElement){for(var array=[],i=0;i<count;i++)array.push(HEAP32[(firstElement>>2)+i]);return array}(argCount,rawArgTypesAddr);name=readLatin1String(name),rawInvoker=embind__requireFunction(signature,rawInvoker),exposePublicSymbol(name,function(){throwUnboundTypeError("Cannot call "+name+" due to unbound types",argTypes)},argCount-1),whenDependentTypesAreResolved([],argTypes,function(argTypes){argTypes=[argTypes[0],null].concat(argTypes.slice(1));return function(name,value,numArguments){Module.hasOwnProperty(name)||throwInternalError("Replacing nonexistant public symbol"),void 0!==Module[name].overloadTable&&void 0!==numArguments?Module[name].overloadTable[numArguments]=value:(Module[name]=value,Module[name].argCount=numArguments)}(name,craftInvokerFunction(name,argTypes,null,rawInvoker,fn),argCount-1),[]})},c:function(primitiveType,name,size,minRange,maxRange){name=readLatin1String(name),-1===maxRange&&(maxRange=4294967295);var bitshift,shift=getShiftFromSize(size),fromWireType=function(value){return value},isUnsignedType=(0===minRange&&(bitshift=32-8*size,fromWireType=function(value){return value<<bitshift>>>bitshift}),name.includes("unsigned"));registerType(primitiveType,{name:name,fromWireType:fromWireType,toWireType:function(destructors,value){if("number"!=typeof value&&"boolean"!=typeof value)throw new TypeError('Cannot convert "'+_embind_repr(value)+'" to '+this.name);if(value<minRange||maxRange<value)throw new TypeError('Passing a number "'+_embind_repr(value)+'" from JS side to C/C++ side to an argument of type "'+name+'", which is outside the valid range ['+minRange+", "+maxRange+"]!");return isUnsignedType?value>>>0:0|value},argPackAdvance:8,readValueFromPointer:function(name,shift,signed){switch(shift){case 0:return signed?function(pointer){return HEAP8[pointer]}:function(pointer){return HEAPU8[pointer]};case 1:return signed?function(pointer){return HEAP16[pointer>>1]}:function(pointer){return HEAPU16[pointer>>1]};case 2:return signed?function(pointer){return HEAP32[pointer>>2]}:function(pointer){return HEAPU32[pointer>>2]};default:throw new TypeError("Unknown integer type: "+name)}}(name,shift,0!==minRange),destructorFunction:null})},b:function(rawType,dataTypeIndex,name){var TA=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][dataTypeIndex];function decodeMemoryView(handle){var heap=HEAPU32,size=heap[handle>>=2],heap=heap[handle+1];return new TA(buffer,heap,size)}registerType(rawType,{name:name=readLatin1String(name),fromWireType:decodeMemoryView,argPackAdvance:8,readValueFromPointer:decodeMemoryView},{ignoreDuplicateRegistrations:!0})},j:function(rawType,name){var stdStringIsUTF8="std::string"===(name=readLatin1String(name));registerType(rawType,{name:name,fromWireType:function(value){var length=HEAPU32[value>>2];if(stdStringIsUTF8)for(var decodeStartPtr=value+4,i=0;i<=length;++i){var stringSegment,str,currentBytePtr=value+4+i;i!=length&&0!=HEAPU8[currentBytePtr]||(stringSegment=UTF8ToString(decodeStartPtr,currentBytePtr-decodeStartPtr),str=void 0===str?stringSegment:str+String.fromCharCode(0)+stringSegment,decodeStartPtr=currentBytePtr+1)}else{for(var a=new Array(length),i=0;i<length;++i)a[i]=String.fromCharCode(HEAPU8[value+4+i]);str=a.join("")}return _free(value),str},toWireType:function(destructors,value){var valueIsOfTypeString="string"==typeof(value=value instanceof ArrayBuffer?new Uint8Array(value):value),length=(valueIsOfTypeString||value instanceof Uint8Array||value instanceof Uint8ClampedArray||value instanceof Int8Array||throwBindingError("Cannot pass non-string to std::string"),(stdStringIsUTF8&&valueIsOfTypeString?function(){for(var str=value,len=0,i=0;i<str.length;++i){var u=str.charCodeAt(i);(u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&str.charCodeAt(++i):u)<=127?++len:len+=u<=2047?2:u<=65535?3:4}return len}:function(){return value.length})()),ptr=_malloc(4+length+1);if(HEAPU32[ptr>>2]=length,stdStringIsUTF8&&valueIsOfTypeString)stringToUTF8(value,ptr+4,length+1);else if(valueIsOfTypeString)for(var i=0;i<length;++i){var charCode=value.charCodeAt(i);255<charCode&&(_free(ptr),throwBindingError("String has UTF-16 code units that do not fit in 8 bits")),HEAPU8[ptr+4+i]=charCode}else for(i=0;i<length;++i)HEAPU8[ptr+4+i]=value[i];return null!==destructors&&destructors.push(_free,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(ptr){_free(ptr)}})},e:function(rawType,charSize,name){var decodeString,encodeString,getHeap,lengthBytesUTF,shift;name=readLatin1String(name),2===charSize?(decodeString=UTF16ToString,encodeString=stringToUTF16,lengthBytesUTF=lengthBytesUTF16,getHeap=function(){return HEAPU16},shift=1):4===charSize&&(decodeString=UTF32ToString,encodeString=stringToUTF32,lengthBytesUTF=lengthBytesUTF32,getHeap=function(){return HEAPU32},shift=2),registerType(rawType,{name:name,fromWireType:function(value){for(var length=HEAPU32[value>>2],HEAP=getHeap(),decodeStartPtr=value+4,i=0;i<=length;++i){var stringSegment,str,currentBytePtr=value+4+i*charSize;i!=length&&0!=HEAP[currentBytePtr>>shift]||(stringSegment=decodeString(decodeStartPtr,currentBytePtr-decodeStartPtr),str=void 0===str?stringSegment:str+String.fromCharCode(0)+stringSegment,decodeStartPtr=currentBytePtr+charSize)}return _free(value),str},toWireType:function(destructors,value){"string"!=typeof value&&throwBindingError("Cannot pass non-string to C++ string type "+name);var length=lengthBytesUTF(value),ptr=_malloc(4+length+charSize);return HEAPU32[ptr>>2]=length>>shift,encodeString(value,ptr+4,length+charSize),null!==destructors&&destructors.push(_free,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(ptr){_free(ptr)}})},m:function(rawType,name,constructorSignature,rawConstructor,destructorSignature,rawDestructor){structRegistrations[rawType]={name:readLatin1String(name),rawConstructor:embind__requireFunction(constructorSignature,rawConstructor),rawDestructor:embind__requireFunction(destructorSignature,rawDestructor),fields:[]}},a:function(structType,fieldName,getterReturnType,getterSignature,getter,getterContext,setterArgumentType,setterSignature,setter,setterContext){structRegistrations[structType].fields.push({fieldName:readLatin1String(fieldName),getterReturnType:getterReturnType,getter:embind__requireFunction(getterSignature,getter),getterContext:getterContext,setterArgumentType:setterArgumentType,setter:embind__requireFunction(setterSignature,setter),setterContext:setterContext})},z:function(rawType,name){registerType(rawType,{isVoid:!0,name:name=readLatin1String(name),argPackAdvance:0,fromWireType:function(){},toWireType:function(destructors,o){}})},g:__emval_decref,u:function(name){return 0===name?__emval_register(emval_get_global()):(name=void 0===(symbol=emval_symbols[address=name])?readLatin1String(address):symbol,__emval_register(emval_get_global()[name]));var address,symbol},k:function(handle){4<handle&&(emval_handle_array[handle].refcount+=1)},n:function(handle,argCount,argTypes,args){handle=function(handle){return handle||throwBindingError("Cannot use deleted val. handle = "+handle),emval_handle_array[handle].value}(handle);var newer=emval_newers[argCount];return newer||(newer=function(argCount){for(var argsList="",i=0;i<argCount;++i)argsList+=(0!==i?", ":"")+"arg"+i;for(var functionBody="return function emval_allocator_"+argCount+"(constructor, argTypes, args) {\n",i=0;i<argCount;++i)functionBody+="var argType"+i+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+i+'], "parameter '+i+'");\nvar arg'+i+" = argType"+i+".readValueFromPointer(args);\nargs += argType"+i+"['argPackAdvance'];\n";return functionBody+="var obj = new constructor("+argsList+");\nreturn __emval_register(obj);\n}\n",new Function("requireRegisteredType","Module","__emval_register",functionBody)(requireRegisteredType,Module,__emval_register)}(argCount),emval_newers[argCount]=newer),newer(handle,argTypes,args)},h:function(){abort()},r:function(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)},d:function(requestedSize){var oldSize=HEAPU8.length;if(2147483648<(requestedSize>>>=0))return!1;for(var multiple,cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown),overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);if(function(size){try{return wasmMemory.grow(size-buffer.byteLength+65535>>>16),updateGlobalBufferAndViews(wasmMemory.buffer),1}catch(e){}}(Math.min(2147483648,(0<(overGrownHeapSize=Math.max(requestedSize,overGrownHeapSize))%(multiple=65536)&&(overGrownHeapSize+=multiple-overGrownHeapSize%multiple),overGrownHeapSize))))return!0}return!1},s:function(__environ,environ_buf){var bufSize=0;return getEnvStrings().forEach(function(string,i){var ptr=environ_buf+bufSize;!function(str,buffer,dontAddNull){for(var i=0;i<str.length;++i)HEAP8[buffer++>>0]=str.charCodeAt(i);dontAddNull||(HEAP8[buffer>>0]=0)}(string,HEAP32[__environ+4*i>>2]=ptr),bufSize+=string.length+1}),0},t:function(penviron_count,penviron_buf_size){var strings=getEnvStrings(),bufSize=(HEAP32[penviron_count>>2]=strings.length,0);return strings.forEach(function(string){bufSize+=string.length+1}),HEAP32[penviron_buf_size>>2]=bufSize,0},A:function(status){!function(status,implicit){implicit&&keepRuntimeAlive()&&0===status||(keepRuntimeAlive()||(Module.onExit&&Module.onExit(status),ABORT=!0),quit_(status,new ExitStatus(status)))}(status)},w:function(fd){return 0},o:function(fd,offset_low,offset_high,whence,newOffset){},v:function(fd,iov,iovcnt,pnum){for(var num=0,i=0;i<iovcnt;i++){for(var ptr=HEAP32[iov+8*i>>2],len=HEAP32[iov+(8*i+4)>>2],j=0;j<len;j++)SYSCALLS.printChar(fd,HEAPU8[ptr+j]);num+=len}return HEAP32[pnum>>2]=num,0},q:function(val){}},_malloc=(function(){var info={a:asmLibraryArg};function receiveInstance(instance,module){var instance=instance.exports;Module.asm=instance,updateGlobalBufferAndViews((wasmMemory=Module.asm.C).buffer),wasmTable=Module.asm.I,instance=Module.asm.D,__ATINIT__.unshift(instance),runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&dependenciesFulfilled&&(instance=dependenciesFulfilled,dependenciesFulfilled=null,instance())}function receiveInstantiationResult(result){receiveInstance(result.instance)}function instantiateArrayBuffer(receiver){return(!wasmBinary&&ENVIRONMENT_IS_WORKER&&"function"==typeof fetch?fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(response.ok)return response.arrayBuffer();throw"failed to load wasm binary file at '"+wasmBinaryFile+"'"}).catch(function(){return getBinary(wasmBinaryFile)}):Promise.resolve().then(function(){return getBinary(wasmBinaryFile)})).then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason),abort(reason)})}if(runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),Module.instantiateWasm)try{return Module.instantiateWasm(info,receiveInstance)}catch(e){return err("Module.instantiateWasm callback failed with error: "+e)}(wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(wasmBinaryFile)||"function"!=typeof fetch?instantiateArrayBuffer(receiveInstantiationResult):fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){return WebAssembly.instantiateStreaming(response,info).then(receiveInstantiationResult,function(reason){return err("wasm streaming compile failed: "+reason),err("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(receiveInstantiationResult)})})).catch(readyPromiseReject)}(),Module.___wasm_call_ctors=function(){return(Module.___wasm_call_ctors=Module.asm.D).apply(null,arguments)},Module._malloc=function(){return(_malloc=Module._malloc=Module.asm.E).apply(null,arguments)}),_free=Module._free=function(){return(_free=Module._free=Module.asm.F).apply(null,arguments)},___getTypeName=Module.___getTypeName=function(){return(___getTypeName=Module.___getTypeName=Module.asm.G).apply(null,arguments)};Module.___embind_register_native_and_builtin_types=function(){return(Module.___embind_register_native_and_builtin_types=Module.asm.H).apply(null,arguments)},Module.dynCall_jiji=function(){return(Module.dynCall_jiji=Module.asm.J).apply(null,arguments)};function ExitStatus(status){this.name="ExitStatus",this.message="Program terminated with exit("+status+")",this.status=status}function run(args){function doRun(){calledRun||(calledRun=!0,Module.calledRun=!0,ABORT||(callRuntimeCallbacks(__ATINIT__),readyPromiseResolve(Module),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}0<runDependencies||(preRun(),0<runDependencies||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),doRun()},1)):doRun()))}if(dependenciesFulfilled=function runCaller(){calledRun||run(),calledRun||(dependenciesFulfilled=runCaller)},Module.run=run,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);0<Module.preInit.length;)Module.preInit.pop()();return run(),Module.ready},decode:createCommonjsModule(function(module){dctZigZag=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),constructor.prototype={load:function(path){var xhr=new XMLHttpRequest;xhr.open("GET",path,!0),xhr.responseType="arraybuffer",xhr.onload=function(){var data=new Uint8Array(xhr.response||xhr.mozResponseArrayBuffer);this.parse(data),this.onload&&this.onload()}.bind(this),xhr.send(null)},parse:function(data){var maxResolutionInPixels=1e3*this.opts.maxResolutionInMP*1e3,offset=0;data.length;function readUint16(){var value=data[offset]<<8|data[offset+1];return offset+=2,value}var frame,resetInterval,jfif=null,adobe=null,quantizationTables=[],frames=[],huffmanTablesAC=[],huffmanTablesDC=[],fileMarker=readUint16(),malformedDataOffset=-1;if(this.comments=[],65496!=fileMarker)throw new Error("SOI not found");for(fileMarker=readUint16();65497!=fileMarker;){switch(fileMarker){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var appData=function(){var length=readUint16(),length=data.subarray(offset,offset+length-2);return offset+=length.length,length}();65534===fileMarker&&(comment=String.fromCharCode.apply(null,appData),this.comments.push(comment)),65504===fileMarker&&74===appData[0]&&70===appData[1]&&73===appData[2]&&70===appData[3]&&0===appData[4]&&(jfif={version:{major:appData[5],minor:appData[6]},densityUnits:appData[7],xDensity:appData[8]<<8|appData[9],yDensity:appData[10]<<8|appData[11],thumbWidth:appData[12],thumbHeight:appData[13],thumbData:appData.subarray(14,14+3*appData[12]*appData[13])}),65505===fileMarker&&69===appData[0]&&120===appData[1]&&105===appData[2]&&102===appData[3]&&0===appData[4]&&(this.exifBuffer=appData.subarray(5,appData.length)),65518===fileMarker&&65===appData[0]&&100===appData[1]&&111===appData[2]&&98===appData[3]&&101===appData[4]&&0===appData[5]&&(adobe={version:appData[6],flags0:appData[7]<<8|appData[8],flags1:appData[9]<<8|appData[10],transformCode:appData[11]});break;case 65499:for(var quantizationTablesEnd=readUint16()+offset-2;offset<quantizationTablesEnd;){var quantizationTableSpec=data[offset++],tableData=(requestMemoryAllocation(256),new Int32Array(64));if(quantizationTableSpec>>4==0)for(j=0;j<64;j++)tableData[dctZigZag[j]]=data[offset++];else{if(quantizationTableSpec>>4!=1)throw new Error("DQT: invalid table spec");for(j=0;j<64;j++)tableData[dctZigZag[j]]=readUint16()}quantizationTables[15&quantizationTableSpec]=tableData}break;case 65472:case 65473:case 65474:readUint16(),(frame={}).extended=65473===fileMarker,frame.progressive=65474===fileMarker,frame.precision=data[offset++],frame.scanLines=readUint16(),frame.samplesPerLine=readUint16(),frame.components={},frame.componentsOrder=[];var comment=frame.scanLines*frame.samplesPerLine;if(maxResolutionInPixels<comment)throw appData=Math.ceil((comment-maxResolutionInPixels)/1e6),new Error(`maxResolutionInMP limit exceeded by ${appData}MP`);var componentsCount=data[offset++];for(i=0;i<componentsCount;i++){var componentId=data[offset],h=data[offset+1]>>4,v=15&data[offset+1],qId=data[offset+2];frame.componentsOrder.push(componentId),frame.components[componentId]={h:h,v:v,quantizationIdx:qId},offset+=3}!function(frame){var componentId,maxH=0,maxV=0;for(componentId in frame.components)frame.components.hasOwnProperty(componentId)&&(maxH<(component=frame.components[componentId]).h&&(maxH=component.h),maxV<component.v&&(maxV=component.v));var mcusPerLine=Math.ceil(frame.samplesPerLine/8/maxH),mcusPerColumn=Math.ceil(frame.scanLines/8/maxV);for(componentId in frame.components)if(frame.components.hasOwnProperty(componentId)){var component=frame.components[componentId],blocksPerLine=Math.ceil(Math.ceil(frame.samplesPerLine/8)*component.h/maxH),blocksPerColumn=Math.ceil(Math.ceil(frame.scanLines/8)*component.v/maxV),blocksPerLineForMcu=mcusPerLine*component.h,blocksPerColumnForMcu=mcusPerColumn*component.v,blocks=[];requestMemoryAllocation(256*(blocksPerColumnForMcu*blocksPerLineForMcu));for(var i=0;i<blocksPerColumnForMcu;i++){for(var row=[],j=0;j<blocksPerLineForMcu;j++)row.push(new Int32Array(64));blocks.push(row)}component.blocksPerLine=blocksPerLine,component.blocksPerColumn=blocksPerColumn,component.blocks=blocks}frame.maxH=maxH,frame.maxV=maxV,frame.mcusPerLine=mcusPerLine,frame.mcusPerColumn=mcusPerColumn}(frame),frames.push(frame);break;case 65476:var huffmanLength=readUint16();for(i=2;i<huffmanLength;){var huffmanTableSpec=data[offset++],codeLengths=new Uint8Array(16),codeLengthSum=0;for(j=0;j<16;j++,offset++)codeLengthSum+=codeLengths[j]=data[offset];requestMemoryAllocation(16+codeLengthSum);var huffmanValues=new Uint8Array(codeLengthSum);for(j=0;j<codeLengthSum;j++,offset++)huffmanValues[j]=data[offset];i+=17+codeLengthSum,(huffmanTableSpec>>4==0?huffmanTablesDC:huffmanTablesAC)[15&huffmanTableSpec]=function(codeLengths,values){for(var j,k=0,code=[],length=16;0<length&&!codeLengths[length-1];)length--;code.push({children:[],index:0});for(var q,p=code[0],i=0;i<length;i++){for(j=0;j<codeLengths[i];j++){for((p=code.pop()).children[p.index]=values[k];0<p.index;){if(0===code.length)throw new Error("Could not recreate Huffman Table");p=code.pop()}for(p.index++,code.push(p);code.length<=i;)code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q;k++}i+1<length&&(code.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q)}return code[0].children}(codeLengths,huffmanValues)}break;case 65501:readUint16(),resetInterval=readUint16();break;case 65500:readUint16(),readUint16();break;case 65498:readUint16();var selectorsCount=data[offset++],components=[];for(i=0;i<selectorsCount;i++){component=frame.components[data[offset++]];var tableSpec=data[offset++];component.huffmanTableDC=huffmanTablesDC[tableSpec>>4],component.huffmanTableAC=huffmanTablesAC[15&tableSpec],components.push(component)}var spectralStart=data[offset++],spectralEnd=data[offset++],successiveApproximation=data[offset++],spectralStart=decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successiveApproximation>>4,15&successiveApproximation,this.opts);offset+=spectralStart;break;case 65535:255!==data[offset]&&offset--;break;default:if(255==data[offset-3]&&192<=data[offset-2]&&data[offset-2]<=254){offset-=3;break}if(224===fileMarker||225==fileMarker){if(-1!==malformedDataOffset)throw new Error(`first unknown JPEG marker at offset ${malformedDataOffset.toString(16)}, second unknown JPEG marker ${fileMarker.toString(16)} at offset `+(offset-1).toString(16));malformedDataOffset=offset-1,spectralEnd=readUint16();if(255===data[offset+spectralEnd-2]){offset+=spectralEnd-2;break}}throw new Error("unknown JPEG marker "+fileMarker.toString(16))}fileMarker=readUint16()}if(1!=frames.length)throw new Error("only single frame JPEGs supported");for(var i=0;i<frames.length;i++){var j,cp=frames[i].components;for(j in cp)cp[j].quantizationTable=quantizationTables[cp[j].quantizationIdx],delete cp[j].quantizationIdx}this.width=frame.samplesPerLine,this.height=frame.scanLines,this.jfif=jfif,this.adobe=adobe,this.components=[];for(i=0;i<frame.componentsOrder.length;i++){var component=frame.components[frame.componentsOrder[i]];this.components.push({lines:buildComponentData(0,component),scaleX:component.h/frame.maxH,scaleY:component.v/frame.maxV})}},getData:function(width,height){var component1,component2,component3,component4,component1Line,component2Line,component3Line,component4Line,x,y,Y,Cb,Cr,K,C,M,Ye,R,G,B,colorTransform,scaleX=this.width/width,scaleY=this.height/height,offset=0,dataLength=width*height*this.components.length,data=(requestMemoryAllocation(dataLength),new Uint8Array(dataLength));switch(this.components.length){case 1:for(component1=this.components[0],y=0;y<height;y++)for(component1Line=component1.lines[0|y*component1.scaleY*scaleY],x=0;x<width;x++)Y=component1Line[0|x*component1.scaleX*scaleX],data[offset++]=Y;break;case 2:for(component1=this.components[0],component2=this.components[1],y=0;y<height;y++)for(component1Line=component1.lines[0|y*component1.scaleY*scaleY],component2Line=component2.lines[0|y*component2.scaleY*scaleY],x=0;x<width;x++)Y=component1Line[0|x*component1.scaleX*scaleX],data[offset++]=Y,Y=component2Line[0|x*component2.scaleX*scaleX],data[offset++]=Y;break;case 3:for(colorTransform=!0,this.adobe&&this.adobe.transformCode?colorTransform=!0:void 0!==this.opts.colorTransform&&(colorTransform=!!this.opts.colorTransform),component1=this.components[0],component2=this.components[1],component3=this.components[2],y=0;y<height;y++)for(component1Line=component1.lines[0|y*component1.scaleY*scaleY],component2Line=component2.lines[0|y*component2.scaleY*scaleY],component3Line=component3.lines[0|y*component3.scaleY*scaleY],x=0;x<width;x++)B=colorTransform?(Y=component1Line[0|x*component1.scaleX*scaleX],Cb=component2Line[0|x*component2.scaleX*scaleX],R=clampTo8bit(Y+1.402*((Cr=component3Line[0|x*component3.scaleX*scaleX])-128)),G=clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128)),clampTo8bit(Y+1.772*(Cb-128))):(R=component1Line[0|x*component1.scaleX*scaleX],G=component2Line[0|x*component2.scaleX*scaleX],component3Line[0|x*component3.scaleX*scaleX]),data[offset++]=R,data[offset++]=G,data[offset++]=B;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(colorTransform=!1,this.adobe&&this.adobe.transformCode?colorTransform=!0:void 0!==this.opts.colorTransform&&(colorTransform=!!this.opts.colorTransform),component1=this.components[0],component2=this.components[1],component3=this.components[2],component4=this.components[3],y=0;y<height;y++)for(component1Line=component1.lines[0|y*component1.scaleY*scaleY],component2Line=component2.lines[0|y*component2.scaleY*scaleY],component3Line=component3.lines[0|y*component3.scaleY*scaleY],component4Line=component4.lines[0|y*component4.scaleY*scaleY],x=0;x<width;x++)colorTransform?(Y=component1Line[0|x*component1.scaleX*scaleX],Cb=component2Line[0|x*component2.scaleX*scaleX],Cr=component3Line[0|x*component3.scaleX*scaleX],K=component4Line[0|x*component4.scaleX*scaleX],C=255-clampTo8bit(Y+1.402*(Cr-128)),M=255-clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128)),Ye=255-clampTo8bit(Y+1.772*(Cb-128))):(C=component1Line[0|x*component1.scaleX*scaleX],M=component2Line[0|x*component2.scaleX*scaleX],Ye=component3Line[0|x*component3.scaleX*scaleX],K=component4Line[0|x*component4.scaleX*scaleX]),data[offset++]=255-C,data[offset++]=255-M,data[offset++]=255-Ye,data[offset++]=255-K;break;default:throw new Error("Unsupported color mode")}return data},copyToImageData:function(imageData,formatAsRGBA){var x,y,Y,C,M,R,G,B,width=imageData.width,height=imageData.height,imageDataArray=imageData.data,data=this.getData(width,height),i=0,j=0;switch(this.components.length){case 1:for(y=0;y<height;y++)for(x=0;x<width;x++)Y=data[i++],imageDataArray[j++]=Y,imageDataArray[j++]=Y,imageDataArray[j++]=Y,formatAsRGBA&&(imageDataArray[j++]=255);break;case 3:for(y=0;y<height;y++)for(x=0;x<width;x++)R=data[i++],G=data[i++],B=data[i++],imageDataArray[j++]=R,imageDataArray[j++]=G,imageDataArray[j++]=B,formatAsRGBA&&(imageDataArray[j++]=255);break;case 4:for(y=0;y<height;y++)for(x=0;x<width;x++)C=data[i++],M=data[i++],Y=data[i++],R=255-clampTo8bit(C*(1-(C=data[i++])/255)+C),G=255-clampTo8bit(M*(1-C/255)+C),B=255-clampTo8bit(Y*(1-C/255)+C),imageDataArray[j++]=R,imageDataArray[j++]=G,imageDataArray[j++]=B,formatAsRGBA&&(imageDataArray[j++]=255);break;default:throw new Error("Unsupported color mode")}}},maxMemoryUsageBytes=totalBytesAllocated=0,constructor.resetMaxMemoryUsage=function(maxMemoryUsageBytes_){totalBytesAllocated=0,maxMemoryUsageBytes=maxMemoryUsageBytes_},constructor.getBytesAllocated=function(){return totalBytesAllocated},constructor.requestMemoryAllocation=requestMemoryAllocation;var dctZigZag,totalBytesAllocated,maxMemoryUsageBytes,JpegImage=constructor;function constructor(){}function decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successivePrev,successive,opts){frame.precision,frame.samplesPerLine,frame.scanLines;var mcusPerLine=frame.mcusPerLine,progressive=frame.progressive,startOffset=(frame.maxH,frame.maxV,offset),bitsData=0,bitsCount=0;function readBit(){if(0<bitsCount)return bitsData>>--bitsCount&1;if(255==(bitsData=data[offset++])){var nextByte=data[offset++];if(nextByte)throw new Error("unexpected marker: "+(bitsData<<8|nextByte).toString(16))}return bitsData>>>(bitsCount=7)}function decodeHuffman(tree){for(var bit,node=tree;null!==(bit=readBit());){if("number"==typeof(node=node[bit]))return node;if("object"!=typeof node)throw new Error("invalid huffman sequence")}return null}function receive(length){for(var n=0;0<length;){var bit=readBit();if(null===bit)return;n=n<<1|bit,length--}return n}function receiveAndExtend(length){var n=receive(length);return 1<<length-1<=n?n:n+(-1<<length)+1}var eobrun=0;var successiveACNextValue,successiveACState=0;var component,i,j,k,n,marker,h,v,componentsLength=components.length,decodeFn=progressive?0===spectralStart?0===successivePrev?function(component,zz){var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t)<<successive;zz[0]=component.pred+=t}:function(component,zz){zz[0]|=readBit()<<successive}:0===successivePrev?function(component,zz){if(0<eobrun)eobrun--;else for(var k=spectralStart,e=spectralEnd;k<=e;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15){eobrun=receive(rs)+(1<<rs)-1;break}k+=16}else zz[dctZigZag[k+=rs]]=receiveAndExtend(s)*(1<<successive),k++}}:function(component,zz){for(var k=spectralStart,e=spectralEnd,r=0;k<=e;){var z=dctZigZag[k],direction=zz[z]<0?-1:1;switch(successiveACState){case 0:var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,r=rs>>4;if(0==s)successiveACState=r<15?(eobrun=receive(r)+(1<<r),4):(r=16,1);else{if(1!=s)throw new Error("invalid ACn encoding");successiveACNextValue=receiveAndExtend(s),successiveACState=r?2:3}continue;case 1:case 2:zz[z]?zz[z]+=(readBit()<<successive)*direction:0===--r&&(successiveACState=2==successiveACState?3:0);break;case 3:zz[z]?zz[z]+=(readBit()<<successive)*direction:(zz[z]=successiveACNextValue<<successive,successiveACState=0);break;case 4:zz[z]&&(zz[z]+=(readBit()<<successive)*direction)}k++}4===successiveACState&&0===--eobrun&&(successiveACState=0)}:function(component,zz){for(var t=0===(t=decodeHuffman(component.huffmanTableDC))?0:receiveAndExtend(t),k=(zz[0]=component.pred+=t,1);k<64;){var rs=decodeHuffman(component.huffmanTableAC),s=15&rs,rs=rs>>4;if(0==s){if(rs<15)break;k+=16}else zz[dctZigZag[k+=rs]]=receiveAndExtend(s),k++}},mcu=0,mcuExpected=1==componentsLength?components[0].blocksPerLine*components[0].blocksPerColumn:mcusPerLine*frame.mcusPerColumn;for(resetInterval=resetInterval||mcuExpected;mcu<mcuExpected;){for(i=0;i<componentsLength;i++)components[i].pred=0;if(eobrun=0,1==componentsLength)for(component=components[0],n=0;n<resetInterval;n++)!function(component,decode,mcu){var blockRow=mcu/component.blocksPerLine|0,mcu=mcu%component.blocksPerLine;void 0===component.blocks[blockRow]&&opts.tolerantDecoding||decode(component,component.blocks[blockRow][mcu])}(component,decodeFn,mcu),mcu++;else for(n=0;n<resetInterval;n++){for(i=0;i<componentsLength;i++)for(h=(component=components[i]).h,v=component.v,j=0;j<v;j++)for(k=0;k<h;k++)!function(component,decode,mcu,row,col){row=(mcu/mcusPerLine|0)*component.v+row,mcu=mcu%mcusPerLine*component.h+col,void 0===component.blocks[row]&&opts.tolerantDecoding||decode(component,component.blocks[row][mcu])}(component,decodeFn,mcu,j,k);if(++mcu===mcuExpected)break}if(mcu===mcuExpected)for(;(255!==data[offset]||0===data[offset+1])&&(offset+=1)<data.length-2;);if(bitsCount=0,(marker=data[offset]<<8|data[offset+1])<65280)throw new Error("marker was not found");if(!(65488<=marker&&marker<=65495))break;offset+=2}return offset-startOffset}function buildComponentData(frame,component){var lines=[],blocksPerLine=component.blocksPerLine,blocksPerColumn=component.blocksPerColumn,samplesPerLine=blocksPerLine<<3,R=new Int32Array(64),r=new Uint8Array(64);requestMemoryAllocation(samplesPerLine*blocksPerColumn*8);for(var blockRow=0;blockRow<blocksPerColumn;blockRow++){var scanLine=blockRow<<3;for(i=0;i<8;i++)lines.push(new Uint8Array(samplesPerLine));for(var blockCol=0;blockCol<blocksPerLine;blockCol++){!function(zz,dataOut,dataIn){for(var v0,v1,v2,v3,v4,v5,v6,v7,t,qt=component.quantizationTable,p=dataIn,i=0;i<64;i++)p[i]=zz[i]*qt[i];for(i=0;i<8;++i){var row=8*i;0==p[1+row]&&0==p[2+row]&&0==p[3+row]&&0==p[4+row]&&0==p[5+row]&&0==p[6+row]&&0==p[7+row]?(t=5793*p[0+row]+512>>10,p[0+row]=t,p[1+row]=t,p[2+row]=t,p[3+row]=t,p[4+row]=t,p[5+row]=t,p[6+row]=t,p[7+row]=t):(v0=5793*p[0+row]+128>>8,v1=5793*p[4+row]+128>>8,v2=p[2+row],v3=p[6+row],v4=2896*(p[1+row]-p[7+row])+128>>8,v7=2896*(p[1+row]+p[7+row])+128>>8,v5=p[3+row]<<4,t=v0-v1+1>>1,v0=v0+v1+1>>1,v1=t,t=3784*v2+1567*v3+128>>8,v2=1567*v2-3784*v3+128>>8,v3=t,t=v4-(v6=p[5+row]<<4)+1>>1,v4=v4+v6+1>>1,v6=t,t=v7+v5+1>>1,v5=v7-v5+1>>1,v7=t,t=v0-v3+1>>1,v0=v0+v3+1>>1,v3=t,t=v1-v2+1>>1,v1=v1+v2+1>>1,v2=t,t=2276*v4+3406*v7+2048>>12,v4=3406*v4-2276*v7+2048>>12,v7=t,t=799*v5+4017*v6+2048>>12,v5=4017*v5-799*v6+2048>>12,v6=t,p[0+row]=v0+v7,p[7+row]=v0-v7,p[1+row]=v1+v6,p[6+row]=v1-v6,p[2+row]=v2+v5,p[5+row]=v2-v5,p[3+row]=v3+v4,p[4+row]=v3-v4)}for(i=0;i<8;++i){var col=i;0==p[8+col]&&0==p[16+col]&&0==p[24+col]&&0==p[32+col]&&0==p[40+col]&&0==p[48+col]&&0==p[56+col]?(t=5793*dataIn[i+0]+8192>>14,p[0+col]=t,p[8+col]=t,p[16+col]=t,p[24+col]=t,p[32+col]=t,p[40+col]=t,p[48+col]=t,p[56+col]=t):(v0=5793*p[0+col]+2048>>12,v1=5793*p[32+col]+2048>>12,v2=p[16+col],v3=p[48+col],v4=2896*(p[8+col]-p[56+col])+2048>>12,v7=2896*(p[8+col]+p[56+col])+2048>>12,v5=p[24+col],t=v0-v1+1>>1,v0=v0+v1+1>>1,v1=t,t=3784*v2+1567*v3+2048>>12,v2=1567*v2-3784*v3+2048>>12,v3=t,t=v4-(v6=p[40+col])+1>>1,v4=v4+v6+1>>1,v6=t,t=v7+v5+1>>1,v5=v7-v5+1>>1,v7=t,t=v0-v3+1>>1,v0=v0+v3+1>>1,v3=t,t=v1-v2+1>>1,v1=v1+v2+1>>1,v2=t,t=2276*v4+3406*v7+2048>>12,v4=3406*v4-2276*v7+2048>>12,v7=t,t=799*v5+4017*v6+2048>>12,v5=4017*v5-799*v6+2048>>12,v6=t,p[0+col]=v0+v7,p[56+col]=v0-v7,p[8+col]=v1+v6,p[48+col]=v1-v6,p[16+col]=v2+v5,p[40+col]=v2-v5,p[24+col]=v3+v4,p[32+col]=v3-v4)}for(i=0;i<64;++i){var sample=128+(p[i]+8>>4);dataOut[i]=sample<0?0:255<sample?255:sample}}(component.blocks[blockRow][blockCol],r,R);for(var offset=0,sample=blockCol<<3,j=0;j<8;j++)for(var line=lines[scanLine+j],i=0;i<8;i++)line[sample+i]=r[offset++]}}return lines}function clampTo8bit(a){return a<0?0:255<a?255:a}function requestMemoryAllocation(increaseAmount=0){var exceededAmount,increaseAmount=totalBytesAllocated+increaseAmount;if(maxMemoryUsageBytes<increaseAmount)throw exceededAmount=Math.ceil((increaseAmount-maxMemoryUsageBytes)/1024/1024),new Error(`maxMemoryUsageInMB limit exceeded by at least ${exceededAmount}MB`);totalBytesAllocated=increaseAmount}module.exports=function(jpegData,userOpts={}){var userOpts={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...userOpts},jpegData=new Uint8Array(jpegData),decoder=new JpegImage,jpegData=(decoder.opts=userOpts,JpegImage.resetMaxMemoryUsage(1024*userOpts.maxMemoryUsageInMB*1024),decoder.parse(jpegData),userOpts.formatAsRGBA?4:3),jpegData=decoder.width*decoder.height*jpegData;try{JpegImage.requestMemoryAllocation(jpegData);var image={width:decoder.width,height:decoder.height,exifBuffer:decoder.exifBuffer,data:userOpts.useTArray?new Uint8Array(jpegData):Buffer.alloc(jpegData)};0<decoder.comments.length&&(image.comments=decoder.comments)}catch(err){throw err instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+jpegData):err}return decoder.copyToImageData(image,userOpts.formatAsRGBA),image}})},webp={encode:function(Module){(Module=void 0!==(Module=Module||{})?Module:{}).ready=new Promise(function(resolve,reject){readyPromiseResolve=resolve,readyPromiseReject=reject});var readyPromiseResolve,readyPromiseReject,key,moduleOverrides={};for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_WORKER=!0,scriptDirectory="";scriptDirectory=self.location.href;var wasmBinary,scriptDirectory=0!==(scriptDirectory="codecs/webp/enc/webp_enc.js").indexOf("blob:")?scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1):"",readBinary=function(url){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!1),xhr.responseType="arraybuffer",xhr.send(null),new Uint8Array(xhr.response)},err=(Module.print||console.log.bind(console),Module.printErr||console.warn.bind(console));for(key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=null,Module.arguments&&Module.arguments,Module.thisProgram&&Module.thisProgram,Module.quit&&Module.quit,Module.wasmBinary&&(wasmBinary=Module.wasmBinary);Module.noExitRuntime;"object"!=typeof WebAssembly&&abort("no native wasm support detected");var wasmMemory,ABORT=!1,UTF8Decoder=new TextDecoder("utf8");function stringToUTF8(str,outPtr,maxBytesToWrite){!function(str,heap,outIdx,maxBytesToWrite){if(!(0<maxBytesToWrite))return;for(var endIdx=outIdx+maxBytesToWrite-1,i=0;i<str.length;++i){var u=str.charCodeAt(i);if((u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&str.charCodeAt(++i):u)<=127){if(endIdx<=outIdx)break;heap[outIdx++]=u}else if(u<=2047){if(endIdx<=outIdx+1)break;heap[outIdx++]=192|u>>6,heap[outIdx++]=128|63&u}else if(u<=65535){if(endIdx<=outIdx+2)break;heap[outIdx++]=224|u>>12,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}else{if(endIdx<=outIdx+3)break;heap[outIdx++]=240|u>>18,heap[outIdx++]=128|u>>12&63,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}}heap[outIdx]=0}(str,HEAPU8,outPtr,maxBytesToWrite)}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,UTF16Decoder=new TextDecoder("utf-16le");function UTF16ToString(ptr,maxBytesToRead){for(var idx=ptr>>1,maxIdx=idx+maxBytesToRead/2;!(maxIdx<=idx)&&HEAPU16[idx];)++idx;return UTF16Decoder.decode(HEAPU8.subarray(ptr,idx<<1))}function stringToUTF16(str,outPtr,maxBytesToWrite){if((maxBytesToWrite=void 0===maxBytesToWrite?2147483647:maxBytesToWrite)<2)return 0;for(var startPtr=outPtr,numCharsToWrite=(maxBytesToWrite-=2)<2*str.length?maxBytesToWrite/2:str.length,i=0;i<numCharsToWrite;++i){var codeUnit=str.charCodeAt(i);HEAP16[outPtr>>1]=codeUnit,outPtr+=2}return HEAP16[outPtr>>1]=0,outPtr-startPtr}function lengthBytesUTF16(str){return 2*str.length}function UTF32ToString(ptr,maxBytesToRead){for(var i=0,str="";!(maxBytesToRead/4<=i);){var ch,utf32=HEAP32[ptr+4*i>>2];if(0==utf32)break;++i,65536<=utf32?(ch=utf32-65536,str+=String.fromCharCode(55296|ch>>10,56320|1023&ch)):str+=String.fromCharCode(utf32)}return str}function stringToUTF32(str,outPtr,maxBytesToWrite){if((maxBytesToWrite=void 0===maxBytesToWrite?2147483647:maxBytesToWrite)<4)return 0;for(var startPtr=outPtr,endPtr=startPtr+maxBytesToWrite-4,i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(55296<=codeUnit&&codeUnit<=57343&&(codeUnit=65536+((1023&codeUnit)<<10)|1023&str.charCodeAt(++i)),HEAP32[outPtr>>2]=codeUnit,endPtr<(outPtr+=4)+4)break}return HEAP32[outPtr>>2]=0,outPtr-startPtr}function lengthBytesUTF32(str){for(var len=0,i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);55296<=codeUnit&&codeUnit<=57343&&++i,len+=4}return len}function updateGlobalBufferAndViews(buf){buffer=buf,Module.HEAP8=HEAP8=new Int8Array(buf),Module.HEAP16=HEAP16=new Int16Array(buf),Module.HEAP32=HEAP32=new Int32Array(buf),Module.HEAPU8=HEAPU8=new Uint8Array(buf),Module.HEAPU16=HEAPU16=new Uint16Array(buf),Module.HEAPU32=HEAPU32=new Uint32Array(buf),Module.HEAPF32=HEAPF32=new Float32Array(buf),Module.HEAPF64=HEAPF64=new Float64Array(buf)}Module.INITIAL_MEMORY;var wasmTable,__ATPRERUN__=[],__ATINIT__=[],__ATPOSTRUN__=[];function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)cb=Module.preRun.shift(),__ATPRERUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPRERUN__)}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)cb=Module.postRun.shift(),__ATPOSTRUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPOSTRUN__)}var runDependencies=0,dependenciesFulfilled=null;function abort(what){Module.onAbort&&Module.onAbort(what),err(what+=""),ABORT=!0,what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";what=new WebAssembly.RuntimeError(what);throw readyPromiseReject(what),what}Module.preloadedImages={},Module.preloadedAudios={};var wasmBinaryFile,path;function isDataURI(filename){return filename.startsWith("data:application/octet-stream;base64,")}function getBinary(file){try{return file==wasmBinaryFile&&wasmBinary?new Uint8Array(wasmBinary):readBinary(file)}catch(err){abort(err)}}function callRuntimeCallbacks(callbacks){for(;0<callbacks.length;){var func,callback=callbacks.shift();"function"==typeof callback?callback(Module):"number"==typeof(func=callback.func)?void 0===callback.arg?wasmTable.get(func)():wasmTable.get(func)(callback.arg):func(void 0===callback.arg?null:callback.arg)}}Module.locateFile?isDataURI(wasmBinaryFile="webp_enc.wasm")||(path=wasmBinaryFile,wasmBinaryFile=Module.locateFile?Module.locateFile(path,scriptDirectory):scriptDirectory+path):wasmBinaryFile=new URL("webp_enc.wasm","codecs/webp/enc/webp_enc.js").toString();var structRegistrations={};function runDestructors(destructors){for(;destructors.length;){var ptr=destructors.pop();destructors.pop()(ptr)}}function simpleReadValueFromPointer(pointer){return this.fromWireType(HEAPU32[pointer>>2])}var awaitingDependencies={},registeredTypes={},typeDependencies={},char_0=48,char_9=57;function makeLegalFunctionName(name){if(void 0===name)return"_unknown";var f=(name=name.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return char_0<=f&&f<=char_9?"_"+name:name}function createNamedFunction(name,body){return name=makeLegalFunctionName(name),new Function("body","return function "+name+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(body)}function extendError(baseErrorType,errorName){var errorClass=createNamedFunction(errorName,function(message){this.name=errorName,this.message=message;message=new Error(message).stack;void 0!==message&&(this.stack=this.toString()+"\n"+message.replace(/^Error(:[^\n]*)?\n/,""))});return errorClass.prototype=Object.create(baseErrorType.prototype),(errorClass.prototype.constructor=errorClass).prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},errorClass}var InternalError=void 0;function throwInternalError(message){throw new InternalError(message)}function whenDependentTypesAreResolved(myTypes,dependentTypes,getTypeConverters){function onComplete(typeConverters){var myTypeConverters=getTypeConverters(typeConverters);myTypeConverters.length!==myTypes.length&&throwInternalError("Mismatched type converter count");for(var i=0;i<myTypes.length;++i)registerType(myTypes[i],myTypeConverters[i])}myTypes.forEach(function(type){typeDependencies[type]=dependentTypes});var typeConverters=new Array(dependentTypes.length),unregisteredTypes=[],registered=0;dependentTypes.forEach(function(dt,i){registeredTypes.hasOwnProperty(dt)?typeConverters[i]=registeredTypes[dt]:(unregisteredTypes.push(dt),awaitingDependencies.hasOwnProperty(dt)||(awaitingDependencies[dt]=[]),awaitingDependencies[dt].push(function(){typeConverters[i]=registeredTypes[dt],++registered===unregisteredTypes.length&&onComplete(typeConverters)}))}),0===unregisteredTypes.length&&onComplete(typeConverters)}function getShiftFromSize(size){switch(size){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+size)}}var embind_charCodes=void 0;function readLatin1String(ptr){for(var ret="",c=ptr;HEAPU8[c];)ret+=embind_charCodes[HEAPU8[c++]];return ret}var BindingError=void 0;function throwBindingError(message){throw new BindingError(message)}function registerType(rawType,registeredInstance,options){if(options=options||{},!("argPackAdvance"in registeredInstance))throw new TypeError("registerType registeredInstance requires argPackAdvance");var name=registeredInstance.name;if(rawType||throwBindingError('type "'+name+'" must have a positive integer typeid pointer'),registeredTypes.hasOwnProperty(rawType)){if(options.ignoreDuplicateRegistrations)return;throwBindingError("Cannot register type '"+name+"' twice")}registeredTypes[rawType]=registeredInstance,delete typeDependencies[rawType],awaitingDependencies.hasOwnProperty(rawType)&&(options=awaitingDependencies[rawType],delete awaitingDependencies[rawType],options.forEach(function(cb){cb()}))}var emval_free_list=[],emval_handle_array=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function __emval_decref(handle){4<handle&&0==--emval_handle_array[handle].refcount&&(emval_handle_array[handle]=void 0,emval_free_list.push(handle))}function count_emval_handles(){for(var count=0,i=5;i<emval_handle_array.length;++i)void 0!==emval_handle_array[i]&&++count;return count}function get_first_emval(){for(var i=5;i<emval_handle_array.length;++i)if(void 0!==emval_handle_array[i])return emval_handle_array[i];return null}function __emval_register(value){switch(value){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var handle=emval_free_list.length?emval_free_list.pop():emval_handle_array.length;return emval_handle_array[handle]={refcount:1,value:value},handle}}function exposePublicSymbol(name,value,numArguments){var proto,methodName,humanName,prevFunc;Module.hasOwnProperty(name)?((void 0===numArguments||void 0!==Module[name].overloadTable&&void 0!==Module[name].overloadTable[numArguments])&&throwBindingError("Cannot register public name '"+name+"' twice"),humanName=methodName=name,void 0===(proto=Module)[methodName].overloadTable&&(prevFunc=proto[methodName],proto[methodName]=function(){return proto[methodName].overloadTable.hasOwnProperty(arguments.length)||throwBindingError("Function '"+humanName+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+proto[methodName].overloadTable+")!"),proto[methodName].overloadTable[arguments.length].apply(this,arguments)},proto[methodName].overloadTable=[],proto[methodName].overloadTable[prevFunc.argCount]=prevFunc),Module.hasOwnProperty(numArguments)&&throwBindingError("Cannot register multiple overloads of a function with the same number of arguments ("+numArguments+")!"),Module[name].overloadTable[numArguments]=value):(Module[name]=value,void 0!==numArguments&&(Module[name].numArguments=numArguments))}function getTypeName(type){var type=___getTypeName(type),rv=readLatin1String(type);return _free(type),rv}function requireRegisteredType(rawType,humanName){var impl=registeredTypes[rawType];return void 0===impl&&throwBindingError(humanName+" has unknown type "+getTypeName(rawType)),impl}function _embind_repr(v){if(null===v)return"null";var t=typeof v;return"object"==t||"array"==t||"function"==t?v.toString():""+v}function craftInvokerFunction(humanName,argTypes,classType,cppInvokerFunc,cppTargetFunc){for(var argCount=argTypes.length,classType=(argCount<2&&throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!"),null!==argTypes[1]&&null!==classType),needsDestructorStack=!1,i=1;i<argTypes.length;++i)if(null!==argTypes[i]&&void 0===argTypes[i].destructorFunction){needsDestructorStack=!0;break}for(var returns="void"!==argTypes[0].name,argsList="",argsListWired="",i=0;i<argCount-2;++i)argsList+=(0!==i?", ":"")+"arg"+i,argsListWired+=(0!==i?", ":"")+"arg"+i+"Wired";var invokerFnBody="return function "+makeLegalFunctionName(humanName)+"("+argsList+") {\nif (arguments.length !== "+(argCount-2)+") {\nthrowBindingError('function "+humanName+" called with ' + arguments.length + ' arguments, expected "+(argCount-2)+" args!');\n}\n",dtorStack=(needsDestructorStack&&(invokerFnBody+="var destructors = [];\n"),needsDestructorStack?"destructors":"null"),args1=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],args2=[throwBindingError,cppInvokerFunc,cppTargetFunc,runDestructors,argTypes[0],argTypes[1]];classType&&(invokerFnBody+="var thisWired = classParam.toWireType("+dtorStack+", this);\n");for(i=0;i<argCount-2;++i)invokerFnBody+="var arg"+i+"Wired = argType"+i+".toWireType("+dtorStack+", arg"+i+"); // "+argTypes[i+2].name+"\n",args1.push("argType"+i),args2.push(argTypes[i+2]);if(invokerFnBody+=(returns?"var rv = ":"")+"invoker(fn"+(0<(argsListWired=classType?"thisWired"+(0<argsListWired.length?", ":"")+argsListWired:argsListWired).length?", ":"")+argsListWired+");\n",needsDestructorStack)invokerFnBody+="runDestructors(destructors);\n";else for(i=classType?1:2;i<argTypes.length;++i){var paramName=1===i?"thisWired":"arg"+(i-2)+"Wired";null!==argTypes[i].destructorFunction&&(invokerFnBody+=paramName+"_dtor("+paramName+"); // "+argTypes[i].name+"\n",args1.push(paramName+"_dtor"),args2.push(argTypes[i].destructorFunction))}return returns&&(invokerFnBody+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),args1.push(invokerFnBody+="}\n"),function(constructor,argumentList){if(!(constructor instanceof Function))throw new TypeError("new_ called with constructor type "+typeof constructor+" which is not a function");(dummy=createNamedFunction(constructor.name||"unknownFunctionName",function(){})).prototype=constructor.prototype;var dummy=new dummy;return(constructor=constructor.apply(dummy,argumentList))instanceof Object?constructor:dummy}(Function,args1).apply(null,args2)}function dynCall(sig,ptr,args){return sig.includes("j")?function(sig,ptr,args){return sig=Module["dynCall_"+sig],args&&args.length?sig.apply(null,[ptr].concat(args)):sig.call(null,ptr)}(sig,ptr,args):wasmTable.get(ptr).apply(null,args)}function embind__requireFunction(signature,rawFunction){var sig,ptr,argCache,fp=(signature=readLatin1String(signature)).includes("j")?(sig=signature,ptr=rawFunction,argCache=[],function(){argCache.length=arguments.length;for(var i=0;i<arguments.length;i++)argCache[i]=arguments[i];return dynCall(sig,ptr,argCache)}):wasmTable.get(rawFunction);return"function"!=typeof fp&&throwBindingError("unknown function pointer with signature "+signature+": "+rawFunction),fp}var UnboundTypeError=void 0;function throwUnboundTypeError(message,types){var unboundTypes=[],seen={};throw types.forEach(function visit(type){seen[type]||registeredTypes[type]||(typeDependencies[type]?typeDependencies[type].forEach(visit):(unboundTypes.push(type),seen[type]=!0))}),new UnboundTypeError(message+": "+unboundTypes.map(getTypeName).join([", "]))}var emval_symbols={};function emval_get_global(){return"object"==typeof globalThis?globalThis:Function("return this")()}var emval_newers={};for(var InternalError=Module.InternalError=extendError(Error,"InternalError"),codes=new Array(256),i=0;i<256;++i)codes[i]=String.fromCharCode(i);embind_charCodes=codes,BindingError=Module.BindingError=extendError(Error,"BindingError"),Module.count_emval_handles=count_emval_handles,Module.get_first_emval=get_first_emval;var calledRun,UnboundTypeError=Module.UnboundTypeError=extendError(Error,"UnboundTypeError"),asmLibraryArg={w:function(a0,a1){},l:function(structType){var reg=structRegistrations[structType],rawConstructor=(delete structRegistrations[structType],reg.rawConstructor),rawDestructor=reg.rawDestructor,fieldRecords=reg.fields;whenDependentTypesAreResolved([structType],fieldRecords.map(function(field){return field.getterReturnType}).concat(fieldRecords.map(function(field){return field.setterArgumentType})),function(fieldTypes){var fields={};return fieldRecords.forEach(function(field,i){var fieldName=field.fieldName,getterReturnType=fieldTypes[i],getter=field.getter,getterContext=field.getterContext,setterArgumentType=fieldTypes[i+fieldRecords.length],setter=field.setter,setterContext=field.setterContext;fields[fieldName]={read:function(ptr){return getterReturnType.fromWireType(getter(getterContext,ptr))},write:function(ptr,o){var destructors=[];setter(setterContext,ptr,setterArgumentType.toWireType(destructors,o)),runDestructors(destructors)}}}),[{name:reg.name,fromWireType:function(ptr){var i,rv={};for(i in fields)rv[i]=fields[i].read(ptr);return rawDestructor(ptr),rv},toWireType:function(destructors,o){for(var fieldName in fields)if(!(fieldName in o))throw new TypeError('Missing field:  "'+fieldName+'"');var ptr=rawConstructor();for(fieldName in fields)fields[fieldName].write(ptr,o[fieldName]);return null!==destructors&&destructors.push(rawDestructor,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:rawDestructor}]})},p:function(primitiveType,name,size,minRange,maxRange){},s:function(rawType,name,size,trueValue,falseValue){var shift=getShiftFromSize(size);registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(wt){return!!wt},toWireType:function(destructors,o){return o?trueValue:falseValue},argPackAdvance:8,readValueFromPointer:function(pointer){var heap;if(1===size)heap=HEAP8;else if(2===size)heap=HEAP16;else{if(4!==size)throw new TypeError("Unknown boolean type size: "+name);heap=HEAP32}return this.fromWireType(heap[pointer>>shift])},destructorFunction:null})},r:function(rawType,name){registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(handle){var rv=emval_handle_array[handle].value;return __emval_decref(handle),rv},toWireType:function(destructors,value){return __emval_register(value)},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:null})},n:function(rawType,name,size,isSigned){function ctor(){}size=getShiftFromSize(size),name=readLatin1String(name),ctor.values={},registerType(rawType,{name:name,constructor:ctor,fromWireType:function(c){return this.constructor.values[c]},toWireType:function(destructors,c){return c.value},argPackAdvance:8,readValueFromPointer:function(name,shift,signed){switch(shift){case 0:return function(pointer){var heap=signed?HEAP8:HEAPU8;return this.fromWireType(heap[pointer])};case 1:return function(pointer){var heap=signed?HEAP16:HEAPU16;return this.fromWireType(heap[pointer>>1])};case 2:return function(pointer){var heap=signed?HEAP32:HEAPU32;return this.fromWireType(heap[pointer>>2])};default:throw new TypeError("Unknown integer type: "+name)}}(name,size,isSigned),destructorFunction:null}),exposePublicSymbol(name,ctor)},d:function(rawEnumType,name,enumValue){var rawEnumType=requireRegisteredType(rawEnumType,"enum"),Enum=(name=readLatin1String(name),rawEnumType.constructor),rawEnumType=Object.create(rawEnumType.constructor.prototype,{value:{value:enumValue},constructor:{value:createNamedFunction(rawEnumType.name+"_"+name,function(){})}});Enum.values[enumValue]=rawEnumType,Enum[name]=rawEnumType},j:function(rawType,name,size){size=getShiftFromSize(size),registerType(rawType,{name:name=readLatin1String(name),fromWireType:function(value){return value},toWireType:function(destructors,value){if("number"!=typeof value&&"boolean"!=typeof value)throw new TypeError('Cannot convert "'+_embind_repr(value)+'" to '+this.name);return value},argPackAdvance:8,readValueFromPointer:function(name,shift){switch(shift){case 2:return function(pointer){return this.fromWireType(HEAPF32[pointer>>2])};case 3:return function(pointer){return this.fromWireType(HEAPF64[pointer>>3])};default:throw new TypeError("Unknown float type: "+name)}}(name,size),destructorFunction:null})},h:function(name,argCount,rawArgTypesAddr,signature,rawInvoker,fn){var argTypes=function(count,firstElement){for(var array=[],i=0;i<count;i++)array.push(HEAP32[(firstElement>>2)+i]);return array}(argCount,rawArgTypesAddr);name=readLatin1String(name),rawInvoker=embind__requireFunction(signature,rawInvoker),exposePublicSymbol(name,function(){throwUnboundTypeError("Cannot call "+name+" due to unbound types",argTypes)},argCount-1),whenDependentTypesAreResolved([],argTypes,function(argTypes){argTypes=[argTypes[0],null].concat(argTypes.slice(1));return function(name,value,numArguments){Module.hasOwnProperty(name)||throwInternalError("Replacing nonexistant public symbol"),void 0!==Module[name].overloadTable&&void 0!==numArguments?Module[name].overloadTable[numArguments]=value:(Module[name]=value,Module[name].argCount=numArguments)}(name,craftInvokerFunction(name,argTypes,null,rawInvoker,fn),argCount-1),[]})},c:function(primitiveType,name,size,minRange,maxRange){name=readLatin1String(name),-1===maxRange&&(maxRange=4294967295);var bitshift,shift=getShiftFromSize(size),fromWireType=function(value){return value},isUnsignedType=(0===minRange&&(bitshift=32-8*size,fromWireType=function(value){return value<<bitshift>>>bitshift}),name.includes("unsigned"));registerType(primitiveType,{name:name,fromWireType:fromWireType,toWireType:function(destructors,value){if("number"!=typeof value&&"boolean"!=typeof value)throw new TypeError('Cannot convert "'+_embind_repr(value)+'" to '+this.name);if(value<minRange||maxRange<value)throw new TypeError('Passing a number "'+_embind_repr(value)+'" from JS side to C/C++ side to an argument of type "'+name+'", which is outside the valid range ['+minRange+", "+maxRange+"]!");return isUnsignedType?value>>>0:0|value},argPackAdvance:8,readValueFromPointer:function(name,shift,signed){switch(shift){case 0:return signed?function(pointer){return HEAP8[pointer]}:function(pointer){return HEAPU8[pointer]};case 1:return signed?function(pointer){return HEAP16[pointer>>1]}:function(pointer){return HEAPU16[pointer>>1]};case 2:return signed?function(pointer){return HEAP32[pointer>>2]}:function(pointer){return HEAPU32[pointer>>2]};default:throw new TypeError("Unknown integer type: "+name)}}(name,shift,0!==minRange),destructorFunction:null})},b:function(rawType,dataTypeIndex,name){var TA=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][dataTypeIndex];function decodeMemoryView(handle){var heap=HEAPU32,size=heap[handle>>=2],heap=heap[handle+1];return new TA(buffer,heap,size)}registerType(rawType,{name:name=readLatin1String(name),fromWireType:decodeMemoryView,argPackAdvance:8,readValueFromPointer:decodeMemoryView},{ignoreDuplicateRegistrations:!0})},k:function(rawType,name){var stdStringIsUTF8="std::string"===(name=readLatin1String(name));registerType(rawType,{name:name,fromWireType:function(value){var length=HEAPU32[value>>2];if(stdStringIsUTF8)for(var decodeStartPtr=value+4,i=0;i<=length;++i){var stringSegment,str,currentBytePtr=value+4+i;i!=length&&0!=HEAPU8[currentBytePtr]||(stringSegment=function(ptr,maxBytesToRead){if(!ptr)return"";for(var maxPtr=ptr+maxBytesToRead,end=ptr;!(maxPtr<=end)&&HEAPU8[end];)++end;return UTF8Decoder.decode(HEAPU8.subarray(ptr,end))}(decodeStartPtr,currentBytePtr-decodeStartPtr),str=void 0===str?stringSegment:str+String.fromCharCode(0)+stringSegment,decodeStartPtr=currentBytePtr+1)}else{for(var a=new Array(length),i=0;i<length;++i)a[i]=String.fromCharCode(HEAPU8[value+4+i]);str=a.join("")}return _free(value),str},toWireType:function(destructors,value){var valueIsOfTypeString="string"==typeof(value=value instanceof ArrayBuffer?new Uint8Array(value):value),length=(valueIsOfTypeString||value instanceof Uint8Array||value instanceof Uint8ClampedArray||value instanceof Int8Array||throwBindingError("Cannot pass non-string to std::string"),(stdStringIsUTF8&&valueIsOfTypeString?function(){for(var str=value,len=0,i=0;i<str.length;++i){var u=str.charCodeAt(i);(u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&str.charCodeAt(++i):u)<=127?++len:len+=u<=2047?2:u<=65535?3:4}return len}:function(){return value.length})()),ptr=_malloc(4+length+1);if(HEAPU32[ptr>>2]=length,stdStringIsUTF8&&valueIsOfTypeString)stringToUTF8(value,ptr+4,length+1);else if(valueIsOfTypeString)for(var i=0;i<length;++i){var charCode=value.charCodeAt(i);255<charCode&&(_free(ptr),throwBindingError("String has UTF-16 code units that do not fit in 8 bits")),HEAPU8[ptr+4+i]=charCode}else for(i=0;i<length;++i)HEAPU8[ptr+4+i]=value[i];return null!==destructors&&destructors.push(_free,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(ptr){_free(ptr)}})},g:function(rawType,charSize,name){var decodeString,encodeString,getHeap,lengthBytesUTF,shift;name=readLatin1String(name),2===charSize?(decodeString=UTF16ToString,encodeString=stringToUTF16,lengthBytesUTF=lengthBytesUTF16,getHeap=function(){return HEAPU16},shift=1):4===charSize&&(decodeString=UTF32ToString,encodeString=stringToUTF32,lengthBytesUTF=lengthBytesUTF32,getHeap=function(){return HEAPU32},shift=2),registerType(rawType,{name:name,fromWireType:function(value){for(var length=HEAPU32[value>>2],HEAP=getHeap(),decodeStartPtr=value+4,i=0;i<=length;++i){var stringSegment,str,currentBytePtr=value+4+i*charSize;i!=length&&0!=HEAP[currentBytePtr>>shift]||(stringSegment=decodeString(decodeStartPtr,currentBytePtr-decodeStartPtr),str=void 0===str?stringSegment:str+String.fromCharCode(0)+stringSegment,decodeStartPtr=currentBytePtr+charSize)}return _free(value),str},toWireType:function(destructors,value){"string"!=typeof value&&throwBindingError("Cannot pass non-string to C++ string type "+name);var length=lengthBytesUTF(value),ptr=_malloc(4+length+charSize);return HEAPU32[ptr>>2]=length>>shift,encodeString(value,ptr+4,length+charSize),null!==destructors&&destructors.push(_free,ptr),ptr},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(ptr){_free(ptr)}})},m:function(rawType,name,constructorSignature,rawConstructor,destructorSignature,rawDestructor){structRegistrations[rawType]={name:readLatin1String(name),rawConstructor:embind__requireFunction(constructorSignature,rawConstructor),rawDestructor:embind__requireFunction(destructorSignature,rawDestructor),fields:[]}},a:function(structType,fieldName,getterReturnType,getterSignature,getter,getterContext,setterArgumentType,setterSignature,setter,setterContext){structRegistrations[structType].fields.push({fieldName:readLatin1String(fieldName),getterReturnType:getterReturnType,getter:embind__requireFunction(getterSignature,getter),getterContext:getterContext,setterArgumentType:setterArgumentType,setter:embind__requireFunction(setterSignature,setter),setterContext:setterContext})},t:function(rawType,name){registerType(rawType,{isVoid:!0,name:name=readLatin1String(name),argPackAdvance:0,fromWireType:function(){},toWireType:function(destructors,o){}})},f:__emval_decref,v:function(name){return 0===name?__emval_register(emval_get_global()):(name=void 0===(symbol=emval_symbols[address=name])?readLatin1String(address):symbol,__emval_register(emval_get_global()[name]));var address,symbol},u:function(handle){4<handle&&(emval_handle_array[handle].refcount+=1)},o:function(handle,argCount,argTypes,args){handle=function(handle){return handle||throwBindingError("Cannot use deleted val. handle = "+handle),emval_handle_array[handle].value}(handle);var newer=emval_newers[argCount];return newer||(newer=function(argCount){for(var argsList="",i=0;i<argCount;++i)argsList+=(0!==i?", ":"")+"arg"+i;for(var functionBody="return function emval_allocator_"+argCount+"(constructor, argTypes, args) {\n",i=0;i<argCount;++i)functionBody+="var argType"+i+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+i+'], "parameter '+i+'");\nvar arg'+i+" = argType"+i+".readValueFromPointer(args);\nargs += argType"+i+"['argPackAdvance'];\n";return functionBody+="var obj = new constructor("+argsList+");\nreturn __emval_register(obj);\n}\n",new Function("requireRegisteredType","Module","__emval_register",functionBody)(requireRegisteredType,Module,__emval_register)}(argCount),emval_newers[argCount]=newer),newer(handle,argTypes,args)},i:function(){abort()},q:function(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)},e:function(requestedSize){var oldSize=HEAPU8.length;if(2147483648<(requestedSize>>>=0))return!1;for(var multiple,cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown),overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);if(function(size){try{return wasmMemory.grow(size-buffer.byteLength+65535>>>16),updateGlobalBufferAndViews(wasmMemory.buffer),1}catch(e){}}(Math.min(2147483648,(0<(overGrownHeapSize=Math.max(requestedSize,overGrownHeapSize))%(multiple=65536)&&(overGrownHeapSize+=multiple-overGrownHeapSize%multiple),overGrownHeapSize))))return!0}return!1}},_malloc=(function(){var info={a:asmLibraryArg};function receiveInstance(instance,module){var instance=instance.exports;Module.asm=instance,updateGlobalBufferAndViews((wasmMemory=Module.asm.x).buffer),wasmTable=Module.asm.D,instance=Module.asm.y,__ATINIT__.unshift(instance),runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&dependenciesFulfilled&&(instance=dependenciesFulfilled,dependenciesFulfilled=null,instance())}function receiveInstantiationResult(result){receiveInstance(result.instance)}function instantiateArrayBuffer(receiver){return(!wasmBinary&&ENVIRONMENT_IS_WORKER&&"function"==typeof fetch?fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(response.ok)return response.arrayBuffer();throw"failed to load wasm binary file at '"+wasmBinaryFile+"'"}).catch(function(){return getBinary(wasmBinaryFile)}):Promise.resolve().then(function(){return getBinary(wasmBinaryFile)})).then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason),abort(reason)})}if(runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),Module.instantiateWasm)try{return Module.instantiateWasm(info,receiveInstance)}catch(e){return err("Module.instantiateWasm callback failed with error: "+e)}(wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(wasmBinaryFile)||"function"!=typeof fetch?instantiateArrayBuffer(receiveInstantiationResult):fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){return WebAssembly.instantiateStreaming(response,info).then(receiveInstantiationResult,function(reason){return err("wasm streaming compile failed: "+reason),err("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(receiveInstantiationResult)})})).catch(readyPromiseReject)}(),Module.___wasm_call_ctors=function(){return(Module.___wasm_call_ctors=Module.asm.y).apply(null,arguments)},Module._malloc=function(){return(_malloc=Module._malloc=Module.asm.z).apply(null,arguments)}),_free=Module._free=function(){return(_free=Module._free=Module.asm.A).apply(null,arguments)},___getTypeName=Module.___getTypeName=function(){return(___getTypeName=Module.___getTypeName=Module.asm.B).apply(null,arguments)};Module.___embind_register_native_and_builtin_types=function(){return(Module.___embind_register_native_and_builtin_types=Module.asm.C).apply(null,arguments)};function run(args){function doRun(){calledRun||(calledRun=!0,Module.calledRun=!0,ABORT||(callRuntimeCallbacks(__ATINIT__),readyPromiseResolve(Module),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}0<runDependencies||(preRun(),0<runDependencies||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),doRun()},1)):doRun()))}if(dependenciesFulfilled=function runCaller(){calledRun||run(),calledRun||(dependenciesFulfilled=runCaller)},Module.run=run,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);0<Module.preInit.length;)Module.preInit.pop()();return run(),Module.ready}},EncodeOptions={quality:75,baseline:!1,arithmetic:!1,progressive:!0,optimize_coding:!0,smoothing:0,color_space:3,quant_table:3,trellis_multipass:!1,trellis_opt_zero:!1,trellis_opt_table:!1,trellis_loops:1,auto_subsample:!0,chroma_subsample:2,separate_chroma_quality:!1,chroma_quality:75},encodeToJpg=async(imageData,codecs_path)=>{const encoderModule=await jpg.encode({locateFile:function(url){return url.endsWith(".wasm")?codecs_path+"mozjpeg/"+url:url}});return encoderModule.encode(imageData.data,imageData.width,imageData.height,EncodeOptions)},EncodeOptions$1={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0},encodeToWebp=async(imageData,codecs_path)=>{const encoderModule=await webp.encode({locateFile:function(url){return url.endsWith(".wasm")?codecs_path+"webp/"+url:url}});return encoderModule.encode(imageData.data,imageData.width,imageData.height,EncodeOptions$1)};var common=createCommonjsModule(function(module,exports){var TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(source){if("object"!=typeof source)throw new TypeError(source+"must be non-object");for(var p in source)!function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}(source,p)||(obj[p]=source[p])}}return obj},exports.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)dest.set(src.subarray(src_offs,src_offs+len),dest_offs);else for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){for(var pos,chunk,result,len=0,i=0,l=chunks.length;i<l;i++)len+=chunks[i].length;for(result=new Uint8Array(len),i=pos=0,l=chunks.length;i<l;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){on?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,fnTyped)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,fnUntyped))},exports.setTyped(TYPED_OK)}),Z_BINARY=0,Z_TEXT=1;function zero(buf){for(var len=buf.length;0<=--len;)buf[len]=0}var static_l_desc,static_d_desc,static_bl_desc,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],static_ltree=new Array(2*(L_CODES+2)),static_dtree=(zero(static_ltree),new Array(2*D_CODES)),_dist_code=(zero(static_dtree),new Array(512)),_length_code=(zero(_dist_code),new Array(256)),base_length=(zero(_length_code),new Array(LENGTH_CODES)),base_dist=(zero(base_length),new Array(D_CODES));function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree,this.extra_bits=extra_bits,this.extra_base=extra_base,this.elems=elems,this.max_length=max_length,this.has_stree=static_tree&&static_tree.length}function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree,this.max_code=0,this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=255&w,s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){s.bi_valid>Buf_size-length?(s.bi_buf|=value<<s.bi_valid&65535,put_short(s,s.bi_buf),s.bi_buf=value>>Buf_size-s.bi_valid,s.bi_valid+=length-Buf_size):(s.bi_buf|=value<<s.bi_valid&65535,s.bi_valid+=length)}function send_code(s,c,tree){send_bits(s,tree[2*c],tree[2*c+1])}function bi_reverse(code,len){for(var res=0;res|=1&code,code>>>=1,res<<=1,0<--len;);return res>>>1}function gen_codes(tree,max_code,bl_count){for(var n,next_code=new Array(MAX_BITS+1),code=0,bits=1;bits<=MAX_BITS;bits++)next_code[bits]=code=code+bl_count[bits-1]<<1;for(n=0;n<=max_code;n++){var len=tree[2*n+1];0!==len&&(tree[2*n]=bi_reverse(next_code[len]++,len))}}function init_block(s){for(var n=0;n<L_CODES;n++)s.dyn_ltree[2*n]=0;for(n=0;n<D_CODES;n++)s.dyn_dtree[2*n]=0;for(n=0;n<BL_CODES;n++)s.bl_tree[2*n]=0;s.dyn_ltree[2*END_BLOCK]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0}function bi_windup(s){8<s.bi_valid?put_short(s,s.bi_buf):0<s.bi_valid&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0}function smaller(tree,n,m,depth){var _n2=2*n,_m2=2*m;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){for(var v=s.heap[k],j=k<<1;j<=s.heap_len&&(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)&&j++,!smaller(tree,v,s.heap[j],s.depth));)s.heap[k]=s.heap[j],k=j,j<<=1;s.heap[k]=v}function compress_block(s,ltree,dtree){var dist,lc,code,extra,lx=0;if(0!==s.last_lit)for(;dist=s.pending_buf[s.d_buf+2*lx]<<8|s.pending_buf[s.d_buf+2*lx+1],lc=s.pending_buf[s.l_buf+lx],lx++,0==dist?send_code(s,lc,ltree):(send_code(s,(code=_length_code[lc])+LITERALS+1,ltree),0!==(extra=extra_lbits[code])&&send_bits(s,lc-=base_length[code],extra),send_code(s,code=d_code(--dist),dtree),0!==(extra=extra_dbits[code])&&send_bits(s,dist-=base_dist[code],extra)),lx<s.last_lit;);send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var n,m,node,tree=desc.dyn_tree,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,elems=desc.stat_desc.elems,max_code=-1;for(s.heap_len=0,s.heap_max=HEAP_SIZE,n=0;n<elems;n++)0!==tree[2*n]?(s.heap[++s.heap_len]=max_code=n,s.depth[n]=0):tree[2*n+1]=0;for(;s.heap_len<2;)tree[2*(node=s.heap[++s.heap_len]=max_code<2?++max_code:0)]=1,s.depth[node]=0,s.opt_len--,has_stree&&(s.static_len-=stree[2*node+1]);for(desc.max_code=max_code,n=s.heap_len>>1;1<=n;n--)pqdownheap(s,tree,n);for(node=elems;n=s.heap[1],s.heap[1]=s.heap[s.heap_len--],pqdownheap(s,tree,1),m=s.heap[1],s.heap[--s.heap_max]=n,s.heap[--s.heap_max]=m,tree[2*node]=tree[2*n]+tree[2*m],s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1,tree[2*n+1]=tree[2*m+1]=node,s.heap[1]=node++,pqdownheap(s,tree,1),2<=s.heap_len;);s.heap[--s.heap_max]=s.heap[1],function(s,desc){for(var h,n,m,xbits,f,tree=desc.dyn_tree,max_code=desc.max_code,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,extra=desc.stat_desc.extra_bits,base=desc.stat_desc.extra_base,max_length=desc.stat_desc.max_length,overflow=0,bits=0;bits<=MAX_BITS;bits++)s.bl_count[bits]=0;for(tree[2*s.heap[s.heap_max]+1]=0,h=s.heap_max+1;h<HEAP_SIZE;h++)max_length<(bits=tree[2*tree[2*(n=s.heap[h])+1]+1]+1)&&(bits=max_length,overflow++),tree[2*n+1]=bits,max_code<n||(s.bl_count[bits]++,xbits=0,base<=n&&(xbits=extra[n-base]),f=tree[2*n],s.opt_len+=f*(bits+xbits),has_stree&&(s.static_len+=f*(stree[2*n+1]+xbits)));if(0!==overflow){do{for(bits=max_length-1;0===s.bl_count[bits];)bits--}while(s.bl_count[bits]--,s.bl_count[bits+1]+=2,s.bl_count[max_length]--,0<(overflow-=2));for(bits=max_length;0!==bits;bits--)for(n=s.bl_count[bits];0!==n;)max_code<(m=s.heap[--h])||(tree[2*m+1]!==bits&&(s.opt_len+=(bits-tree[2*m+1])*tree[2*m],tree[2*m+1]=bits),n--)}}(s,desc),gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),tree[2*(max_code+1)+1]=65535,n=0;n<=max_code;n++)curlen=nextlen,nextlen=tree[2*(n+1)+1],++count<max_count&&curlen===nextlen||(count<min_count?s.bl_tree[2*curlen]+=count:0!==curlen?(curlen!==prevlen&&s.bl_tree[2*curlen]++,s.bl_tree[2*REP_3_6]++):count<=10?s.bl_tree[2*REPZ_3_10]++:s.bl_tree[2*REPZ_11_138]++,prevlen=curlen,min_count=(count=0)===nextlen?(max_count=138,3):curlen===nextlen?(max_count=6,3):(max_count=7,4))}function send_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),n=0;n<=max_code;n++)if(curlen=nextlen,nextlen=tree[2*(n+1)+1],!(++count<max_count&&curlen===nextlen)){if(count<min_count)for(;send_code(s,curlen,s.bl_tree),0!=--count;);else 0!==curlen?(curlen!==prevlen&&(send_code(s,curlen,s.bl_tree),count--),send_code(s,REP_3_6,s.bl_tree),send_bits(s,count-3,2)):count<=10?(send_code(s,REPZ_3_10,s.bl_tree),send_bits(s,count-3,3)):(send_code(s,REPZ_11_138,s.bl_tree),send_bits(s,count-11,7));prevlen=curlen,min_count=(count=0)===nextlen?(max_count=138,3):curlen===nextlen?(max_count=6,3):(max_count=7,4)}}zero(base_dist);var static_init_done=!1;function _tr_stored_block(s,buf,stored_len,last){send_bits(s,0+(last?1:0),3),function(s,buf,len,header){bi_windup(s),header&&(put_short(s,len),put_short(s,~len)),common.arraySet(s.pending_buf,s.window,buf,len,s.pending),s.pending+=len}(s,buf,stored_len,!0)}var trees={_tr_init:function(s){if(!static_init_done){for(var n,bits,dist,bl_count=new Array(MAX_BITS+1),length=0,code=0;code<LENGTH_CODES-1;code++)for(base_length[code]=length,n=0;n<1<<extra_lbits[code];n++)_length_code[length++]=code;for(_length_code[length-1]=code,code=dist=0;code<16;code++)for(base_dist[code]=dist,n=0;n<1<<extra_dbits[code];n++)_dist_code[dist++]=code;for(dist>>=7;code<D_CODES;code++)for(base_dist[code]=dist<<7,n=0;n<1<<extra_dbits[code]-7;n++)_dist_code[256+dist++]=code;for(bits=0;bits<=MAX_BITS;bits++)bl_count[bits]=0;for(n=0;n<=143;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(;n<=255;)static_ltree[2*n+1]=9,n++,bl_count[9]++;for(;n<=279;)static_ltree[2*n+1]=7,n++,bl_count[7]++;for(;n<=287;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(gen_codes(static_ltree,L_CODES+1,bl_count),n=0;n<D_CODES;n++)static_dtree[2*n+1]=5,static_dtree[2*n]=bi_reverse(n,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS),static_init_done=!0}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc),s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc),s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc),s.bi_buf=0,s.bi_valid=0,init_block(s)},_tr_stored_block:_tr_stored_block,_tr_flush_block:function(s,buf,stored_len,last){var opt_lenb,static_lenb,max_blindex=0;0<s.level?(2===s.strm.data_type&&(s.strm.data_type=function(s){for(var black_mask=4093624447,n=0;n<=31;n++,black_mask>>>=1)if(1&black_mask&&0!==s.dyn_ltree[2*n])return Z_BINARY;if(0!==s.dyn_ltree[18]||0!==s.dyn_ltree[20]||0!==s.dyn_ltree[26])return Z_TEXT;for(n=32;n<LITERALS;n++)if(0!==s.dyn_ltree[2*n])return Z_TEXT;return Z_BINARY}(s)),build_tree(s,s.l_desc),build_tree(s,s.d_desc),max_blindex=function(s){var max_blindex;for(scan_tree(s,s.dyn_ltree,s.l_desc.max_code),scan_tree(s,s.dyn_dtree,s.d_desc.max_code),build_tree(s,s.bl_desc),max_blindex=BL_CODES-1;3<=max_blindex&&0===s.bl_tree[2*bl_order[max_blindex]+1];max_blindex--);return s.opt_len+=3*(max_blindex+1)+5+5+4,max_blindex}(s),opt_lenb=s.opt_len+3+7>>>3,(static_lenb=s.static_len+3+7>>>3)<=opt_lenb&&(opt_lenb=static_lenb)):opt_lenb=static_lenb=stored_len+5,stored_len+4<=opt_lenb&&-1!==buf?_tr_stored_block(s,buf,stored_len,last):4===s.strategy||static_lenb===opt_lenb?(send_bits(s,2+(last?1:0),3),compress_block(s,static_ltree,static_dtree)):(send_bits(s,4+(last?1:0),3),function(s,lcodes,dcodes,blcodes){var rank;for(send_bits(s,lcodes-257,5),send_bits(s,dcodes-1,5),send_bits(s,blcodes-4,4),rank=0;rank<blcodes;rank++)send_bits(s,s.bl_tree[2*bl_order[rank]+1],3);send_tree(s,s.dyn_ltree,lcodes-1),send_tree(s,s.dyn_dtree,dcodes-1)}(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1),compress_block(s,s.dyn_ltree,s.dyn_dtree)),init_block(s),last&&bi_windup(s)},_tr_tally:function(s,dist,lc){return s.pending_buf[s.d_buf+2*s.last_lit]=dist>>>8&255,s.pending_buf[s.d_buf+2*s.last_lit+1]=255&dist,s.pending_buf[s.l_buf+s.last_lit]=255&lc,s.last_lit++,0===dist?s.dyn_ltree[2*lc]++:(s.matches++,dist--,s.dyn_ltree[2*(_length_code[lc]+LITERALS+1)]++,s.dyn_dtree[2*d_code(dist)]++),s.last_lit===s.lit_bufsize-1},_tr_align:function(s){send_bits(s,2,3),send_code(s,END_BLOCK,static_ltree),function(s){16===s.bi_valid?(put_short(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):8<=s.bi_valid&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)}(s)}};var adler32_1=function(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){for(len-=n=2e3<len?2e3:len;s2=s2+(s1=s1+buf[pos++]|0)|0,--n;);s1%=65521,s2%=65521}return s1|s2<<16|0};var crcTable=function(){for(var table=[],n=0;n<256;n++){for(var c=n,k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}();var crc32_1=function(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc},messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Z_NO_FLUSH=0,Z_FINISH=4,Z_OK=0,Z_STREAM_ERROR=-2,Z_DEFAULT_COMPRESSION=-1,Z_FIXED$1=4,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,L_CODES$1=286,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,INIT_STATE=42,BUSY_STATE=113,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4;function err(strm,errorCode){return strm.msg=messages[errorCode],errorCode}function rank(f){return(f<<1)-(4<f?9:0)}function zero$1(buf){for(var len=buf.length;0<=--len;)buf[len]=0}function flush_pending(strm){var s=strm.state,len=s.pending;0!==(len=len>strm.avail_out?strm.avail_out:len)&&(common.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out),strm.next_out+=len,s.pending_out+=len,strm.total_out+=len,strm.avail_out-=len,s.pending-=len,0===s.pending&&(s.pending_out=0))}function flush_block_only(s,last){trees._tr_flush_block(s,0<=s.block_start?s.block_start:-1,s.strstart-s.block_start,last),s.block_start=s.strstart,flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255,s.pending_buf[s.pending++]=255&b}function longest_match(s,cur_match){var match,len,chain_length=s.max_chain_length,scan=s.strstart,best_len=s.prev_length,nice_match=s.nice_match,limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0,_win=s.window,wmask=s.w_mask,prev=s.prev,strend=s.strstart+MAX_MATCH$1,scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len];s.prev_length>=s.good_match&&(chain_length>>=2),nice_match>s.lookahead&&(nice_match=s.lookahead);do{if(_win[(match=cur_match)+best_len]===scan_end&&_win[match+best_len-1]===scan_end1&&_win[match]===_win[scan]&&_win[++match]===_win[scan+1]){for(scan+=2,match++;_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend;);if(len=MAX_MATCH$1-(strend-scan),scan=strend-MAX_MATCH$1,best_len<len){if(s.match_start=cur_match,nice_match<=(best_len=len))break;scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len]}}}while((cur_match=prev[cur_match&wmask])>limit&&0!=--chain_length);return best_len<=s.lookahead?best_len:s.lookahead}function fill_window(s){var p,n,m,str,strm,buf,start,more,len,_w_size=s.w_size;do{if(more=s.window_size-s.lookahead-s.strstart,s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){for(common.arraySet(s.window,s.window,_w_size,_w_size,0),s.match_start-=_w_size,s.strstart-=_w_size,s.block_start-=_w_size,p=n=s.hash_size;m=s.head[--p],s.head[p]=_w_size<=m?m-_w_size:0,--n;);for(p=n=_w_size;m=s.prev[--p],s.prev[p]=_w_size<=m?m-_w_size:0,--n;);more+=_w_size}if(0===s.strm.avail_in)break;if(strm=s.strm,buf=s.window,start=s.strstart+s.lookahead,more=more,len=void 0,len=strm.avail_in,n=0===(len=more<len?more:len)?0:(strm.avail_in-=len,common.arraySet(buf,strm.input,strm.next_in,len,start),1===strm.state.wrap?strm.adler=adler32_1(strm.adler,buf,len,start):2===strm.state.wrap&&(strm.adler=crc32_1(strm.adler,buf,len,start)),strm.next_in+=len,strm.total_in+=len,len),s.lookahead+=n,s.lookahead+s.insert>=MIN_MATCH$1)for(str=s.strstart-s.insert,s.ins_h=s.window[str],s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH$1-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++,s.insert--,!(s.lookahead+s.insert<MIN_MATCH$1)););}while(s.lookahead<MIN_LOOKAHEAD&&0!==s.strm.avail_in)}function deflate_fast(s,flush){for(var hash_head,bflush;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH$1&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==hash_head&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head)),s.match_length>=MIN_MATCH$1)if(bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH$1),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH$1){for(s.match_length--;s.strstart++,s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart,0!=--s.match_length;);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;else bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=s.strstart<MIN_MATCH$1-1?s.strstart:MIN_MATCH$1-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(s,flush){for(var hash_head,bflush,max_insert;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH$1&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=MIN_MATCH$1-1,0!==hash_head&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head),s.match_length<=5&&(1===s.strategy||s.match_length===MIN_MATCH$1&&4096<s.strstart-s.match_start)&&(s.match_length=MIN_MATCH$1-1)),s.prev_length>=MIN_MATCH$1&&s.match_length<=s.prev_length){for(max_insert=s.strstart+s.lookahead-MIN_MATCH$1,bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH$1),s.lookahead-=s.prev_length-1,s.prev_length-=2;++s.strstart<=max_insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!=--s.prev_length;);if(s.match_available=0,s.match_length=MIN_MATCH$1-1,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}else if(s.match_available){if((bflush=trees._tr_tally(s,0,s.window[s.strstart-1]))&&flush_block_only(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return BS_NEED_MORE}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(bflush=trees._tr_tally(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<MIN_MATCH$1-1?s.strstart:MIN_MATCH$1-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length,this.max_lazy=max_lazy,this.nice_length=nice_length,this.max_chain=max_chain,this.func=func}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new common.Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new common.Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new common.Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new common.Buf16(MAX_BITS$1+1),this.heap=new common.Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new common.Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(strm){var s;return strm&&strm.state?(strm.total_in=strm.total_out=0,strm.data_type=Z_UNKNOWN$1,(s=strm.state).pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap?INIT_STATE:BUSY_STATE,strm.adler=2===s.wrap?0:1,s.last_flush=Z_NO_FLUSH,trees._tr_init(s),Z_OK):err(strm,Z_STREAM_ERROR)}function deflateReset(strm){var ret=deflateResetKeep(strm);return ret===Z_OK&&((strm=strm.state).window_size=2*strm.w_size,zero$1(strm.head),strm.max_lazy_match=configuration_table[strm.level].max_lazy,strm.good_match=configuration_table[strm.level].good_length,strm.nice_match=configuration_table[strm.level].nice_length,strm.max_chain_length=configuration_table[strm.level].max_chain,strm.strstart=0,strm.block_start=0,strm.lookahead=0,strm.insert=0,strm.match_length=strm.prev_length=MIN_MATCH$1-1,strm.match_available=0,strm.ins_h=0),ret}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm)return Z_STREAM_ERROR;var wrap=1;if(level===Z_DEFAULT_COMPRESSION&&(level=6),windowBits<0?(wrap=0,windowBits=-windowBits):15<windowBits&&(wrap=2,windowBits-=16),memLevel<1||MAX_MEM_LEVEL<memLevel||method!==Z_DEFLATED||windowBits<8||15<windowBits||level<0||9<level||strategy<0||Z_FIXED$1<strategy)return err(strm,Z_STREAM_ERROR);8===windowBits&&(windowBits=9);var s=new DeflateState;return(strm.state=s).strm=strm,s.wrap=wrap,s.gzhead=null,s.w_bits=windowBits,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=memLevel+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),s.window=new common.Buf8(2*s.w_size),s.head=new common.Buf16(s.hash_size),s.prev=new common.Buf16(s.w_size),s.lit_bufsize=1<<memLevel+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new common.Buf8(s.pending_buf_size),s.d_buf=+s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=level,s.strategy=strategy,s.method=method,deflateReset(strm)}var configuration_table=[new Config(0,0,0,0,function(s,flush){var max_block_size=65535;for(max_block_size>s.pending_buf_size-5&&(max_block_size=s.pending_buf_size-5);;){if(s.lookahead<=1){if(fill_window(s),0===s.lookahead&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}s.strstart+=s.lookahead,s.lookahead=0;var max_start=s.block_start+max_block_size;if((0===s.strstart||s.strstart>=max_start)&&(s.lookahead=s.strstart-max_start,s.strstart=max_start,flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE;if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(s.strstart>s.block_start&&(flush_block_only(s,!1),s.strm.avail_out),BS_NEED_MORE)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],deflate_1={deflateInit:function(strm,level){return deflateInit2(strm,level,Z_DEFLATED,15,8,0)},deflateInit2:deflateInit2,deflateReset:deflateReset,deflateResetKeep:deflateResetKeep,deflateSetHeader:function(strm,head){return!strm||!strm.state||2!==strm.state.wrap?Z_STREAM_ERROR:(strm.state.gzhead=head,Z_OK)},deflate:function(strm,flush){var old_flush,s,beg,val;if(!strm||!strm.state||5<flush||flush<0)return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;if(s=strm.state,!strm.output||!strm.input&&0!==strm.avail_in||666===s.status&&flush!==Z_FINISH)return err(strm,0===strm.avail_out?-5:Z_STREAM_ERROR);if(s.strm=strm,old_flush=s.last_flush,s.last_flush=flush,s.status===INIT_STATE&&(2===s.wrap?(strm.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,255&s.gzhead.time),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,9===s.level?2:2<=s.strategy||s.level<2?4:0),put_byte(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,255&s.gzhead.extra.length),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,9===s.level?2:2<=s.strategy||s.level<2?4:0),put_byte(s,3),s.status=BUSY_STATE)):(header=Z_DEFLATED+(s.w_bits-8<<4)<<8,header|=(2<=s.strategy||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(header|=32),header+=31-header%31,s.status=BUSY_STATE,putShortMSB(s,header),0!==s.strstart&&(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),strm.adler=1)),69===s.status)if(s.gzhead.extra){for(beg=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending!==s.pending_buf_size));)put_byte(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}}while(val=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,put_byte(s,val),0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}}while(val=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,put_byte(s,val),0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32_1(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(strm),s.pending+2<=s.pending_buf_size&&(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),strm.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),0!==s.pending){if(flush_pending(strm),0===strm.avail_out)return s.last_flush=-1,Z_OK}else if(0===strm.avail_in&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH)return err(strm,-5);if(666===s.status&&0!==strm.avail_in)return err(strm,-5);if(0!==strm.avail_in||0!==s.lookahead||flush!==Z_NO_FLUSH&&666!==s.status){var header=2===s.strategy?function(s,flush){for(var bflush;;){if(0===s.lookahead&&(fill_window(s),0===s.lookahead)){if(flush===Z_NO_FLUSH)return BS_NEED_MORE;break}if(s.match_length=0,bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):3===s.strategy?function(s,flush){for(var bflush,prev,scan,strend,_win=s.window;;){if(s.lookahead<=MAX_MATCH$1){if(fill_window(s),s.lookahead<=MAX_MATCH$1&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(s.match_length=0,s.lookahead>=MIN_MATCH$1&&0<s.strstart&&(prev=_win[scan=s.strstart-1])===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){for(strend=s.strstart+MAX_MATCH$1;prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend;);s.match_length=MAX_MATCH$1-(strend-scan),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=MIN_MATCH$1?(bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH$1),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):configuration_table[s.level].func(s,flush);if(header!==BS_FINISH_STARTED&&header!==BS_FINISH_DONE||(s.status=666),header===BS_NEED_MORE||header===BS_FINISH_STARTED)return 0===strm.avail_out&&(s.last_flush=-1),Z_OK;if(header===BS_BLOCK_DONE&&(1===flush?trees._tr_align(s):5!==flush&&(trees._tr_stored_block(s,0,0,!1),3===flush&&(zero$1(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(strm),0===strm.avail_out))return s.last_flush=-1,Z_OK}return flush!==Z_FINISH?Z_OK:s.wrap<=0?1:(2===s.wrap?(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),put_byte(s,strm.adler>>16&255),put_byte(s,strm.adler>>24&255),put_byte(s,255&strm.total_in),put_byte(s,strm.total_in>>8&255),put_byte(s,strm.total_in>>16&255),put_byte(s,strm.total_in>>24&255)):(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),flush_pending(strm),0<s.wrap&&(s.wrap=-s.wrap),0!==s.pending?Z_OK:1)},deflateEnd:function(strm){var status;return strm&&strm.state?(status=strm.state.status)!==INIT_STATE&&69!==status&&73!==status&&91!==status&&103!==status&&status!==BUSY_STATE&&666!==status?err(strm,Z_STREAM_ERROR):(strm.state=null,status===BUSY_STATE?err(strm,-3):Z_OK):Z_STREAM_ERROR},deflateSetDictionary:function(strm,dictionary){var s,str,n,wrap,next,input,tmpDict,dictLength=dictionary.length;if(!strm||!strm.state)return Z_STREAM_ERROR;if(2===(wrap=(s=strm.state).wrap)||1===wrap&&s.status!==INIT_STATE||s.lookahead)return Z_STREAM_ERROR;for(1===wrap&&(strm.adler=adler32_1(strm.adler,dictionary,dictLength,0)),s.wrap=0,dictLength>=s.w_size&&(0===wrap&&(zero$1(s.head),s.strstart=0,s.block_start=0,s.insert=0),tmpDict=new common.Buf8(s.w_size),common.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0),dictionary=tmpDict,dictLength=s.w_size),tmpDict=strm.avail_in,next=strm.next_in,input=strm.input,strm.avail_in=dictLength,strm.next_in=0,strm.input=dictionary,fill_window(s);s.lookahead>=MIN_MATCH$1;){for(str=s.strstart,n=s.lookahead-(MIN_MATCH$1-1);s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH$1-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++,--n;);s.strstart=str,s.lookahead=MIN_MATCH$1-1,fill_window(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=MIN_MATCH$1-1,s.match_available=0,strm.next_in=next,strm.input=input,strm.avail_in=tmpDict,s.wrap=wrap,Z_OK},deflateInfo:"pako deflate (from Nodeca project)"},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new common.Buf8(256),q=0;q<256;q++)_utf8len[q]=252<=q?6:248<=q?5:240<=q?4:224<=q?3:192<=q?2:1;_utf8len[254]=_utf8len[254]=1;function buf2binstring(buf,len){if(len<65534&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,common.shrinkBuf(buf,len));for(var result="",i=0;i<len;i++)result+=String.fromCharCode(buf[i]);return result}var strings_string2buf=function(str){for(var buf,c,c2,i,str_len=str.length,buf_len=0,m_pos=0;m_pos<str_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=new common.Buf8(buf_len),m_pos=i=0;i<buf_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),c<128?buf[i++]=c:(c<2048?buf[i++]=192|c>>>6:(c<65536?buf[i++]=224|c>>>12:(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63),buf[i++]=128|c>>>6&63),buf[i++]=128|63&c);return buf},strings_buf2binstring=function(buf){return buf2binstring(buf,buf.length)},strings_binstring2buf=function(str){for(var buf=new common.Buf8(str.length),i=0,len=buf.length;i<len;i++)buf[i]=str.charCodeAt(i);return buf},strings_buf2string=function(buf,max){for(var c,c_len,len=max||buf.length,utf16buf=new Array(2*len),out=0,i=0;i<len;)if((c=buf[i++])<128)utf16buf[out++]=c;else if(4<(c_len=_utf8len[c]))utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;1<c_len&&i<len;)c=c<<6|63&buf[i++],c_len--;1<c_len?utf16buf[out++]=65533:c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return buf2binstring(utf16buf,out)},strings_utf8border=function(buf,max){for(var pos=(max=(max=max||buf.length)>buf.length?buf.length:max)-1;0<=pos&&128==(192&buf[pos]);)pos--;return!(pos<0)&&0!==pos&&pos+_utf8len[buf[pos]]>max?pos:max};var zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},toString=Object.prototype.toString;function Deflate(options){if(!(this instanceof Deflate))return new Deflate(options);this.options=common.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},options||{});options=this.options;if(options.raw&&0<options.windowBits?options.windowBits=-options.windowBits:options.gzip&&0<options.windowBits&&options.windowBits<16&&(options.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,(this.strm.avail_out=0)!==(status=deflate_1.deflateInit2(this.strm,options.level,options.method,options.windowBits,options.memLevel,options.strategy)))throw new Error(messages[status]);if(options.header&&deflate_1.deflateSetHeader(this.strm,options.header),options.dictionary){var status,options="string"==typeof options.dictionary?strings_string2buf(options.dictionary):"[object ArrayBuffer]"===toString.call(options.dictionary)?new Uint8Array(options.dictionary):options.dictionary;if(0!==(status=deflate_1.deflateSetDictionary(this.strm,options)))throw new Error(messages[status]);this._dict_set=!0}}function deflate$1(input,options){options=new Deflate(options);if(options.push(input,!0),options.err)throw options.msg||messages[options.err];return options.result}Deflate.prototype.push=function(data,mode){var status,_mode,strm=this.strm,chunkSize=this.options.chunkSize;if(this.ended)return!1;_mode=mode===~~mode?mode:!0===mode?4:0,"string"==typeof data?strm.input=strings_string2buf(data):"[object ArrayBuffer]"===toString.call(data)?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new common.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),1!==(status=deflate_1.deflate(strm,_mode))&&0!==status)return this.onEnd(status),!(this.ended=!0)}while(0!==strm.avail_out&&(0!==strm.avail_in||4!==_mode&&2!==_mode)||("string"===this.options.to?this.onData(strings_buf2binstring(common.shrinkBuf(strm.output,strm.next_out))):this.onData(common.shrinkBuf(strm.output,strm.next_out))),(0<strm.avail_in||0===strm.avail_out)&&1!==status);return 4===_mode?(status=deflate_1.deflateEnd(this.strm),this.onEnd(status),this.ended=!0,0===status):2!==_mode||(this.onEnd(0),!(strm.avail_out=0))},Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Deflate.prototype.onEnd=function(status){0===status&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg};var deflate_1$1={Deflate:Deflate,deflate:deflate$1,deflateRaw:function(input,options){return(options=options||{}).raw=!0,deflate$1(input,options)},gzip:function(input,options){return(options=options||{}).gzip=!0,deflate$1(input,options)}},BAD=30,TYPE=12,MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(type,lens,lens_index,codes,table,table_index,work,opts){for(var incr,fill,low,mask,next,end,here_bits,here_op,here_val,bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,base=null,base_index=0,count=new common.Buf16(MAXBITS+1),offs=new common.Buf16(MAXBITS+1),extra=null,extra_index=0,len=0;len<=MAXBITS;len++)count[len]=0;for(sym=0;sym<codes;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=MAXBITS;1<=max&&0===count[max];max--);if(max<root&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;min<max&&0===count[min];min++);for(root<min&&(root=min),len=left=1;len<=MAXBITS;len++)if((left=(left<<=1)-count[len])<0)return-1;if(0<left&&(type===CODES||1!==max))return-1;for(offs[1]=0,len=1;len<MAXBITS;len++)offs[len+1]=offs[len]+count[len];for(sym=0;sym<codes;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(end=type===CODES?(base=extra=work,19):type===LENS?(base=lbase,base_index-=257,extra=lext,extra_index-=257,256):(base=dbase,extra=dext,-1),len=min,next=table_index,drop=sym=huff=0,low=-1,mask=(used=1<<(curr=root))-1,type===LENS&&ENOUGH_LENS<used||type===DISTS&&ENOUGH_DISTS<used)return 1;for(;;){for(here_val=work[sym]<end?(here_op=0,work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],base[base_index+work[sym]]):(here_op=96,0),incr=1<<(here_bits=len-drop),min=fill=1<<curr;table[next+(huff>>drop)+(fill-=incr)]=here_bits<<24|here_op<<16|here_val|0,0!==fill;);for(incr=1<<len-1;huff&incr;)incr>>=1;if(huff=0!==incr?(huff&incr-1)+incr:0,sym++,0==--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(root<len&&(huff&mask)!==low){for(next+=min,left=1<<(curr=len-(drop=0===drop?root:drop));curr+drop<max&&!((left-=count[curr+drop])<=0);)curr++,left<<=1;if(used+=1<<curr,type===LENS&&ENOUGH_LENS<used||type===DISTS&&ENOUGH_DISTS<used)return 1;table[low=huff&mask]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0},LENS$1=1,DISTS$1=2,Z_OK$2=0,Z_STREAM_ERROR$1=-2,HEAD=1,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new common.Buf16(320),this.work=new common.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new common.Buf32(ENOUGH_LENS$1),state.distcode=state.distdyn=new common.Buf32(ENOUGH_DISTS$1),state.sane=1,state.back=-1,Z_OK$2):Z_STREAM_ERROR$1}function inflateReset(strm){var state;return strm&&strm.state?((state=strm.state).wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm)):Z_STREAM_ERROR$1}function inflateReset2(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,windowBits<0?(wrap=0,windowBits=-windowBits):(wrap=1+(windowBits>>4),windowBits<48&&(windowBits&=15)),windowBits&&(windowBits<8||15<windowBits)?Z_STREAM_ERROR$1:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):Z_STREAM_ERROR$1}function inflateInit2(strm,windowBits){var state;return strm?(state=new InflateState,(strm.state=state).window=null,(state=inflateReset2(strm,windowBits))!==Z_OK$2&&(strm.state=null),state):Z_STREAM_ERROR$1}var lenfix,distfix,virgin=!0;function updatewindow(strm,src,end,copy){var dist,strm=strm.state;return null===strm.window&&(strm.wsize=1<<strm.wbits,strm.wnext=0,strm.whave=0,strm.window=new common.Buf8(strm.wsize)),copy>=strm.wsize?(common.arraySet(strm.window,src,end-strm.wsize,strm.wsize,0),strm.wnext=0,strm.whave=strm.wsize):(copy<(dist=strm.wsize-strm.wnext)&&(dist=copy),common.arraySet(strm.window,src,end-copy,dist,strm.wnext),(copy-=dist)?(common.arraySet(strm.window,src,end-copy,copy,0),strm.wnext=copy,strm.whave=strm.wsize):(strm.wnext+=dist,strm.wnext===strm.wsize&&(strm.wnext=0),strm.whave<strm.wsize&&(strm.whave+=dist))),0}var inflate_1={inflateReset:inflateReset,inflateReset2:inflateReset2,inflateResetKeep:inflateResetKeep,inflateInit:function(strm){return inflateInit2(strm,15)},inflateInit2:inflateInit2,inflate:function(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,opts,n,here=0,hbuf=new common.Buf8(4),order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return Z_STREAM_ERROR$1;12===(state=strm.state).mode&&(state.mode=13),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK$2;inf_leave:for(;;)switch(state.mode){case HEAD:if(0===state.wrap){state.mode=13;break}for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){hbuf[state.check=0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32_1(state.check,hbuf,2,0),bits=hold=0,state.mode=2;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=30;break}if(8!=(15&hold)){strm.msg="unknown compression method",state.mode=30;break}if(bits-=4,len=8+(15&(hold>>>=4)),0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=30;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?10:12,bits=hold=0;break;case 2:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,8!=(255&state.flags)){strm.msg="unknown compression method",state.mode=30;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=30;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32_1(state.check,hbuf,2,0)),bits=hold=0,state.mode=3;case 3:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32_1(state.check,hbuf,4,0)),bits=hold=0,state.mode=4;case 4:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32_1(state.check,hbuf,2,0)),bits=hold=0,state.mode=5;case 5:if(1024&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32_1(state.check,hbuf,2,0)),bits=hold=0}else state.head&&(state.head.extra=null);state.mode=6;case 6:if(1024&state.flags&&((copy=have<(copy=state.length)?have:copy)&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),common.arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32_1(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=7;case 7:if(2048&state.flags){if(0===have)break inf_leave;for(copy=0;len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len)),len&&copy<have;);if(512&state.flags&&(state.check=crc32_1(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=8;case 8:if(4096&state.flags){if(0===have)break inf_leave;for(copy=0;len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len)),len&&copy<have;);if(512&state.flags&&(state.check=crc32_1(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=9;case 9:if(512&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=30;break}bits=hold=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=12;break;case 10:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=zswap32(hold),bits=hold=0,state.mode=11;case 11:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,2;strm.adler=state.check=1,state.mode=12;case 12:if(5===flush||6===flush)break inf_leave;case 13:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=27;break}for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,--bits,3&(hold>>>=1)){case 0:state.mode=14;break;case 1:if(!function(state){if(virgin){var sym;for(lenfix=new common.Buf32(512),distfix=new common.Buf32(32),sym=0;sym<144;)state.lens[sym++]=8;for(;sym<256;)state.lens[sym++]=9;for(;sym<280;)state.lens[sym++]=7;for(;sym<288;)state.lens[sym++]=8;for(inftrees(LENS$1,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;sym<32;)state.lens[sym++]=5;inftrees(DISTS$1,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}(state),state.mode=20,6!==flush)break;hold>>>=2,bits-=2;break inf_leave;case 2:state.mode=17;break;case 3:strm.msg="invalid block type",state.mode=30}hold>>>=2,bits-=2;break;case 14:for(hold>>>=7&bits,bits-=7&bits;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!=(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=30;break}if(state.length=65535&hold,bits=hold=0,state.mode=15,6===flush)break inf_leave;case 15:state.mode=16;case 16:if(copy=state.length){if(0===(copy=left<(copy=have<copy?have:copy)?left:copy))break inf_leave;common.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=12;break;case 17:for(;bits<14;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=257+(31&hold),hold>>>=5,bits-=5,state.ndist=1+(31&hold),hold>>>=5,bits-=5,state.ncode=4+(15&hold),hold>>>=4,bits-=4,286<state.nlen||30<state.ndist){strm.msg="too many length or distance symbols",state.mode=30;break}state.have=0,state.mode=18;case 18:for(;state.have<state.ncode;){for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inftrees(0,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=30;break}state.have=0,state.mode=19;case 19:for(;state.have<state.nlen+state.ndist;){for(;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_val<16)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=30;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}len=0,copy=3+(7&(hold>>>=here_bits)),hold>>>=3,bits=bits-here_bits-3}else{for(n=here_bits+7;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}len=0,copy=11+(127&(hold>>>=here_bits)),hold>>>=7,bits=bits-here_bits-7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=30;break}for(;copy--;)state.lens[state.have++]=len}}if(30===state.mode)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=30;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inftrees(LENS$1,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=30;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inftrees(DISTS$1,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=30;break}if(state.mode=20,6===flush)break inf_leave;case 20:state.mode=21;case 21:if(6<=have&&258<=left){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,!function(strm,start){var here,op,len,dist,from,from_source,state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,s_window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{for(bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];;){if(hold>>>=op=here>>>24,bits-=op,0===(op=here>>>16&255))output[_out++]=65535&here;else{if(!(16&op)){if(0==(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue}if(32&op){state.mode=TYPE;break top}strm.msg="invalid literal/length code",state.mode=BAD;break top}for(len=65535&here,(op&=15)&&(bits<op&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];;){if(hold>>>=op=here>>>24,bits-=op,!(16&(op=here>>>16&255))){if(0==(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue}strm.msg="invalid distance code",state.mode=BAD;break top}if(dist=65535&here,bits<(op&=15)&&(hold+=input[_in++]<<bits,(bits+=8)<op&&(hold+=input[_in++]<<bits,bits+=8)),dmax<(dist+=hold&(1<<op)-1)){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(hold>>>=op,bits-=op,(op=_out-beg)<dist){if(whave<(op=dist-op)&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(from_source=s_window,(from=0)===wnext){if(from+=wsize-op,op<len){for(len-=op;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}}else if(wnext<op){if(from+=wsize+wnext-op,(op-=wnext)<len){for(len-=op;output[_out++]=s_window[from++],--op;);if(from=0,wnext<len){for(len-=op=wnext;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}}}else if(from+=wnext-op,op<len){for(len-=op;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}for(;2<len;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],1<len&&(output[_out++]=from_source[from++]))}else{for(from=_out-dist;output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],2<(len-=3););len&&(output[_out++]=output[from++],1<len&&(output[_out++]=output[from++]))}break}}break}}while(_in<last&&_out<end);hold&=(1<<(bits-=(len=bits>>3)<<3))-1,strm.next_in=_in-=len,strm.next_out=_out,strm.avail_in=_in<last?last-_in+5:5-(_in-last),strm.avail_out=_out<end?end-_out+257:257-(_out-end),state.hold=hold,state.bits=bits}(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,12===state.mode&&(state.back=-1);break}for(state.back=0;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=26;break}if(32&here_op){state.back=-1,state.mode=12;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=30;break}state.extra=15&here_op,state.mode=22;case 22:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=23;case 23:for(;here_op=(here=state.distcode[hold&(1<<state.distbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=30;break}state.offset=here_val,state.extra=15&here_op,state.mode=24;case 24:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=30;break}state.mode=25;case 25:if(0===left)break inf_leave;if(state.offset>(copy=_out-left)){if((copy=state.offset-copy)>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=30;break}from=copy>state.wnext?(copy-=state.wnext,state.wsize-copy):state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;for(left-=copy=left<copy?left:copy,state.length-=copy;output[put++]=from_source[from++],--copy;);0===state.length&&(state.mode=21);break;case 26:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=21;break;case 27:if(state.wrap){for(;bits<32;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=(state.flags?crc32_1:adler32_1)(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check",state.mode=30;break}bits=hold=0}state.mode=28;case 28:if(state.wrap&&state.flags){for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=30;break}bits=hold=0}state.mode=29;case 29:ret=1;break inf_leave;case 30:ret=-3;break inf_leave;case 31:return-4;default:return Z_STREAM_ERROR$1}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<30&&(state.mode<27||4!==flush))&&updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out),_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=(state.flags?crc32_1:adler32_1)(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(12===state.mode?128:0)+(20===state.mode||15===state.mode?256:0),ret=(0==_in&&0===_out||4===flush)&&ret===Z_OK$2?-5:ret},inflateEnd:function(strm){if(!strm||!strm.state)return Z_STREAM_ERROR$1;var state=strm.state;return state.window&&(state.window=null),strm.state=null,Z_OK$2},inflateGetHeader:function(strm,head){return!strm||!strm.state||0==(2&(strm=strm.state).wrap)?Z_STREAM_ERROR$1:((strm.head=head).done=!1,Z_OK$2)},inflateSetDictionary:function(strm,dictionary){var state,dictLength=dictionary.length;return!strm||!strm.state||0!==(state=strm.state).wrap&&11!==state.mode?Z_STREAM_ERROR$1:11===state.mode&&adler32_1(1,dictionary,dictLength,0)!==state.check?-3:updatewindow(strm,dictionary,dictLength,dictLength)?(state.mode=31,-4):(state.havedict=1,Z_OK$2)},inflateInfo:"pako inflate (from Nodeca project)"},constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},toString$1=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=common.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options,options=(opt.raw&&0<=opt.windowBits&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,0===opt.windowBits&&(opt.windowBits=-15)),!(0<=opt.windowBits&&opt.windowBits<16)||options&&options.windowBits||(opt.windowBits+=32),15<opt.windowBits&&opt.windowBits<48&&0==(15&opt.windowBits)&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0,inflate_1.inflateInit2(this.strm,opt.windowBits));if(options!==constants.Z_OK)throw new Error(messages[options]);if(this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header),opt.dictionary&&("string"==typeof opt.dictionary?opt.dictionary=strings_string2buf(opt.dictionary):"[object ArrayBuffer]"===toString$1.call(opt.dictionary)&&(opt.dictionary=new Uint8Array(opt.dictionary)),opt.raw&&(options=inflate_1.inflateSetDictionary(this.strm,opt.dictionary))!==constants.Z_OK))throw new Error(messages[options])}function inflate$1(input,options){options=new Inflate(options);if(options.push(input,!0),options.err)throw options.msg||messages[options.err];return options.result}Inflate.prototype.push=function(data,mode){var status,_mode,next_out_utf8,tail,utf8str,strm=this.strm,chunkSize=this.options.chunkSize,dictionary=this.options.dictionary,allowBufError=!1;if(this.ended)return!1;_mode=mode===~~mode?mode:!0===mode?constants.Z_FINISH:constants.Z_NO_FLUSH,"string"==typeof data?strm.input=strings_binstring2buf(data):"[object ArrayBuffer]"===toString$1.call(data)?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new common.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),(status=(status=inflate_1.inflate(strm,constants.Z_NO_FLUSH))===constants.Z_NEED_DICT&&dictionary?inflate_1.inflateSetDictionary(this.strm,dictionary):status)===constants.Z_BUF_ERROR&&!0===allowBufError&&(status=constants.Z_OK,allowBufError=!1),status!==constants.Z_STREAM_END&&status!==constants.Z_OK)return this.onEnd(status),!(this.ended=!0)}while(!strm.next_out||0!==strm.avail_out&&status!==constants.Z_STREAM_END&&(0!==strm.avail_in||_mode!==constants.Z_FINISH&&_mode!==constants.Z_SYNC_FLUSH)||("string"===this.options.to?(next_out_utf8=strings_utf8border(strm.output,strm.next_out),tail=strm.next_out-next_out_utf8,utf8str=strings_buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&common.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(common.shrinkBuf(strm.output,strm.next_out))),0===strm.avail_in&&0===strm.avail_out&&(allowBufError=!0),(0<strm.avail_in||0===strm.avail_out)&&status!==constants.Z_STREAM_END);return(_mode=status===constants.Z_STREAM_END?constants.Z_FINISH:_mode)===constants.Z_FINISH?(status=inflate_1.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===constants.Z_OK):_mode!==constants.Z_SYNC_FLUSH||(this.onEnd(constants.Z_OK),!(strm.avail_out=0))},Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Inflate.prototype.onEnd=function(status){status===constants.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg};var pako={},pako_1=((0,common.assign)(pako,deflate_1$1,{Inflate:Inflate,inflate:inflate$1,inflateRaw:function(input,options){return(options=options||{}).raw=!0,inflate$1(input,options)},ungzip:inflate$1},constants),pako),UPNG=createCommonjsModule(function(module){var UPNG;UPNG={},function(UPNG,pako){UPNG.toRGBA8=function(out){var w=out.width,h=out.height;if(null==out.tabs.acTL)return[UPNG.toRGBA8.decodeImage(out.data,w,h,out).buffer];var frms=[];null==out.frames[0].data&&(out.frames[0].data=out.data);for(var img,empty=new Uint8Array(w*h*4),i=0;i<out.frames.length;i++){var frm=out.frames[i],fx=frm.rect.x,fy=frm.rect.y,fw=frm.rect.width,fh=frm.rect.height,fdata=UPNG.toRGBA8.decodeImage(frm.data,fw,fh,out);if(0==i?img=fdata:0==frm.blend?UPNG._copyTile(fdata,fw,fh,img,w,h,fx,fy,0):1==frm.blend&&UPNG._copyTile(fdata,fw,fh,img,w,h,fx,fy,1),frms.push(img.buffer),img=img.slice(0),0!=frm.dispose)if(1==frm.dispose)UPNG._copyTile(empty,fw,fh,img,w,h,fx,fy,0);else if(2==frm.dispose){for(var pi=i-1;2==out.frames[pi].dispose;)pi--;img=new Uint8Array(frms[pi]).slice(0)}}return frms},UPNG.toRGBA8.decodeImage=function(data,w,h,out){var area=w*h,bpp=UPNG.decode._getBPP(out),bpl=Math.ceil(w*bpp/8),bf=new Uint8Array(4*area),bf32=new Uint32Array(bf.buffer),bpp=out.ctype,depth=out.depth,rs=UPNG._bin.readUshort;if(6==bpp){var qarea=area<<2;if(8==depth)for(var i=0;i<qarea;i++)bf[i]=data[i];if(16==depth)for(i=0;i<qarea;i++)bf[i]=data[i<<1]}else if(2==bpp){var ts=out.tabs.tRNS,tr=-1,tg=-1,tb=-1;if(ts&&(tr=ts[0],tg=ts[1],tb=ts[2]),8==depth)for(i=0;i<area;i++){var ti=3*i;bf[qi=i<<2]=data[ti],bf[qi+1]=data[ti+1],bf[qi+2]=data[ti+2],bf[qi+3]=255,-1!=tr&&data[ti]==tr&&data[ti+1]==tg&&data[ti+2]==tb&&(bf[qi+3]=0)}if(16==depth)for(i=0;i<area;i++){ti=6*i;bf[qi=i<<2]=data[ti],bf[qi+1]=data[ti+2],bf[qi+2]=data[ti+4],bf[qi+3]=255,-1!=tr&&rs(data,ti)==tr&&rs(data,ti+2)==tg&&rs(data,ti+4)==tb&&(bf[qi+3]=0)}}else if(3==bpp){var p=out.tabs.PLTE,ap=out.tabs.tRNS,tl=ap?ap.length:0;if(1==depth)for(var y=0;y<h;y++)for(var s0=y*bpl,t0=y*w,i=0;i<w;i++){var qi=t0+i<<2,cj=3*(j=data[s0+(i>>3)]>>7-((7&i)<<0)&1);bf[qi]=p[cj],bf[qi+1]=p[cj+1],bf[qi+2]=p[cj+2],bf[qi+3]=j<tl?ap[j]:255}if(2==depth)for(y=0;y<h;y++)for(s0=y*bpl,t0=y*w,i=0;i<w;i++){qi=t0+i<<2,cj=3*(j=data[s0+(i>>2)]>>6-((3&i)<<1)&3);bf[qi]=p[cj],bf[qi+1]=p[cj+1],bf[qi+2]=p[cj+2],bf[qi+3]=j<tl?ap[j]:255}if(4==depth)for(y=0;y<h;y++)for(s0=y*bpl,t0=y*w,i=0;i<w;i++){qi=t0+i<<2,cj=3*(j=data[s0+(i>>1)]>>4-((1&i)<<2)&15);bf[qi]=p[cj],bf[qi+1]=p[cj+1],bf[qi+2]=p[cj+2],bf[qi+3]=j<tl?ap[j]:255}if(8==depth)for(i=0;i<area;i++){var j,qi=i<<2,cj=3*(j=data[i]);bf[qi]=p[cj],bf[qi+1]=p[cj+1],bf[qi+2]=p[cj+2],bf[qi+3]=j<tl?ap[j]:255}}else if(4==bpp){if(8==depth)for(i=0;i<area;i++){var qi=i<<2,gr=data[di=i<<1];bf[qi]=gr,bf[qi+1]=gr,bf[qi+2]=gr,bf[qi+3]=data[di+1]}if(16==depth)for(i=0;i<area;i++){var di,qi=i<<2,gr=data[di=i<<2];bf[qi]=gr,bf[qi+1]=gr,bf[qi+2]=gr,bf[qi+3]=data[di+2]}}else if(0==bpp){tr=out.tabs.tRNS||-1;if(1==depth)for(i=0;i<area;i++){var al=(gr=255*(data[i>>3]>>7-(7&i)&1))==255*tr?0:255;bf32[i]=al<<24|gr<<16|gr<<8|gr}if(2==depth)for(i=0;i<area;i++){al=(gr=85*(data[i>>2]>>6-((3&i)<<1)&3))==85*tr?0:255;bf32[i]=al<<24|gr<<16|gr<<8|gr}if(4==depth)for(i=0;i<area;i++){al=(gr=17*(data[i>>1]>>4-((1&i)<<2)&15))==17*tr?0:255;bf32[i]=al<<24|gr<<16|gr<<8|gr}if(8==depth)for(i=0;i<area;i++){al=(gr=data[i])==tr?0:255;bf32[i]=al<<24|gr<<16|gr<<8|gr}if(16==depth)for(i=0;i<area;i++){gr=data[i<<1],al=rs(data,i<<1)==tr?0:255;bf32[i]=al<<24|gr<<16|gr<<8|gr}}return bf},UPNG.decode=function(buff){for(var fd,data=new Uint8Array(buff),offset=8,bin=UPNG._bin,rUs=bin.readUshort,rUi=bin.readUint,out={tabs:{},frames:[]},dd=new Uint8Array(data.length),doff=0,foff=0,mgck=[137,80,78,71,13,10,26,10],i=0;i<8;i++)if(data[i]!=mgck[i])throw"The input is not a PNG file!";for(;offset<data.length;){var len=bin.readUint(data,offset),type=(offset+=4,bin.readASCII(data,offset,4));if(offset+=4,"IHDR"==type)UPNG.decode._IHDR(data,offset,out);else if("IDAT"==type){for(i=0;i<len;i++)dd[doff+i]=data[offset+i];doff+=len}else if("acTL"==type)out.tabs[type]={num_frames:rUi(data,offset),num_plays:rUi(data,offset+4)},fd=new Uint8Array(data.length);else if("fcTL"==type){0!=foff&&((fr=out.frames[out.frames.length-1]).data=UPNG.decode._decompress(out,fd.slice(0,foff),fr.rect.width,fr.rect.height),foff=0);var fr,rct={x:rUi(data,offset+12),y:rUi(data,offset+16),width:rUi(data,offset+4),height:rUi(data,offset+8)},del=rUs(data,offset+22),del=rUs(data,offset+20)/(0==del?100:del),rct={rect:rct,delay:Math.round(1e3*del),dispose:data[offset+24],blend:data[offset+25]};out.frames.push(rct)}else if("fdAT"==type){for(i=0;i<len-4;i++)fd[foff+i]=data[offset+i+4];foff+=len-4}else if("pHYs"==type)out.tabs[type]=[bin.readUint(data,offset),bin.readUint(data,offset+4),data[offset+8]];else if("cHRM"==type){out.tabs[type]=[];for(i=0;i<8;i++)out.tabs[type].push(bin.readUint(data,offset+4*i))}else if("tEXt"==type){null==out.tabs[type]&&(out.tabs[type]={});var nz=bin.nextZero(data,offset),keyw=bin.readASCII(data,offset,nz-offset),text=bin.readASCII(data,nz+1,offset+len-nz-1);out.tabs[type][keyw]=text}else if("iTXt"==type){null==out.tabs[type]&&(out.tabs[type]={});nz=0,del=offset,keyw=(nz=bin.nextZero(data,del),bin.readASCII(data,del,nz-del)),del=nz+1,text=(del+=2,nz=bin.nextZero(data,del),bin.readASCII(data,del,nz-del),nz=bin.nextZero(data,del=nz+1),bin.readUTF8(data,del,nz-del),bin.readUTF8(data,del=nz+1,len-(del-offset)));out.tabs[type][keyw]=text}else if("PLTE"==type)out.tabs[type]=bin.readBytes(data,offset,len);else if("hIST"==type){var pl=out.tabs.PLTE.length/3;out.tabs[type]=[];for(i=0;i<pl;i++)out.tabs[type].push(rUs(data,offset+2*i))}else if("tRNS"==type)3==out.ctype?out.tabs[type]=bin.readBytes(data,offset,len):0==out.ctype?out.tabs[type]=rUs(data,offset):2==out.ctype&&(out.tabs[type]=[rUs(data,offset),rUs(data,offset+2),rUs(data,offset+4)]);else if("gAMA"==type)out.tabs[type]=bin.readUint(data,offset)/1e5;else if("sRGB"==type)out.tabs[type]=data[offset];else if("bKGD"==type)0==out.ctype||4==out.ctype?out.tabs[type]=[rUs(data,offset)]:2==out.ctype||6==out.ctype?out.tabs[type]=[rUs(data,offset),rUs(data,offset+2),rUs(data,offset+4)]:3==out.ctype&&(out.tabs[type]=data[offset]);else if("IEND"==type){0!=foff&&((fr=out.frames[out.frames.length-1]).data=UPNG.decode._decompress(out,fd.slice(0,foff),fr.rect.width,fr.rect.height),foff=0),out.data=UPNG.decode._decompress(out,dd,out.width,out.height);break}offset+=len;bin.readUint(data,offset);offset+=4}return delete out.compress,delete out.interlace,delete out.filter,out},UPNG.decode._decompress=function(out,dd,w,h){return 0==out.compress&&(dd=UPNG.decode._inflate(dd)),0==out.interlace?dd=UPNG.decode._filterZero(dd,out,0,w,h):1==out.interlace&&(dd=UPNG.decode._readInterlace(dd,out)),dd},UPNG.decode._inflate=function(data){return pako.inflate(data)},UPNG.decode._readInterlace=function(data,out){for(var w=out.width,h=out.height,bpp=UPNG.decode._getBPP(out),cbpp=bpp>>3,bpl=Math.ceil(w*bpp/8),img=new Uint8Array(h*bpl),di=0,starting_row=[0,0,4,0,2,0,1],starting_col=[0,4,0,2,0,1,0],row_increment=[8,8,8,4,4,2,2],col_increment=[8,8,4,4,2,2,1],pass=0;pass<7;){for(var ri=row_increment[pass],ci=col_increment[pass],sw=0,sh=0,cr=starting_row[pass];cr<h;)cr+=ri,sh++;for(var cc=starting_col[pass];cc<w;)cc+=ci,sw++;for(var bpll=Math.ceil(sw*bpp/8),y=(UPNG.decode._filterZero(data,out,di,sw,sh),0),row=starting_row[pass];row<h;){for(var val,col=starting_col[pass],cdi=di+y*bpll<<3;col<w;){if(1==bpp&&(val=data[cdi>>3],img[row*bpl+(col>>3)]|=(val=val>>7-(7&cdi)&1)<<7-((3&col)<<0)),2==bpp&&(val=data[cdi>>3],img[row*bpl+(col>>2)]|=(val=val>>6-(7&cdi)&3)<<6-((3&col)<<1)),4==bpp&&(val=data[cdi>>3],img[row*bpl+(col>>1)]|=(val=val>>4-(7&cdi)&15)<<4-((1&col)<<2)),8<=bpp)for(var ii=row*bpl+col*cbpp,j=0;j<cbpp;j++)img[ii+j]=data[(cdi>>3)+j];cdi+=bpp,col+=ci}y++,row+=ri}sw*sh!=0&&(di+=sh*(1+bpll)),pass+=1}return img},UPNG.decode._getBPP=function(out){return[1,null,3,1,2,null,4][out.ctype]*out.depth},UPNG.decode._filterZero=function(data,out,off,w,h){for(var bpp=UPNG.decode._getBPP(out),bpl=Math.ceil(w*bpp/8),paeth=UPNG.decode._paeth,bpp=Math.ceil(bpp/8),y=0;y<h;y++){var i=off+y*bpl,di=i+y+1,type=data[di-1];if(0==type)for(var x=0;x<bpl;x++)data[i+x]=data[di+x];else if(1==type){for(x=0;x<bpp;x++)data[i+x]=data[di+x];for(x=bpp;x<bpl;x++)data[i+x]=data[di+x]+data[i+x-bpp]&255}else if(0==y){for(x=0;x<bpp;x++)data[i+x]=data[di+x];if(2==type)for(x=bpp;x<bpl;x++)data[i+x]=255&data[di+x];if(3==type)for(x=bpp;x<bpl;x++)data[i+x]=data[di+x]+(data[i+x-bpp]>>1)&255;if(4==type)for(x=bpp;x<bpl;x++)data[i+x]=data[di+x]+paeth(data[i+x-bpp],0,0)&255}else{if(2==type)for(x=0;x<bpl;x++)data[i+x]=data[di+x]+data[i+x-bpl]&255;if(3==type){for(x=0;x<bpp;x++)data[i+x]=data[di+x]+(data[i+x-bpl]>>1)&255;for(x=bpp;x<bpl;x++)data[i+x]=data[di+x]+(data[i+x-bpl]+data[i+x-bpp]>>1)&255}if(4==type){for(x=0;x<bpp;x++)data[i+x]=data[di+x]+paeth(0,data[i+x-bpl],0)&255;for(x=bpp;x<bpl;x++)data[i+x]=data[di+x]+paeth(data[i+x-bpp],data[i+x-bpl],data[i+x-bpp-bpl])&255}}}return data},UPNG.decode._paeth=function(a,b,c){var p=a+b-c,pa=Math.abs(p-a),pb=Math.abs(p-b),p=Math.abs(p-c);return pa<=pb&&pa<=p?a:pb<=p?b:c},UPNG.decode._IHDR=function(data,offset,out){var bin=UPNG._bin;out.width=bin.readUint(data,offset),out.height=bin.readUint(data,offset+=4),out.depth=data[offset+=4],out.ctype=data[++offset],out.compress=data[++offset],out.filter=data[++offset],out.interlace=data[++offset],offset++},UPNG._bin={nextZero:function(data,p){for(;0!=data[p];)p++;return p},readUshort:function(buff,p){return buff[p]<<8|buff[p+1]},writeUshort:function(buff,p,n){buff[p]=n>>8&255,buff[p+1]=255&n},readUint:function(buff,p){return 16777216*buff[p]+(buff[p+1]<<16|buff[p+2]<<8|buff[p+3])},writeUint:function(buff,p,n){buff[p]=n>>24&255,buff[p+1]=n>>16&255,buff[p+2]=n>>8&255,buff[p+3]=255&n},readASCII:function(buff,p,l){for(var s="",i=0;i<l;i++)s+=String.fromCharCode(buff[p+i]);return s},writeASCII:function(data,p,s){for(var i=0;i<s.length;i++)data[p+i]=s.charCodeAt(i)},readBytes:function(buff,p,l){for(var arr=[],i=0;i<l;i++)arr.push(buff[p+i]);return arr},pad:function(n){return n.length<2?"0"+n:n},readUTF8:function(buff,p,l){for(var ns,s="",i=0;i<l;i++)s+="%"+UPNG._bin.pad(buff[p+i].toString(16));try{ns=decodeURIComponent(s)}catch(e){return UPNG._bin.readASCII(buff,p,l)}return ns}},UPNG._copyTile=function(sb,sw,sh,tb,tw,th,xoff,yoff,mode){for(var w=Math.min(sw,tw),h=Math.min(sh,th),si=0,ti=0,y=0;y<h;y++)for(var x=0;x<w;x++)if(ti=0<=xoff&&0<=yoff?(si=y*sw+x<<2,(yoff+y)*tw+xoff+x<<2):(si=(-yoff+y)*sw-xoff+x<<2,y*tw+x<<2),0==mode)tb[ti]=sb[si],tb[ti+1]=sb[si+1],tb[ti+2]=sb[si+2],tb[ti+3]=sb[si+3];else if(1==mode){var fa=sb[si+3]*(1/255),fr=sb[si]*fa,fg=sb[si+1]*fa,fb=sb[si+2]*fa,ba=tb[ti+3]*(1/255),br=tb[ti]*ba,bg=tb[ti+1]*ba,bb=tb[ti+2]*ba,ifa=1-fa,oa=fa+ba*ifa,ioa=0==oa?0:1/oa;tb[ti+3]=255*oa,tb[ti+0]=(fr+br*ifa)*ioa,tb[ti+1]=(fg+bg*ifa)*ioa,tb[ti+2]=(fb+bb*ifa)*ioa}else if(2==mode){fa=sb[si+3],fr=sb[si],fg=sb[si+1],fb=sb[si+2],ba=tb[ti+3],br=tb[ti],bg=tb[ti+1],bb=tb[ti+2];fa==ba&&fr==br&&fg==bg&&fb==bb?(tb[ti]=0,tb[ti+1]=0,tb[ti+2]=0,tb[ti+3]=0):(tb[ti]=fr,tb[ti+1]=fg,tb[ti+2]=fb,tb[ti+3]=fa)}else if(3==mode){fa=sb[si+3],fr=sb[si],fg=sb[si+1],fb=sb[si+2],ba=tb[ti+3],br=tb[ti],bg=tb[ti+1],bb=tb[ti+2];if((fa!=ba||fr!=br||fg!=bg||fb!=bb)&&(fa<220&&20<ba))return!1}return!0},UPNG.encode=function(bufs,w,h,ps,dels,forbidPlte){null==ps&&(ps=0),null==forbidPlte&&(forbidPlte=!1);for(var data=new Uint8Array(bufs[0].byteLength*bufs.length+100),wr=[137,80,78,71,13,10,26,10],i=0;i<8;i++)data[i]=wr[i];var offset=8,bin=UPNG._bin,crc=UPNG.crc.crc,wUi=bin.writeUint,wUs=bin.writeUshort,wAs=bin.writeASCII,nimg=UPNG.encode.compressPNG(bufs,w,h,ps,forbidPlte),anim=(wUi(data,offset,13),wAs(data,offset+=4,"IHDR"),wUi(data,offset+=4,w),wUi(data,offset+=4,h),data[offset+=4]=nimg.depth,data[++offset]=nimg.ctype,data[++offset]=0,data[++offset]=0,data[++offset]=0,wUi(data,++offset,crc(data,offset-17,17)),wUi(data,offset+=4,1),wAs(data,offset+=4,"sRGB"),data[offset+=4]=1,wUi(data,++offset,crc(data,offset-5,5)),offset+=4,1<bufs.length);if(anim&&(wUi(data,offset,8),wAs(data,offset+=4,"acTL"),wUi(data,offset+=4,bufs.length),wUi(data,offset+=4,0),wUi(data,offset+=4,crc(data,offset-12,12)),offset+=4),3==nimg.ctype){wUi(data,offset,3*(dl=nimg.plte.length)),wAs(data,offset+=4,"PLTE"),offset+=4;for(i=0;i<dl;i++){var ti=3*i,c=nimg.plte[i],g=c>>8&255,b=c>>16&255;data[offset+ti+0]=255&c,data[offset+ti+1]=g,data[offset+ti+2]=b}if(wUi(data,offset+=3*dl,crc(data,offset-3*dl-4,3*dl+4)),offset+=4,nimg.gotAlpha){wUi(data,offset,dl),wAs(data,offset+=4,"tRNS"),offset+=4;for(i=0;i<dl;i++)data[offset+i]=nimg.plte[i]>>24&255;wUi(data,offset+=dl,crc(data,offset-dl-4,dl+4)),offset+=4}}for(var fi=0,j=0;j<nimg.frames.length;j++){var dl,fr=nimg.frames[j],imgd=(anim&&(wUi(data,offset,26),wAs(data,offset+=4,"fcTL"),wUi(data,offset+=4,fi++),wUi(data,offset+=4,fr.rect.width),wUi(data,offset+=4,fr.rect.height),wUi(data,offset+=4,fr.rect.x),wUi(data,offset+=4,fr.rect.y),wUs(data,offset+=4,dels[j]),wUs(data,offset+=2,1e3),data[offset+=2]=fr.dispose,data[++offset]=fr.blend,wUi(data,++offset,crc(data,offset-30,30)),offset+=4),fr.cimg),fr=(wUi(data,offset,(dl=imgd.length)+(0==j?0:4)),offset+=4);wAs(data,offset,0==j?"IDAT":"fdAT"),offset+=4,0!=j&&(wUi(data,offset,fi++),offset+=4);for(i=0;i<dl;i++)data[offset+i]=imgd[i];wUi(data,offset+=dl,crc(data,fr,offset-fr)),offset+=4}return wUi(data,offset,0),wAs(data,offset+=4,"IEND"),wUi(data,offset+=4,crc(data,offset-4,4)),data.buffer.slice(0,offset+=4)},UPNG.encode.compressPNG=function(bufs,w,h,ps,forbidPlte){for(var out=UPNG.encode.compress(bufs,w,h,ps,!1,forbidPlte),i=0;i<bufs.length;i++){var frm=out.frames[i],nh=(frm.rect.width,frm.rect.height),bpl=frm.bpl,bpp=frm.bpp,fdata=new Uint8Array(nh*bpl+nh);frm.cimg=UPNG.encode._filterZero(frm.img,nh,bpp,bpl,fdata)}return out},UPNG.encode.compress=function(bufs,w,h,ps,forGIF,forbidPlte){null==forbidPlte&&(forbidPlte=!1);for(var ctype=6,depth=8,bpp=4,alphaAnd=255,j=0;j<bufs.length;j++)for(var img=new Uint8Array(bufs[j]),ilen=img.length,i=0;i<ilen;i+=4)alphaAnd&=img[i+3];var gotAlpha=255!=alphaAnd,cmap={},plte=[];if(0!=bufs.length&&(cmap[0]=0,plte.push(0),0!=ps&&ps--),0!=ps){var qres=UPNG.quantize(bufs,ps,forGIF);bufs=qres.bufs;for(i=0;i<qres.plte.length;i++)null==cmap[c=qres.plte[i].est.rgba]&&(cmap[c]=plte.length,plte.push(c))}else for(j=0;j<bufs.length;j++)for(var img32=new Uint32Array(bufs[j]),ilen=img32.length,i=0;i<ilen;i++){var c=img32[i];if((i<w||c!=img32[i-1]&&c!=img32[i-w])&&null==cmap[c]&&(cmap[c]=plte.length,plte.push(c),300<=plte.length))break}for(var brute=!!gotAlpha&&forGIF,cc=plte.length,frms=(cc<=256&&0==forbidPlte&&(depth=forGIF?8:cc<=2?1:cc<=4?2:cc<=16?4:8,gotAlpha=!0),[]),j=0;j<bufs.length;j++){var cimg=new Uint8Array(bufs[j]),cimg32=new Uint32Array(cimg.buffer),nx=0,ny=0,nw=w,nh=h,blend=0;if(0!=j&&!brute){for(var tlim=forGIF||1==j||2==frms[frms.length-2].dispose?1:2,tstp=0,tarea=1e9,it=0;it<tlim;it++){for(var pimg=new Uint8Array(bufs[j-1-it]),p32=new Uint32Array(bufs[j-1-it]),mix=w,miy=h,max=-1,may=-1,y=0;y<h;y++)for(var x=0;x<w;x++)cimg32[i=y*w+x]!=p32[i]&&(x<mix&&(mix=x),max<x&&(max=x),y<miy&&(miy=y),may<y&&(may=y));var sarea=-1==max?1:(max-mix+1)*(may-miy+1);sarea<tarea&&(tarea=sarea,tstp=it,-1==max?(nx=ny=0,nw=nh=1):(nw=max-(nx=mix)+1,nh=may-(ny=miy)+1))}var pimg=new Uint8Array(bufs[j-1-tstp]),nimg=(1==tstp&&(frms[frms.length-1].dispose=2),new Uint8Array(nw*nh*4));new Uint32Array(nimg.buffer);UPNG._copyTile(pimg,w,h,nimg,nw,nh,-nx,-ny,0),blend=UPNG._copyTile(cimg,w,h,nimg,nw,nh,-nx,-ny,3)?(UPNG._copyTile(cimg,w,h,nimg,nw,nh,-nx,-ny,2),1):(UPNG._copyTile(cimg,w,h,nimg,nw,nh,-nx,-ny,0),0),cimg=nimg,cimg32=new Uint32Array(cimg.buffer)}var bpl=4*nw;if(cc<=256&&0==forbidPlte){for(bpl=Math.ceil(depth*nw/8),nimg=new Uint8Array(bpl*nh),y=0;y<nh;y++){var i=y*bpl,ii=y*nw;if(8==depth)for(x=0;x<nw;x++)nimg[i+x]=cmap[cimg32[ii+x]];else if(4==depth)for(x=0;x<nw;x++)nimg[i+(x>>1)]|=cmap[cimg32[ii+x]]<<4-4*(1&x);else if(2==depth)for(x=0;x<nw;x++)nimg[i+(x>>2)]|=cmap[cimg32[ii+x]]<<6-2*(3&x);else if(1==depth)for(x=0;x<nw;x++)nimg[i+(x>>3)]|=cmap[cimg32[ii+x]]<<7-(7&x)}cimg=nimg,ctype=3,bpp=1}else if(0==gotAlpha&&1==bufs.length){for(var nimg=new Uint8Array(nw*nh*3),area=nw*nh,i=0;i<area;i++){var ti=3*i,qi=4*i;nimg[ti]=cimg[qi],nimg[1+ti]=cimg[1+qi],nimg[2+ti]=cimg[2+qi]}cimg=nimg,ctype=2,bpl=(bpp=3)*nw}frms.push({rect:{x:nx,y:ny,width:nw,height:nh},img:cimg,bpl:bpl,bpp:bpp,blend:blend,dispose:brute?1:0})}return{ctype:ctype,depth:depth,plte:plte,gotAlpha:gotAlpha,frames:frms}},UPNG.encode._filterZero=function(img,h,bpp,bpl,data){for(var fls=[],t=0;t<5;t++)if(!(5e5<h*bpl)||2!=t&&3!=t&&4!=t){for(var y=0;y<h;y++)UPNG.encode._filterLine(data,img,y,bpl,bpp,t);if(fls.push(pako.deflate(data)),1==bpp)break}for(var ti,tsize=1e9,i=0;i<fls.length;i++)fls[i].length<tsize&&(tsize=fls[ti=i].length);return fls[ti]},UPNG.encode._filterLine=function(data,img,y,bpl,bpp,type){var i=y*bpl,di=i+y,paeth=UPNG.decode._paeth;if(data[di]=type,di++,0==type)for(var x=0;x<bpl;x++)data[di+x]=img[i+x];else if(1==type){for(x=0;x<bpp;x++)data[di+x]=img[i+x];for(x=bpp;x<bpl;x++)data[di+x]=img[i+x]-img[i+x-bpp]+256&255}else if(0==y){for(x=0;x<bpp;x++)data[di+x]=img[i+x];if(2==type)for(x=bpp;x<bpl;x++)data[di+x]=img[i+x];if(3==type)for(x=bpp;x<bpl;x++)data[di+x]=img[i+x]-(img[i+x-bpp]>>1)+256&255;if(4==type)for(x=bpp;x<bpl;x++)data[di+x]=img[i+x]-paeth(img[i+x-bpp],0,0)+256&255}else{if(2==type)for(x=0;x<bpl;x++)data[di+x]=img[i+x]+256-img[i+x-bpl]&255;if(3==type){for(x=0;x<bpp;x++)data[di+x]=img[i+x]+256-(img[i+x-bpl]>>1)&255;for(x=bpp;x<bpl;x++)data[di+x]=img[i+x]+256-(img[i+x-bpl]+img[i+x-bpp]>>1)&255}if(4==type){for(x=0;x<bpp;x++)data[di+x]=img[i+x]+256-paeth(0,img[i+x-bpl],0)&255;for(x=bpp;x<bpl;x++)data[di+x]=img[i+x]+256-paeth(img[i+x-bpp],img[i+x-bpl],img[i+x-bpp-bpl])&255}}},UPNG.crc={table:function(){for(var tab=new Uint32Array(256),n=0;n<256;n++){for(var c=n,k=0;k<8;k++)1&c?c=3988292384^c>>>1:c>>>=1;tab[n]=c}return tab}(),update:function(c,buf,off,len){for(var i=0;i<len;i++)c=UPNG.crc.table[255&(c^buf[off+i])]^c>>>8;return c},crc:function(b,o,l){return 4294967295^UPNG.crc.update(4294967295,b,o,l)}},UPNG.quantize=function(bufs,ps,roundAlpha){for(var imgs=[],totl=0,i=0;i<bufs.length;i++)imgs.push(UPNG.encode.alphaMul(new Uint8Array(bufs[i]),roundAlpha)),totl+=bufs[i].byteLength;for(var nimg=new Uint8Array(totl),nimg32=new Uint32Array(nimg.buffer),noff=0,i=0;i<imgs.length;i++){for(var img=imgs[i],il=img.length,j=0;j<il;j++)nimg[noff+j]=img[j];noff+=il}for(var root={i0:0,i1:nimg.length,bst:null,est:null,tdst:0,left:null,right:null},leafs=(root.bst=UPNG.quantize.stats(nimg,root.i0,root.i1),root.est=UPNG.quantize.estats(root.bst),[root]);leafs.length<ps;){for(var maxL=0,mi=0,i=0;i<leafs.length;i++)leafs[i].est.L>maxL&&(maxL=leafs[i].est.L,mi=i);if(maxL<.001)break;var node=leafs[mi],s0=UPNG.quantize.splitPixels(nimg,nimg32,node.i0,node.i1,node.est.e,node.est.eMq255),ln={i0:node.i0,i1:s0,bst:null,est:null,tdst:0,left:null,right:null},rn=(ln.bst=UPNG.quantize.stats(nimg,ln.i0,ln.i1),ln.est=UPNG.quantize.estats(ln.bst),{i0:s0,i1:node.i1,bst:null,est:null,tdst:0,left:null,right:null});rn.bst={R:[],m:[],N:node.bst.N-ln.bst.N};for(i=0;i<16;i++)rn.bst.R[i]=node.bst.R[i]-ln.bst.R[i];for(i=0;i<4;i++)rn.bst.m[i]=node.bst.m[i]-ln.bst.m[i];rn.est=UPNG.quantize.estats(rn.bst),node.left=ln,node.right=rn,leafs[mi]=ln,leafs.push(rn)}leafs.sort(function(a,b){return b.bst.N-a.bst.N});for(var ii=0;ii<imgs.length;ii++){for(var planeDst=UPNG.quantize.planeDst,sb=new Uint8Array(imgs[ii].buffer),tb=new Uint32Array(imgs[ii].buffer),len=sb.length,i=0;i<len;i+=4){for(var r=sb[i]*(1/255),g=sb[i+1]*(1/255),b=sb[i+2]*(1/255),a=sb[i+3]*(1/255),nd=root;nd.left;)nd=planeDst(nd.est,r,g,b,a)<=0?nd.left:nd.right;tb[i>>2]=nd.est.rgba}imgs[ii]=tb.buffer}return{bufs:imgs,plte:leafs}},UPNG.quantize.getNearest=function(nd,r,g,b,a){if(null==nd.left)return nd.tdst=UPNG.quantize.dist(nd.est.q,r,g,b,a),nd;var planeDst=UPNG.quantize.planeDst(nd.est,r,g,b,a),node0=nd.left,node1=nd.right,nd=(0<planeDst&&(node0=nd.right,node1=nd.left),UPNG.quantize.getNearest(node0,r,g,b,a));if(nd.tdst<=planeDst*planeDst)return nd;node0=UPNG.quantize.getNearest(node1,r,g,b,a);return node0.tdst<nd.tdst?node0:nd},UPNG.quantize.planeDst=function(est,r,g,b,a){var e=est.e;return e[0]*r+e[1]*g+e[2]*b+e[3]*a-est.eMq},UPNG.quantize.dist=function(q,r,g,b,a){r-=q[0],g-=q[1],b-=q[2],a-=q[3];return r*r+g*g+b*b+a*a},UPNG.quantize.splitPixels=function(nimg,nimg32,i0,i1,e,eMq){var vecDot=UPNG.quantize.vecDot;for(i1-=4;i0<i1;){for(;vecDot(nimg,i0,e)<=eMq;)i0+=4;for(;vecDot(nimg,i1,e)>eMq;)i1-=4;if(i1<=i0)break;var t=nimg32[i0>>2];nimg32[i0>>2]=nimg32[i1>>2],nimg32[i1>>2]=t,i0+=4,i1-=4}for(;vecDot(nimg,i0,e)>eMq;)i0-=4;return i0+4},UPNG.quantize.vecDot=function(nimg,i,e){return nimg[i]*e[0]+nimg[i+1]*e[1]+nimg[i+2]*e[2]+nimg[i+3]*e[3]},UPNG.quantize.stats=function(nimg,i0,i1){for(var R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=[0,0,0,0],N=i1-i0>>2,i=i0;i<i1;i+=4){var r=nimg[i]*(1/255),g=nimg[i+1]*(1/255),b=nimg[i+2]*(1/255),a=nimg[i+3]*(1/255);m[0]+=r,m[1]+=g,m[2]+=b,m[3]+=a,R[0]+=r*r,R[1]+=r*g,R[2]+=r*b,R[3]+=r*a,R[5]+=g*g,R[6]+=g*b,R[7]+=g*a,R[10]+=b*b,R[11]+=b*a,R[15]+=a*a}return R[4]=R[1],R[8]=R[2],R[12]=R[3],R[9]=R[6],R[13]=R[7],R[14]=R[11],{R:R,m:m,N:N}},UPNG.quantize.estats=function(stats){var tmi,R=stats.R,m=stats.m,stats=stats.N,m0=m[0],m1=m[1],m2=m[2],m=m[3],iN=0==stats?0:1/stats,R=[R[0]-m0*m0*iN,R[1]-m0*m1*iN,R[2]-m0*m2*iN,R[3]-m0*m*iN,R[4]-m1*m0*iN,R[5]-m1*m1*iN,R[6]-m1*m2*iN,R[7]-m1*m*iN,R[8]-m2*m0*iN,R[9]-m2*m1*iN,R[10]-m2*m2*iN,R[11]-m2*m*iN,R[12]-m*m0*iN,R[13]-m*m1*iN,R[14]-m*m2*iN,R[15]-m*m*iN],A=R,M=UPNG.M4,b=[.5,.5,.5,.5],mi=0;if(0!=stats)for(var i=0;i<10&&(b=M.multVec(A,b),tmi=Math.sqrt(M.dot(b,b)),b=M.sml(1/tmi,b),!(Math.abs(tmi-mi)<1e-9));i++)mi=tmi;stats=[m0*iN,m1*iN,m2*iN,m*iN],m0=M.dot(M.sml(255,stats),b),m1=stats[3]<.001?0:1/stats[3];return{Cov:R,q:stats,e:b,L:mi,eMq255:m0,eMq:M.dot(b,stats),rgba:(Math.round(255*stats[3])<<24|Math.round(255*stats[2]*m1)<<16|Math.round(255*stats[1]*m1)<<8|Math.round(255*stats[0]*m1)<<0)>>>0}},UPNG.M4={multVec:function(m,v){return[m[0]*v[0]+m[1]*v[1]+m[2]*v[2]+m[3]*v[3],m[4]*v[0]+m[5]*v[1]+m[6]*v[2]+m[7]*v[3],m[8]*v[0]+m[9]*v[1]+m[10]*v[2]+m[11]*v[3],m[12]*v[0]+m[13]*v[1]+m[14]*v[2]+m[15]*v[3]]},dot:function(x,y){return x[0]*y[0]+x[1]*y[1]+x[2]*y[2]+x[3]*y[3]},sml:function(a,y){return[a*y[0],a*y[1],a*y[2],a*y[3]]}},UPNG.encode.alphaMul=function(img,roundA){for(var nimg=new Uint8Array(img.length),area=img.length>>2,i=0;i<area;i++){var qi=i<<2,ia=img[3+qi],a=(ia=roundA?ia<128?0:255:ia)*(1/255);nimg[qi]=img[qi]*a,nimg[1+qi]=img[1+qi]*a,nimg[2+qi]=img[2+qi]*a,nimg[3+qi]=ia}return nimg}}(module.exports=UPNG,pako_1)});const encodeToPng=async(imageData,codecs_path)=>UPNG.encode([imageData.data],imageData.width,imageData.height,0),CANT_OPTIMISE_IMAGE_ERROR="CANT_OPTIMISE_IMAGE_ERROR",optimizeImage=async(url,config)=>{url=await(async(url,config)=>{const{ext}=getUrlInfo(url),formats=getImageOutputFormats(ext),imageData=await decode(url,config.codecs_path);if(typeof imageData==="string")return imageData;const optimizedImages=[];for(let index=0;index<formats.length;index++){const format=formats[index];let image=false;switch(format){case"jpg":image=await encodeToJpg(imageData,config.codecs_path);break;case"webp":image=await encodeToWebp(imageData,config.codecs_path);break;case"png":image=await encodeToPng(imageData);break}if(image)optimizedImages.push({format:format,image:image});else optimizedImages.push(false)}const success=optimizedImages.reduce((result,optimizedImageBuffer)=>result&&optimizedImageBuffer!==false,true);return success?optimizedImages:CANT_OPTIMISE_IMAGE_ERROR})(url,config);return"string"!=typeof url?{success:!0,data:url}:{success:!1,error:url}},getUrlInfo=url=>{const urlInfo=url.split(".");return{ext:urlInfo.pop()}},getImageOutputFormats=ext=>{switch(ext){case"jpg":case"jpeg":return["jpg","webp"];case"png":return["png","webp"];default:return[]}},decode=async(url,codecs_path)=>{var ext=getUrlInfo(url)["ext"];try{switch(ext){case"jpg":case"jpeg":return await(async url=>{const imgResponse=await fetch(url);url=await imgResponse.arrayBuffer();return await jpg.decode(new Uint8Array(url),{useTArray:!0})})(url);case"png":return await(async url=>{const imgResponse=await fetch(url);url=await imgResponse.arrayBuffer(),url=await UPNG.decode(url);return{...url,data:UPNG.toRGBA8(url)[0]}})(url);default:return"UNSUPPORTED_IMAGE_TYPE"}}catch(e){return e.message&&-1<e.message.indexOf("maxMemoryUsageInMB")?"CANT_DECODE_IMAGE_TOO_BIG_ERROR":"CANT_READ_IMAGE_ERROR"}},OPTIMIZE_IMAGE="Optimize/image";const IMAGE_UPLOAD_FAILED_ERROR="IMAGE_UPLOAD_FAILED_ERROR",UPLOAD_MAX_SIZE_ERROR="UPLOAD_MAX_SIZE_ERROR",UPLOAD_IMAGE="ServerUpdate/UPLOAD_IMAGE";createCommonjsModule(function(module,exports){!function(e){function t(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function n(e,t,r){n.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:r,enumerable:!0})}function o(e,t){o.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function i(e,t){i.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function a(e,t,r){a.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:r,enumerable:!0})}function f(e,t,r){var n=e.slice((r||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,n),e}function u(e){var t="undefined"==typeof e?"undefined":N(e);return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function l(e,t,r,c,s,d,p){s=s||[],p=p||[];var g=s.slice(0);if("undefined"!=typeof d){if(c){if("function"==typeof c&&c(g,d))return;if("object"===("undefined"==typeof c?"undefined":N(c))){if(c.prefilter&&c.prefilter(g,d))return;if(c.normalize){var h=c.normalize(g,d,e,t);h&&(e=h[0],t=h[1])}}}g.push(d)}"regexp"===u(e)&&"regexp"===u(t)&&(e=e.toString(),t=t.toString());var y="undefined"==typeof e?"undefined":N(e),v="undefined"==typeof t?"undefined":N(t),b="undefined"!==y||p&&p[p.length-1].lhs&&p[p.length-1].lhs.hasOwnProperty(d),m="undefined"!==v||p&&p[p.length-1].rhs&&p[p.length-1].rhs.hasOwnProperty(d);if(!b&&m)r(new o(g,t));else if(!m&&b)r(new i(g,e));else if(u(e)!==u(t))r(new n(g,e,t));else if("date"===u(e)&&e-t!==0)r(new n(g,e,t));else if("object"===y&&null!==e&&null!==t)if(p.filter(function(t){return t.lhs===e}).length)e!==t&&r(new n(g,e,t));else{if(p.push({lhs:e,rhs:t}),Array.isArray(e)){var w;e.length;for(w=0;w<e.length;w++)w>=t.length?r(new a(g,w,new i(void 0,e[w]))):l(e[w],t[w],r,c,g,w,p);for(;w<t.length;)r(new a(g,w,new o(void 0,t[w++])))}else{var x=Object.keys(e),S=Object.keys(t);x.forEach(function(n,o){var i=S.indexOf(n);i>=0?(l(e[n],t[n],r,c,g,n,p),S=f(S,i)):l(e[n],void 0,r,c,g,n,p)}),S.forEach(function(e){l(void 0,t[e],r,c,g,e,p)})}p.length=p.length-1}else e!==t&&("number"===y&&isNaN(e)&&isNaN(t)||r(new n(g,e,t)))}function c(e,t,r,n){return n=n||[],l(e,t,function(e){e&&n.push(e)},r),n.length?n:void 0}function s(e,t,r){if(r.path&&r.path.length){var n,o=e[t],i=r.path.length-1;for(n=0;n<i;n++)o=o[r.path[n]];switch(r.kind){case"A":s(o[r.path[n]],r.index,r.item);break;case"D":delete o[r.path[n]];break;case"E":case"N":o[r.path[n]]=r.rhs}}else switch(r.kind){case"A":s(e[t],r.index,r.item);break;case"D":e=f(e,t);break;case"E":case"N":e[t]=r.rhs}return e}function d(e,t,r){if(e&&t&&r&&r.kind){for(var n=e,o=-1,i=r.path?r.path.length-1:0;++o<i;)"undefined"==typeof n[r.path[o]]&&(n[r.path[o]]="number"==typeof r.path[o]?[]:{}),n=n[r.path[o]];switch(r.kind){case"A":s(r.path?n[r.path[o]]:n,r.index,r.item);break;case"D":delete n[r.path[o]];break;case"E":case"N":n[r.path[o]]=r.rhs}}}function p(e,t,r){if(r.path&&r.path.length){var n,o=e[t],i=r.path.length-1;for(n=0;n<i;n++)o=o[r.path[n]];switch(r.kind){case"A":p(o[r.path[n]],r.index,r.item);break;case"D":o[r.path[n]]=r.lhs;break;case"E":o[r.path[n]]=r.lhs;break;case"N":delete o[r.path[n]]}}else switch(r.kind){case"A":p(e[t],r.index,r.item);break;case"D":e[t]=r.lhs;break;case"E":e[t]=r.lhs;break;case"N":e=f(e,t)}return e}function g(e,t,r){if(e&&t&&r&&r.kind){var n,o,i=e;for(o=r.path.length-1,n=0;n<o;n++)"undefined"==typeof i[r.path[n]]&&(i[r.path[n]]={}),i=i[r.path[n]];switch(r.kind){case"A":p(i[r.path[n]],r.index,r.item);break;case"D":i[r.path[n]]=r.lhs;break;case"E":i[r.path[n]]=r.lhs;break;case"N":delete i[r.path[n]]}}}function h(e,t,r){if(e&&t){var n=function(n){r&&!r(e,t,n)||d(e,t,n)};l(e,t,n)}}function y(e){return"color: "+F[e].color+"; font-weight: bold"}function v(e){var t=e.kind,r=e.path,n=e.lhs,o=e.rhs,i=e.index,a=e.item;switch(t){case"E":return[r.join("."),n,"→",o];case"N":return[r.join("."),o];case"D":return[r.join(".")];case"A":return[r.join(".")+"["+i+"]",a];default:return[]}}function b(e,t,r,n){var o=c(e,t);try{n?r.groupCollapsed("diff"):r.group("diff")}catch(e){r.log("diff")}o?o.forEach(function(e){var t=e.kind,n=v(e);r.log.apply(r,["%c "+F[t].text,y(t)].concat(P(n)))}):r.log("—— no diff ——");try{r.groupEnd()}catch(e){r.log("—— diff end —— ")}}function m(e,t,r,n){switch("undefined"==typeof e?"undefined":N(e)){case"object":return"function"==typeof e[n]?e[n].apply(e,P(r)):e[n];case"function":return e(t);default:return e}}function w(e){var t=e.timestamp,r=e.duration;return function(e,n,o){var i=["action"];return i.push("%c"+String(e.type)),t&&i.push("%c@ "+n),r&&i.push("%c(in "+o.toFixed(2)+" ms)"),i.join(" ")}}function x(e,t){var r=t.logger,n=t.actionTransformer,o=t.titleFormatter,i=void 0===o?w(t):o,a=t.collapsed,f=t.colors,u=t.level,l=t.diff,c="undefined"==typeof t.titleFormatter;e.forEach(function(o,s){var d=o.started,p=o.startedTime,g=o.action,h=o.prevState,y=o.error,v=o.took,w=o.nextState,x=e[s+1];x&&(w=x.prevState,v=x.started-d);var S=n(g),k="function"==typeof a?a(function(){return w},g,o):a,j=D(p),E=f.title?"color: "+f.title(S)+";":"",A=["color: gray; font-weight: lighter;"];A.push(E),t.timestamp&&A.push("color: gray; font-weight: lighter;"),t.duration&&A.push("color: gray; font-weight: lighter;");var O=i(S,j,v);try{k?f.title&&c?r.groupCollapsed.apply(r,["%c "+O].concat(A)):r.groupCollapsed(O):f.title&&c?r.group.apply(r,["%c "+O].concat(A)):r.group(O)}catch(e){r.log(O)}var N=m(u,S,[h],"prevState"),P=m(u,S,[S],"action"),C=m(u,S,[y,h],"error"),F=m(u,S,[w],"nextState");if(N)if(f.prevState){var L="color: "+f.prevState(h)+"; font-weight: bold";r[N]("%c prev state",L,h)}else r[N]("prev state",h);if(P)if(f.action){var T="color: "+f.action(S)+"; font-weight: bold";r[P]("%c action    ",T,S)}else r[P]("action    ",S);if(y&&C)if(f.error){var M="color: "+f.error(y,h)+"; font-weight: bold;";r[C]("%c error     ",M,y)}else r[C]("error     ",y);if(F)if(f.nextState){var _="color: "+f.nextState(w)+"; font-weight: bold";r[F]("%c next state",_,w)}else r[F]("next state",w);l&&b(h,w,r,k);try{r.groupEnd()}catch(e){r.log("—— log end ——")}})}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},L,e),r=t.logger,n=t.stateTransformer,o=t.errorTransformer,i=t.predicate,a=t.logErrors,f=t.diffPredicate;if("undefined"==typeof r)return function(){return function(e){return function(t){return e(t)}}};if(e.getState&&e.dispatch)return console.error("[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:\n// Logger with default options\nimport { logger } from 'redux-logger'\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n// Or you can create your own logger with custom options http://bit.ly/redux-logger-options\nimport createLogger from 'redux-logger'\nconst logger = createLogger({\n  // ...options\n});\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n"),function(){return function(e){return function(t){return e(t)}}};var u=[];return function(e){var r=e.getState;return function(e){return function(l){if("function"==typeof i&&!i(r,l))return e(l);var c={};u.push(c),c.started=O.now(),c.startedTime=new Date,c.prevState=n(r()),c.action=l;var s=void 0;if(a)try{s=e(l)}catch(e){c.error=o(e)}else s=e(l);c.took=O.now()-c.started,c.nextState=n(r());var d=t.diff&&"function"==typeof f?f(r,l):t.diff;if(x(u,Object.assign({},t,{diff:d})),u.length=0,c.error)throw c.error;return s}}}}var k,j,E=function(e,t){return new Array(t+1).join(e)},A=function(e,t){return E("0",t-e.toString().length)+e},D=function(e){return A(e.getHours(),2)+":"+A(e.getMinutes(),2)+":"+A(e.getSeconds(),2)+"."+A(e.getMilliseconds(),3)},O="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date,N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},C=[],k="object"===("undefined"==typeof commonjsGlobal?"undefined":N(commonjsGlobal))&&commonjsGlobal?commonjsGlobal:"undefined"!=typeof window?window:{},j=k.DeepDiff,F=(j&&C.push(function(){"undefined"!=typeof j&&k.DeepDiff===c&&(k.DeepDiff=j,j=void 0)}),t(n,r),t(o,r),t(i,r),t(a,r),Object.defineProperties(c,{diff:{value:c,enumerable:!0},observableDiff:{value:l,enumerable:!0},applyDiff:{value:h,enumerable:!0},applyChange:{value:d,enumerable:!0},revertChange:{value:g,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof j},enumerable:!0},noConflict:{value:function(){return C&&(C.forEach(function(e){e()}),C=null),c},enumerable:!0}}),{E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}}),L={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(e){return e},actionTransformer:function(e){return e},errorTransformer:function(e){return e},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dispatch,r=e.getState;return"function"==typeof t||"function"==typeof r?S()({dispatch:t,getState:r}):void console.error("\n[redux-logger v3] BREAKING CHANGE\n[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.\n[redux-logger v3] Change\n[redux-logger v3] import createLogger from 'redux-logger'\n[redux-logger v3] to\n[redux-logger v3] import { createLogger } from 'redux-logger'\n")};e.defaults=L,e.createLogger=S,e.logger=T,e.default=T,Object.defineProperty(e,"__esModule",{value:!0})}(exports)});const middlewares=[store=>next=>action=>{var actionResult=next(action);switch(action.type){case ITEM_PROCESSED:var itemProcessed=getQueueItemById(store,action.id);itemProcessed&&store.dispatch(processNextItemInQueue(itemProcessed.queue));break;case NEXT:var itemProcessed=((store,queueName)=>store.getState().queue.filter(item=>item.state===ITEM_STATE.PROCESSING&&item.queue===queueName))(store,action.queue),queueList=getQueueItemToBeProcessed(store,action.queue);0<itemProcessed.length||(0<queueList.length?store.dispatch((itemProcessed=queueList[0].id,{type:PROCESS_ITEM,id:itemProcessed})):store.dispatch((action.queue,{type:PROCESSED,queue:queue})));break;case PROCESS_ITEM:queueList=getQueueItemById(store,action.id);queueList&&store.dispatch({type:queueList.queue,item:queueList});break;default:return actionResult}},store=>next=>async action=>{var actionResult=next(action),config=getConfig(store);return action.type===OPTIMIZE_IMAGE&&((config=await(async({urls},config)=>{let result={success:!0,datas:{},error:"",errors:[]};for(let index=0;index<urls.length;index++){var url=urls[index],{success,error,data}=await optimizeImage(url,config);success?result.datas[url]=data:(result.success=!1,result.datas[url]=!1,result.error+=error,result.errors.push(error))}return result})(action.item.payload,config)).success?store.dispatch(updateItemInQueue(action.item.id,{datas:config.datas})):store.dispatch(updateItemInQueue(action.item.id,{error:config.error,errors:config.errors})),store.dispatch(queueItemProcessed(action.item.id))),actionResult},store=>next=>async action=>{var item,actionResult=next(action);return action.type===ITEM_PROCESSED?(item=getQueueItemById(store,action.id))&&item.queue===OPTIMIZE_IMAGE&&(store.dispatch(removeItemInQueue(item.id)),store.dispatch(addToQueue(item.payload,UPLOAD_IMAGE)),store.dispatch(processNextItemInQueue(UPLOAD_IMAGE))):action.type===UPLOAD_IMAGE&&(item=await(async(uploadURL,queueItem)=>{const formData=new FormData,{datas,error,...mediaProps}=queueItem.payload;Object.keys(mediaProps).forEach(key=>{Array.isArray(mediaProps[key])?mediaProps[key].forEach(value=>{formData.append(key+"[]",value)}):formData.append(key,mediaProps[key])}),error?formData.append("error",error):mediaProps.urls.forEach((url,index)=>{datas[url].map(imageData=>{formData.append("media["+index+"]["+imageData.format+"]",new Blob([imageData.image]))})});queueItem=new Headers;queueItem.append("Accept","application/json");try{const uploadResponse=await fetch(uploadURL,{method:"POST",body:formData,headers:queueItem});if(400<=uploadResponse.status){let errorMessage=IMAGE_UPLOAD_FAILED_ERROR;return{success:!1,error:errorMessage=413===uploadResponse.status?UPLOAD_MAX_SIZE_ERROR:errorMessage}}var uploadResponseJson=await uploadResponse.json();return uploadResponseJson?uploadResponseJson:{success:!1,error:IMAGE_UPLOAD_FAILED_ERROR}}catch(error){return{success:!1,error:IMAGE_UPLOAD_FAILED_ERROR}}})((await getConfig(store)).image_upload_url,action.item),store.dispatch(queueItemProcessed(action.item.id)),item.success||(item.error?store.dispatch(updateItemInQueue(action.item.id,{error:"Image upload failed",errors:[item.error]})):store.dispatch(updateItemInQueue(action.item.id,{error:"Image compression failed"}))),store.dispatch(updateItemInQueue(action.item.id,{datas:{}}))),actionResult}],reducers={config:(state=null,action)=>"SET_CONFIG"!==action.type?state:action.config,queue:queue};deflate_1$1=(config=>{config={reducers:{},middlewares:[],...config};return compose(function(){for(var _len=arguments.length,middlewares=new Array(_len),_key=0;_key<_len;_key++)middlewares[_key]=arguments[_key];return function(createStore){return function(){var store=createStore.apply(void 0,arguments),_dispatch=function(){throw new Error(formatProdErrorMessage(15))},middlewareAPI={getState:store.getState,dispatch:function(){return _dispatch.apply(void 0,arguments)}},chain=middlewares.map(function(middleware){return middleware(middlewareAPI)}),_dispatch=compose.apply(void 0,chain)(store.dispatch);return _objectSpread2(_objectSpread2({},store),{},{dispatch:_dispatch})}}}(...middlewares,...config.middlewares))(createStore)(combineReducers({...reducers,...config.reducers}))})();const updateImageList=async store=>{const list=await(async url=>{let json=[];try{const response=await fetch(url);json=await response.json()}catch(e){return console.error(e),"invalid-json"===e.type&&console.error(url,await fetch(url)),!1}return json})((await getConfig(store)).image_list_url);if(!Array.isArray(list))return!1;const newOptimizeListIds=[];list.map(image=>{let item=null,items=getQueueItemsByPayloadId(store,image.id),shouldBeAdded=(items.forEach(queueItem=>{item||queueItem.queue!==OPTIMIZE_IMAGE?queueItem.queue===UPLOAD_IMAGE&&(item=queueItem):(item=queueItem,newOptimizeListIds.push(item.id))}),!item),shouldBeUpdated=item&&item.state!==ITEM_STATE.PROCESSING&&(urls1=item.payload.urls,urls2=image.urls,urls1.length!==urls2.length||urls1.filter(value=>urls2.includes(value)).length!==urls1.length);var urls2,urls1;item&&item.payload.error&&(shouldBeAdded=!1,shouldBeUpdated=!1),shouldBeAdded?(urls1=addToQueue(image,OPTIMIZE_IMAGE),store.dispatch(urls1),newOptimizeListIds.push(urls1.item.id)):shouldBeUpdated&&store.dispatch(updateItemInQueue(item.id,image))}),getQueueItemsByQueue(store,OPTIMIZE_IMAGE).forEach(item=>{-1===newOptimizeListIds.indexOf(item.id)&&getQueueItemById(store,item.id).state!==ITEM_STATE.PROCESSING&&store.dispatch(removeItemInQueue(item.id))});let countUploadProcessedItems=0;return getQueueItemsByQueue(store,UPLOAD_IMAGE).forEach(item=>{item.state!==ITEM_STATE.PROCESSED||item.payload.error||10<(countUploadProcessedItems+=1)&&store.dispatch(removeItemInQueue(item.id))}),!0},refreshQueue=async(store,source)=>{await(async(store,client)=>new Promise(function(resolve,reject){const currentConfig=store.getState().config,unsubscribe=store.subscribe(()=>{currentConfig!==store.getState().config&&(unsubscribe(),resolve(store.getState().config))});client.postMessage({command:"get-config"})}))(store,source);return!!await updateImageList(store)&&(store.dispatch(processNextItemInQueue(OPTIMIZE_IMAGE)),prepareQueueForFront(store))};let intervalID=null,interval=5e3;const intervalUpdater=(store,source)=>async()=>{var queue=await refreshQueue(store,source);if(!1===queue)return interval=5e3,void clearTimeout(intervalID);var queueItemProcessed=getQueueItemProcessed(store,OPTIMIZE_IMAGE).concat(getQueueItemProcessed(store,UPLOAD_IMAGE)),queueItemProcessed=0===queue.length||queueItemProcessed.length===queue.length;queueItemProcessed?interval+=5e3:interval=5e3,queueItemProcessed&&sendMessageToAllClients({command:"queue-updated",queue:prepareQueueForFront(store)}),clearTimeout(intervalID),intervalID=setTimeout(intervalUpdater(store,source),interval)},sendMessageToAllClients=message=>{clients.matchAll({type:"window"}).then(clientList=>{clientList.forEach(client=>{client.postMessage(message)})})},appStateUpdater=store=>{let queue=null;return store.subscribe(()=>{store.getState().queue!==queue&&(queue=store.getState().queue,sendMessageToAllClients({command:"queue-updated",queue:prepareQueueForFront(store)}))})},prepareQueueForFront=store=>[...getQueueItemsByQueue(store,UPLOAD_IMAGE).map(({payload,state})=>{const{datas,...lightPayload}=payload;return{payload:lightPayload,state:state}}),...getQueueItemsByQueue(store,OPTIMIZE_IMAGE).filter(({state})=>state!==ITEM_STATE.PROCESSED).map(({payload,state})=>{const{datas,...lightPayload}=payload;return{payload:lightPayload,state:state}})];(async({store})=>{const gEventHandler=(eventHandler=>{const commandHandlers=[];return eventHandler.addEventListener("install",function(event){}),eventHandler.addEventListener("activate",function(event){}),eventHandler.addEventListener("message",async function(event){event.data&&event.data.command&&commandHandlers.map(commandHandler=>commandHandler(event.data.command,event.data,event.source))}),{addCommandHandler:commandHandler=>{commandHandlers.push(commandHandler)}}})(self);gEventHandler.addCommandHandler((store=>(command,data,source)=>{"set-config"===command&&store.dispatch(setConfig({...data.config}))})(store)),gEventHandler.addCommandHandler((store=>(appStateUpdater(store),async(command,data,source)=>{"get-update"===command?intervalUpdater(store,source)():"remove-item"===command?(source=getQueueItemByPayloadId(store,data.id))&&store.dispatch(removeItemInQueue(source.id)):"skip-waiting"===command?skipWaiting():"stop-working"===command&&(clearTimeout(intervalID),getQueueItemToBeProcessed(store,OPTIMIZE_IMAGE).concat(getQueueItemToBeProcessed(store,UPLOAD_IMAGE)).forEach(item=>{store.dispatch(removeItemInQueue(item.id))}),store.subscribe(()=>{0===getQueueItemProcessing(store,OPTIMIZE_IMAGE).concat(getQueueItemProcessing(store,UPLOAD_IMAGE)).length&&sendMessageToAllClients({command:"stopped"})}))}))(store))})({store:deflate_1$1})}();
//# sourceMappingURL=sw.js.map